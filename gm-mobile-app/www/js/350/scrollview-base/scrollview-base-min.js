YUI.add("scrollview-base",function(g){function j(){j.superclass.constructor.apply(this,arguments)}var o=g.ClassNameManager.getClassName,o={vertical:o("scrollview","vert"),horizontal:o("scrollview","horiz")},r=g.UA.ie,q=g.Transition,h=q.useNative;g.ScrollView=g.extend(j,g.Widget,{initializer:function(){this._cb=this.get("contentBox");this._bb=this.get("boundingBox")},_uiSizeCB:function(){},_onTransEnd:function(){this.fire("scrollEnd")},bindUI:function(){this._bindDrag(this.get("drag"));this._bindFlick(this.get("flick"));
this._bindAttrs();r&&this._fixIESelect(this._bb,this._cb)},_bindAttrs:function(){var a=this._afterScrollChange,b=this._afterDimChange;this.after({disabledChange:this._afterDisabledChange,flickChange:this._afterFlickChange,dragChange:this._afterDragChange,scrollYChange:a,scrollXChange:a,heightChange:b,widthChange:b});r||this.after("renderedChange",function(){})},_bindDrag:function(a){var b=this._bb;if(a)b.on("drag|gesturemovestart",g.bind(this._onGestureMoveStart,this));else b.detach("drag|*")},_bindFlick:function(a){var b=
this._cb;if(a)b.on("flick|flick",g.bind(this._flick,this),a);else b.detach("flick|*")},_bindMousewheel:function(a){var b=this._cb;if(this._scrollsVertical)if(a)b.on("mousewheel",g.bind(this._mousewheel,this),a);else b.detach("mousewheel|*")},syncUI:function(){this._cDisabled=this.get("disabled");this._uiDimensionsChange();this._bindMousewheel(!0);this.scrollTo(this.get("scrollX"),this.get("scrollY"))},scrollTo:function(a,b,c,d){void 0===d&&(b<this._minScrollY?b=this._minScrollY:b>this._maxScrollY&&
(b=this._maxScrollY));if(!this._cDisabled){var e=this._cb,f=null!==a,p=null!==b,k=f?-1*a:0,n=p?-1*b:0,l=j._TRANSITION,i=this._transEndCB,c=c||0,d=d||j.EASING;f&&this.set("scrollX",a,{src:"ui"});p&&this.set("scrollY",b,{src:"ui"});h&&e.setStyle(l.DURATION,"0s").setStyle(l.PROPERTY,"");if(0!==c){a={easing:d,duration:c/1E3};if(h)a.transform=this._transform(k,n);else if(f&&(a.left=k+"px"),p)a.top=n+"px";i||(i=this._transEndCB=g.bind(this._onTransEnd,this));e.transition(a,i)}else h?e.setStyle("transform",
this._transform(k,n)):(f&&e.setStyle("left",k+"px"),p&&e.setStyle("top",n+"px"))}},_transform:function(a,b){return this._forceHWTransforms?"translate("+a+"px,"+b+"px) translateZ(0px)":"translate("+a+"px,"+b+"px)"},_moveTo:function(a,b,c){h?a.setStyle("transform",this._transform(b,c)):(a.setStyle("left",b+"px"),a.setStyle("top",c+"px"))},_forceHWTransforms:g.UA.webkit?!0:!1,_prevent:{start:!1,move:!0,end:!1},_onGestureMoveStart:function(a){var b=this._bb;this._cDisabled||(this._prevent.start&&a.preventDefault(),
this._killTimer(),this._hm=b.on("drag|gesturemove",g.bind(this._onGestureMove,this)),this._hme=b.on("drag|gesturemoveend",g.bind(this._onGestureMoveEnd,this)),this._startY=a.clientY+this.get("scrollY"),this._startX=a.clientX+this.get("scrollX"),this._startClientY=this._endClientY=a.clientY,this._startClientX=this._endClientX=a.clientX,this._snapToEdge=this._flicking=this._isDragging=!1)},_onGestureMove:function(a){this._prevent.move&&a.preventDefault();this._isDragging=!0;this._endClientY=a.clientY;
this._endClientX=a.clientX;this._scrollsVertical&&this.set("scrollY",-(a.clientY-this._startY));this._scrollsHorizontal&&this.set("scrollX",-(a.clientX-this._startX))},_onGestureMoveEnd:function(a){this._prevent.end&&a.preventDefault();var a=this._minScrollY,b=this._maxScrollY,c=this._minScrollX,d=this._maxScrollX,e=this._scrollsVertical,f=this._scrollsHorizontal,g=(e?this._startClientY:this._startClientX)-(e?this._endClientY:this._endClientX),k=Math.abs(g),j=this._bb,l,i,m,h;this._hm.detach();this._hme.detach();
this._scrolledHalfway=this._snapToEdge=this._isDragging=!1;this.lastScrolledAmt=g;if(f&&k>j.get("offsetWidth")/2||e&&k>j.get("offsetHeight")/2)this._scrolledHalfway=!0,this._scrolledForward=0<g;e&&(h=this.get("scrollY"),i=Math.min(Math.max(h,a),b));f&&(m=this.get("scrollX"),l=Math.min(Math.max(m,c),d));if(l!==m||i!==h)this._snapToEdge=!0,e&&this.set("scrollY",i),f&&this.set("scrollX",l);this._snapToEdge||this.fire("scrollEnd",{onGestureMoveEnd:!0})},_afterScrollChange:function(a){var b=a.duration,
c=a.easing,d=a.newVal;"ui"!==a.src&&("scrollX"==a.attrName?this._uiScrollTo(d,null,b,c):this._uiScrollTo(null,d,b,c))},_afterFlickChange:function(a){this._bindFlick(a.newVal)},_afterDisabledChange:function(a){this._cDisabled=a.newVal},_afterDragChange:function(a){this._bindDrag(a.newVal)},_uiScrollTo:function(a,b,c,d){c=c||this._snapToEdge?400:0;d=d||this._snapToEdge?j.SNAP_EASING:null;this.scrollTo(a,b,c,d)},_afterDimChange:function(){this._uiDimensionsChange()},_getScrollDims:function(){var a,b=
this.get("scrollX"),c=this.get("scrollY"),d=this.get("contentBox");a=this.get("boundingBox");var e;e=j._TRANSITION;h&&(d.setStyle(e.DURATION,"0s"),d.setStyle(e.PROPERTY,""));e=this._forceHWTransforms;this._forceHWTransforms=!1;this._moveTo(d,0,0);a=[a.get("offsetWidth"),a.get("offsetHeight"),a.get("scrollWidth"),a.get("scrollHeight")];this._moveTo(d,-1*b,-1*c);this._forceHWTransforms=e;return a},_uiDimensionsChange:function(){var a=this._bb,b=j.CLASS_NAMES,c=this._getScrollDims(),d=c[0],e=c[1],f=
c[2],c=c[3];e&&c>e?(this._scrollsVertical=!0,this._maxScrollY=c-e,this._minScrollY=0,this._scrollHeight=c,this._height=e,a.addClass(b.vertical)):(this._scrollsVertical=!1,delete this._maxScrollY,delete this._minScrollY,delete this._scrollHeight,delete this._height,a.removeClass(b.vertical));d&&f>d?(this._scrollsHorizontal=!0,this._maxScrollX=f-d,this._minScrollX=0,this._scrollWidth=f,this._width=d,a.addClass(b.horizontal)):(this._scrollsHorizontal=!1,delete this._maxScrollX,delete this._minScrollX,
delete this._scrollWidth,delete this._width,a.removeClass(b.horizontal))},_flick:function(a){a=a.flick;this._cDisabled||(this._currentVelocity=a.velocity,this._flicking=!0,this._cDecel=this.get("deceleration"),this._cBounce=this.get("bounce"),this._pastXEdge=this._pastYEdge=!1,this._flickFrame(),this.fire("flick"))},_mousewheel:function(a){this.scrollTo(0,this.get("scrollY")-10*a.wheelDelta);this.scrollbars&&(this.scrollbars._update(),this.scrollbars.flash());a.preventDefault()},_flickFrame:function(){var a,
b,c,d,e,f,h=this._scrollsVertical,k=this._scrollsHorizontal,n=this._cDecel,l=this._cBounce,i=this._currentVelocity,m=j.FRAME_STEP;h&&(b=this._maxScrollY,c=this._minScrollY,a=this.get("scrollY")-i*m);k&&(e=this._maxScrollX,f=this._minScrollX,d=this.get("scrollX")-i*m);i=this._currentVelocity=i*n;if(0.015>=Math.abs(i).toFixed(4)){if(this._flicking=!1,this._killTimer(!(this._pastYEdge||this._pastXEdge)),h&&(a<c?(this._snapToEdge=!0,this.set("scrollY",c)):a>b&&(this._snapToEdge=!0,this.set("scrollY",
b))),k)d<f?(this._snapToEdge=!0,this.set("scrollX",f)):d>e&&(this._snapToEdge=!0,this.set("scrollX",e))}else{if(h){if(a<c||a>b)this._pastYEdge=!0,this._currentVelocity*=l;this.set("scrollY",a)}if(k){if(d<f||d>e)this._pastXEdge=!0,this._currentVelocity*=l;this.set("scrollX",d)}this._flickTimer||(this._flickTimer=g.later(m,this,"_flickFrame",null,!0))}},_killTimer:function(a){this._flickTimer&&(this._flickTimer.cancel(),this._flickTimer=null);a&&this.fire("scrollEnd")},_setScroll:function(a,b){if(this._cDisabled)a=
g.Attribute.INVALID_VALUE;else{var c=this._cachedBounce||this.get("bounce"),d=j.BOUNCE_RANGE,e="x"==b?this._maxScrollX:this._maxScrollY,f=c?-d:0,d=c?e+d:e;if(!c||!this._isDragging)a<f?a=f:a>d&&(a=d)}return a},_setScrollX:function(a){return this._setScroll(a,"x")},_setScrollY:function(a){return this._setScroll(a,"y")}},{NAME:"scrollview",ATTRS:{scrollY:{value:0,setter:"_setScrollY"},scrollX:{value:0,setter:"_setScrollX"},deceleration:{value:0.93},bounce:{value:0.1},flick:{value:{minDistance:10,minVelocity:0.3}},
drag:{value:!0}},CLASS_NAMES:o,UI_SRC:"ui",BOUNCE_RANGE:150,FRAME_STEP:30,EASING:"cubic-bezier(0, 0.1, 0, 1.0)",SNAP_EASING:"ease-out",_TRANSITION:{DURATION:q._VENDOR_PREFIX+"TransitionDuration",PROPERTY:q._VENDOR_PREFIX+"TransitionProperty"}})},"3.5.0",{requires:["widget","event-gestures","event-mousewheel","transition"],skinnable:!0});
