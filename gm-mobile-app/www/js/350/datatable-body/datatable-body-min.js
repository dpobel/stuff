YUI.add("datatable-body",function(e){var k=e.Lang,f=k.isArray,t=k.isNumber,s=k.isString,l=k.sub,u=e.Escape.html,v=e.Array,q=e.bind,w=e.Object,r=e.ClassNameManager,x=r.getClassName;e.namespace("DataTable").BodyView=e.Base.create("tableBody",e.View,[],{CELL_TEMPLATE:'<td {headers} class="{className}">{content}</td>',ROW_TEMPLATE:'<tr id="{rowId}" data-yui3-record="{clientId}" class="{rowClass}">{content}</tr>',getCell:function(a,b){var d=this.get("container"),c,g,m;if(a&&d&&(f(a)?g=(c=d.get("children").item(a[0]))&&
c.get("children").item(a[1]):e.instanceOf(a,e.Node)&&(g=a.ancestor("."+this.getClassName("cell"),!0)),g&&b)){c=d.get("firstChild.rowIndex");if(s(b))switch(b){case "above":b=[-1,0];break;case "below":b=[1,0];break;case "next":b=[0,1];break;case "previous":b=[0,-1]}f(b)&&(m=g.get("parentNode.rowIndex")+b[0]-c,c=d.get("children").item(m),m=g.get("cellIndex")+b[1],g=c&&c.get("children").item(m))}return g||null},getClassName:function(){var a=v(arguments);a.unshift(this._cssPrefix);a.push(!0);return x.apply(r,
a)},getRecord:function(a){var b=this.get("modelList"),d=this.get("container"),c=null,g;d&&(s(a)&&(a=d.one("#"+a)),e.instanceOf(a,e.Node)&&(g=(c=a.ancestor(function(a){return a.get("parentNode").compareTo(d)},!0))&&b.getByClientId(c.getData("yui3-record"))));return g||null},getRow:function(a){var b=this.get("container")||null;a&&(a=this._idMap[a.get?a.get("clientId"):a]||a);return b&&e.one(t(a)?b.get("children").item(a):"#"+a)},render:function(){var a=this.get("container"),b=this.get("modelList"),
d=this.columns;this._createRowTemplate(d);a&&b&&(a.setContent(this._createDataHTML(d)),this._applyNodeFormatters(a,d));this.bindUI();return this},_afterColumnsChange:function(a){this.columns=this._parseColumns(a.newVal);this.render()},_afterDataChange:function(){this.render()},_afterModelListChange:function(a){var b=a.prevVal,a=a.newVal;b&&b.removeTarget&&b.removeTarget(this);a&&a.addTarget(this)&&a.addTarget(this);this._idMap={}},_applyNodeFormatters:function(a,b){var d=this.source,c=this.get("modelList"),
g=[],m="."+this.getClassName("liner"),e,h,i;h=0;for(i=b.length;h<i;++h)b[h].nodeFormatter&&g.push(h);c&&g.length&&(e=a.get("childNodes"),c.each(function(a,c){var i={data:a.toJSON(),record:a,rowIndex:c},h=e.item(c),k,n,l,f,o;if(h){f=h.get("childNodes");h=0;for(k=g.length;h<k;++h)if(o=f.item(g[h]))n=i.column=b[g[h]],l=n.key||n.id,i.value=a.get(l),i.td=o,i.cell=o.one(m)||o,n=n.nodeFormatter.call(d,i),!1===n&&o.destroy(!0)}}))},bindUI:function(){var a=this._eventHandles;this.source&&!a.columnsChange&&
(a.columnsChange=this.source.after("columnsChange",q("_afterColumnsChange",this)));a.dataChange||(a.dataChange=this.after(["modelListChange","*:change","*:add","*:remove","*:reset"],q("_afterDataChange",this)))},_cssPrefix:r.getClassName("table"),_createDataHTML:function(){var a=this.get("modelList"),b="";a&&a.each(function(a,c){b+=this._createRowHTML(a,c)},this);return b},_createRowHTML:function(a,b){var d=a.toJSON(),c=a.get("clientId"),c={rowId:this._getRowId(c),clientId:c,rowClass:b%2?this.CLASS_ODD:
this.CLASS_EVEN},g=this.source||this,e=this.columns,p,h,i,k,j,f;p=0;for(h=e.length;p<h;++p){i=e[p];j=d[i.key];k=i._id;c[k+"-className"]="";i.formatter&&(f={value:j,data:d,column:i,record:a,className:"",rowClass:"",rowIndex:b},"string"===typeof i.formatter?void 0!==j&&(j=l(i.formatter,f)):(j=i.formatter.call(g,f),void 0===j&&(j=f.value),c[k+"-className"]=f.className,c.rowClass+=" "+f.rowClass));if(void 0===j||null===j||""===j)j=i.emptyCellValue||"";c[k]=i.allowHTML?j:u(j);c.rowClass=c.rowClass.replace(/\s+/g,
" ")}return l(this._rowTemplate,c)},_createRowTemplate:function(a){var b="",d=this.CELL_TEMPLATE,c,g,e,f,h;c=0;for(g=a.length;c<g;++c)e=a[c],f=e._id,h=1<(e._headers||[]).length?'headers="'+e._headers.join(" ")+'"':"",f={content:"{"+f+"}",headers:h,className:this.getClassName("col",f)+" "+(e.className||"")+" "+this.getClassName("cell")+" {"+f+"-className}"},e.nodeFormatter&&(f.content=""),b+=l(e.cellTemplate||d,f);this._rowTemplate=l(this.ROW_TEMPLATE,{content:b})},destructor:function(){this.set("modelList",
null);(new e.EventHandle(w.values(this._eventHandles))).detach()},_getRowId:function(a){return this._idMap[a]||(this._idMap[a]=e.guid())},initializer:function(a){var b=a.cssPrefix||(a.source||{}).cssPrefix,d=this.get("modelList");this.source=a.source;this.columns=this._parseColumns(a.columns);this._eventHandles={};this._idMap={};b&&(this._cssPrefix=b);this.CLASS_ODD=this.getClassName("odd");this.CLASS_EVEN=this.getClassName("even");this.after("modelListChange",q("_afterModelListChange",this));d&&
d.addTarget&&d.addTarget(this)},_parseColumns:function(a,b){var d,c,e;b||(b=[]);if(f(a)&&a.length){c=0;for(e=a.length;c<e;++c)d=a[c],"string"===typeof d&&(d={key:d}),d.key||d.formatter||d.nodeFormatter?(d.index=b.length,b.push(d)):d.children&&this._parseColumns(d.children,b)}return b}},{ATTRS:{modelList:{setter:"_setModelList"}}})},"3.5.0",{requires:["datatable-core","view","classnamemanager"]});
