YUI.add("widget-modality",function(c){function e(){}var n=c.Lang.isBoolean,h=c.ClassNameManager.getClassName,k=function(){var a=c.config.doc,b=null,d;if(a.createElement&&(d=a.createElement("div"))&&d.style)if(d.style.position="fixed",d.style.top="10px",(a=a.body)&&a.appendChild&&a.removeChild)a.appendChild(d),b=10===d.offsetTop,a.removeChild(d);return b}(),f={modal:h("widget","modal"),mask:h("widget","mask")};e.ATTRS={maskNode:{getter:"_getMaskNode",readOnly:!0},modal:{value:!1,validator:n},focusOn:{valueFn:function(){return[{eventName:"clickoutside"},
{eventName:"focusoutside"}]},validator:c.Lang.isArray}};e.CLASSES=f;e._GET_MASK=function(){var a=c.one(".yui3-widget-mask")||null,b=c.one("window");a||(a=c.Node.create("<div></div>"),a.addClass(f.mask),k?a.setStyles({position:"fixed",width:"100%",height:"100%",top:"0",left:"0",display:"block"}):a.setStyles({position:"absolute",width:b.get("winWidth")+"px",height:b.get("winHeight")+"px",top:"0",left:"0",display:"block"}));return a};e.STACK=[];e.prototype={initializer:function(){c.after(this._renderUIModal,
this,"renderUI");c.after(this._syncUIModal,this,"syncUI");c.after(this._bindUIModal,this,"bindUI")},destructor:function(){this._uiSetHostVisibleModal(!1)},_uiHandlesModal:null,_renderUIModal:function(){var a=this.get("boundingBox");this._repositionMask(this);a.addClass(f.modal)},_bindUIModal:function(){this.after("visibleChange",this._afterHostVisibleChangeModal);this.after("zIndexChange",this._afterHostZIndexChangeModal);this.after("focusOnChange",this._afterFocusOnChange);if(!k||5>c.UA.ios||3>c.UA.android)c.one("win").on("scroll",
this._resyncMask,this)},_syncUIModal:function(){this._uiSetHostVisibleModal(this.get("visible"));this._uiSetHostZIndexModal(this.get("zIndex"))},_focus:function(){var a=this.get("boundingBox"),b=a.get("tabIndex");a.set("tabIndex",0<=b?b:0);this.focus()},_blur:function(){this.blur()},_getMaskNode:function(){return e._GET_MASK()},_uiSetHostVisibleModal:function(a){var b=e.STACK,d=this.get("maskNode"),l=this.get("modal");a?(c.Array.each(b,function(a){a._detachUIHandlesModal();a._blur()}),b.unshift(this),
this._repositionMask(this),this._uiSetHostZIndexModal(this.get("zIndex")),l&&(d.show(),c.later(1,this,"_attachUIHandlesModal"),this._focus())):(a=c.Array.indexOf(b,this),0<=a&&b.splice(a,1),this._detachUIHandlesModal(),this._blur(),b.length?(b=b[0],this._repositionMask(b),b._uiSetHostZIndexModal(b.get("zIndex")),b.get("modal")&&(c.later(1,b,"_attachUIHandlesModal"),b._focus())):"block"===d.getStyle("display")&&d.hide())},_uiSetHostZIndexModal:function(a){this.get("modal")&&this.get("maskNode").setStyle("zIndex",
a||0)},_attachUIHandlesModal:function(){var a,b,d;if(!(this._uiHandlesModal||e.STACK[0]!==this)){var l=this.get("boundingBox"),f=this.get("maskNode"),j=this.get("focusOn"),m=c.bind(this._focus,this),i=[],g,h;g=0;for(h=j.length;g<h;g++)d=b=a=void 0,a=j[g].node,b=j[g].eventName,d=j[g].keyCode,!a&&!d&&b?i.push(l.on(b,m)):a&&!d&&b?i.push(a.on(b,m)):a&&d&&b?i.push(a.on(b,m,d)):c.Log('focusOn ATTR Error: The event with name "'+b+'" could not be attached.');k||i.push(c.one("win").on("scroll",c.bind(function(){f.setStyle("top",
f.get("docScrollY"))},this)));this._uiHandlesModal=i}},_detachUIHandlesModal:function(){c.each(this._uiHandlesModal,function(a){a.detach()});this._uiHandlesModal=null},_afterHostVisibleChangeModal:function(a){this._uiSetHostVisibleModal(a.newVal)},_afterHostZIndexChangeModal:function(a){this._uiSetHostZIndexModal(a.newVal)},isNested:function(){return 1<e.STACK.length?!0:!1},_repositionMask:function(a){var b=this.get("modal"),d=a.get("modal"),e=this.get("maskNode");if(b&&!d)e.remove(),this.fire("maskHide");
else if(!b&&d||b&&d)e.remove(),this.fire("maskHide"),a=a.get("boundingBox"),a=a.get("parentNode")||c.one("body"),a.insert(e,a.get("firstChild")),this.fire("maskShow")},_resyncMask:function(a){var b=a.currentTarget,a=b.get("docScrollX"),c=b.get("docScrollY"),e=b.get("innerWidth")||b.get("winWidth"),b=b.get("innerHeight")||b.get("winHeight");this.get("maskNode").setStyles({top:c+"px",left:a+"px",width:e+"px",height:b+"px"})},_afterFocusOnChange:function(){this._detachUIHandlesModal();this.get("visible")&&
this._attachUIHandlesModal()}};c.WidgetModality=e},"3.5.0",{requires:["base-build","event-outside","widget"],skinnable:!0});
