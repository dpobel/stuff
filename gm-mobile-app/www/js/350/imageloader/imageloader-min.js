YUI.add("imageloader",function(b){b.ImgLoadGroup=function(){this._init();b.ImgLoadGroup.superclass.constructor.apply(this,arguments)};b.ImgLoadGroup.NAME="imgLoadGroup";b.ImgLoadGroup.ATTRS={name:{value:""},timeLimit:{value:null},foldDistance:{validator:b.Lang.isNumber,setter:function(a){this._setFoldTriggers();return a},lazyAdd:!1},className:{value:null,setter:function(a){return this._className=a},lazyAdd:!1},classNameAction:{value:"default"}};b.extend(b.ImgLoadGroup,b.Base,{_init:function(){this._triggers=
[];this._imgObjs={};this._className=this._classImageEls=this._timeout=null;this._areFoldTriggersSet=!1;this._maxKnownHLimit=0;b.on("domready",this._onloadTasks,this)},addTrigger:function(a,c){if(!a||!c)return this;this._triggers.push(b.on(c,function(){this.fetch()},a,this));return this},addCustomTrigger:function(a,c){if(!a)return this;var d=function(){this.fetch()};b.Lang.isUndefined(c)?this._triggers.push(b.on(a,d,this)):this._triggers.push(c.on(a,d,this));return this},_setFoldTriggers:function(){if(!this._areFoldTriggersSet){var a=
function(){this._foldCheck()};this._triggers.push(b.on("scroll",a,window,this));this._triggers.push(b.on("resize",a,window,this));this._areFoldTriggersSet=!0}},_onloadTasks:function(){var a=this.get("timeLimit");a&&0<a&&(this._timeout=setTimeout(this._getFetchTimeout(),1E3*a));b.Lang.isUndefined(this.get("foldDistance"))||this._foldCheck()},_getFetchTimeout:function(){var a=this;return function(){a.fetch()}},registerImage:function(a){var c=a.domId;if(!c)return null;this._imgObjs[c]=new b.ImgLoadImgObj(a);
return this._imgObjs[c]},fetch:function(){this._clearTriggers();this._fetchByClass();for(var a in this._imgObjs)this._imgObjs.hasOwnProperty(a)&&this._imgObjs[a].fetch()},_clearTriggers:function(){clearTimeout(this._timeout);for(var a=0,b=this._triggers.length;a<b;a++)this._triggers[a].detach()},_foldCheck:function(){var a=!0,c=b.DOM.viewportRegion().bottom+this.get("foldDistance"),d,e,f;if(!(c<=this._maxKnownHLimit)){this._maxKnownHLimit=c;for(d in this._imgObjs)this._imgObjs.hasOwnProperty(d)&&
(e=this._imgObjs[d].fetch(c),a=a&&e);if(this._className){null===this._classImageEls&&(this._classImageEls=[],d=b.all("."+this._className),d.each(function(a){this._classImageEls.push({el:a,y:a.getY(),fetched:!1})},this));d=this._classImageEls;e=0;for(f=d.length;e<f;e++)d[e].fetched||(d[e].y&&d[e].y<=c?(this._updateNodeClassName(d[e].el),d[e].fetched=!0):a=!1)}a&&this._clearTriggers()}},_updateNodeClassName:function(a){var b;"enhanced"==this.get("classNameAction")&&"img"==a.get("tagName").toLowerCase()&&
(b=a.getStyle("backgroundImage"),/url\(["']?(.*?)["']?\)/.test(b),b=RegExp.$1,a.set("src",b),a.setStyle("backgroundImage",""));a.removeClass(this._className)},_fetchByClass:function(){this._className&&b.all("."+this._className).each(b.bind(this._updateNodeClassName,this))}});b.ImgLoadImgObj=function(){b.ImgLoadImgObj.superclass.constructor.apply(this,arguments);this._init()};b.ImgLoadImgObj.NAME="imgLoadImgObj";b.ImgLoadImgObj.ATTRS={domId:{value:null,writeOnce:!0},bgUrl:{value:null},srcUrl:{value:null},
width:{value:null},height:{value:null},setVisible:{value:!1},isPng:{value:!1},sizingMethod:{value:"scale"},enabled:{value:"true"}};b.extend(b.ImgLoadImgObj,b.Base,{_init:function(){this._fetched=!1;this._yPos=this._imgEl=null},fetch:function(a){if(this._fetched)return!0;var c=this._getImgEl(),d;if(!c||a&&(d=this._getYPos(),!d||d>a))return!1;null!==this.get("bgUrl")?this.get("isPng")&&b.UA.ie&&6>=b.UA.ie?c.setStyle("filter",'progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+this.get("bgUrl")+
'", sizingMethod="'+this.get("sizingMethod")+'", enabled="'+this.get("enabled")+'")'):c.setStyle("backgroundImage","url('"+this.get("bgUrl")+"')"):null!==this.get("srcUrl")&&c.setAttribute("src",this.get("srcUrl"));this.get("setVisible")&&c.setStyle("visibility","visible");this.get("width")&&c.setAttribute("width",this.get("width"));this.get("height")&&c.setAttribute("height",this.get("height"));return this._fetched=!0},_getImgEl:function(){null===this._imgEl&&(this._imgEl=b.one("#"+this.get("domId")));
return this._imgEl},_getYPos:function(){null===this._yPos&&(this._yPos=this._getImgEl().getY());return this._yPos}})},"3.5.0",{requires:["base-base","node-style","node-screen"]});
