YUI.add("charts-legend",function(k){var F=k.config.doc,E={setter:function(a){var b=this.get("legend");b&&b.destroy(!0);a instanceof k.ChartLegend?(b=a,b.set("chart",this)):(a.chart=this,a.hasOwnProperty("render")||(a.render=this.get("contentBox"),a.includeInChartLayout=!0),b=new k.ChartLegend(a));return b}},z={_positionLegendItems:function(a,b,e,f,d,g,l,n,i){var e=b=0,j,c,m,h,f=this.get("width"),u,k,w,r,o,d=g.top-n,p,s,v,t;z._setRowArrays(a,f-(g.left+g.right),l);u=z.rowArray;r=z.totalWidthArray;for(k=
u.length;e<k;++e){d+=n;w=u[e];h=w.length;o=z.getStartPoint(f,r[e],i,g);for(b=0;b<h;++b)j=w[b],a=j.node,c=j.width,m=j.height,j.x=o,j.y=0,p=!isNaN(p)?Math.min(p,o):o,s=!isNaN(s)?Math.min(s,d):d,v=!isNaN(v)?Math.max(o+c,v):o+c,t=!isNaN(t)?Math.max(d+m,t):d+m,a.setStyle("left",o+"px"),a.setStyle("top",d+"px"),o+=c+l;d+=j.height}this._contentRect={left:p,top:s,right:v,bottom:t};this.get("includeInChartLayout")&&this.set("height",d+g.bottom)},_setRowArrays:function(a,b,e){for(var f=a[0],d=[[f]],g=1,l=0,
n=a.length,i=f.width,j,c=[[i]];g<n;++g)f=a[g],j=f.width,i+e+j<=b?(i+=e+j,d[l].push(f)):(i=e+j,d[l]&&(l+=1),d[l]=[f]),c[l]=i;z.rowArray=d;z.totalWidthArray=c},getStartPoint:function(a,b,e,f){var d;switch(e){case "left":d=f.left;break;case "center":d=0.5*(a-b);break;case "right":d=a-b-f.right}return d}},D={_positionLegendItems:function(a,b,e,f,d,g,l,n,i,j){var e=b=0,c,m,h,f=this.get("height"),k,q,w,r,o,d=g.left-l,p,s,v,t,y;D._setColumnArrays(a,f-(g.top+g.bottom),n);k=D.columnArray;r=D.totalHeightArray;
for(q=k.length;e<q;++e){d+=l;w=k[e];h=w.length;o=D.getStartPoint(f,r[e],j,g);for(b=p=0;b<h;++b)a=w[b],i=a.node,c=a.height,m=a.width,a.y=o,a.x=d,s=!isNaN(s)?Math.min(s,d):d,v=!isNaN(v)?Math.min(v,o):o,t=!isNaN(t)?Math.max(d+m,t):d+m,y=!isNaN(y)?Math.max(o+c,y):o+c,i.setStyle("left",d+"px"),i.setStyle("top",o+"px"),o+=c+n,p=Math.max(p,a.width);d+=p}this._contentRect={left:s,top:v,right:t,bottom:y};this.get("includeInChartLayout")&&this.set("width",d+g.right)},_setColumnArrays:function(a,b,e){for(var f=
a[0],d=[[f]],g=1,l=0,n=a.length,i=f.height,j,c=[[i]];g<n;++g)f=a[g],j=f.height,i+e+j<=b?(i+=e+j,d[l].push(f)):(i=e+j,d[l]&&(l+=1),d[l]=[f]),c[l]=i;D.columnArray=d;D.totalHeightArray=c},getStartPoint:function(a,b,e,f){var d;switch(e){case "top":d=f.top;break;case "middle":d=0.5*(a-b);break;case "bottom":d=a-b-f.bottom}return d}},G=k.Base.create("cartesianChartLegend",k.CartesianChart,[],{_redraw:function(){if(this._drawing)this._callLater=!0;else{this._drawing=!0;this._callLater=!1;var a=this.get("width"),
b=this.get("height"),e=this._getLayoutBoxDimensions(),f=e.left,d=e.right,g=e.top,l=e.bottom,e=this.get("leftAxesCollection"),n=this.get("rightAxesCollection"),i=this.get("topAxesCollection"),j=this.get("bottomAxesCollection"),c=0,m,h,k="visible",q=this.get("graph"),w,r,o,p,s;w=this.get("allowContentOverflow");var v,t,y,A,x=this.get("legend"),B,C;if(e){t=[];m=e.length;for(c=m-1;-1<c;--c)t.unshift(f),f+=e[c].get("width")}if(n){v=[];m=n.length;for(c=m-1;-1<c;--c)d+=n[c].get("width"),v.unshift(a-d)}if(i){y=
[];m=i.length;for(c=m-1;-1<c;--c)y.unshift(g),g+=i[c].get("height")}if(j){A=[];m=j.length;for(c=m-1;-1<c;--c)l+=j[c].get("height"),A.unshift(b-l)}p=f;s=g;B=b-l;C=a-d;if(!w){c=this._getTopOverflow(e,n);w=this._getBottomOverflow(e,n);r=this._getLeftOverflow(j,i);o=this._getRightOverflow(j,i);g=c-g;if(0<g&&(s=c,y)){c=0;for(m=y.length;c<m;++c)y[c]+=g}g=w-l;if(0<g&&(B=b-w,A)){c=0;for(m=A.length;c<m;++c)A[c]-=g}g=r-f;if(0<g&&(p=r,t)){c=0;for(m=t.length;c<m;++c)t[c]+=g}g=o-d;if(0<g&&(C=a-o,v)){c=0;for(m=
v.length;c<m;++c)v[c]-=g}}a=C-p;b=B-s;if(x&&x.get("includeInChartLayout"))switch(x.get("position")){case "left":x.set("y",s);x.set("height",b);break;case "top":x.set("x",p);x.set("width",a);break;case "bottom":x.set("x",p);x.set("width",a);break;case "right":x.set("y",s),x.set("height",b)}if(i){m=i.length;for(c=0;c<m;c++)h=i[c],h.get("width")!==a&&h.set("width",a),h.get("boundingBox").setStyle("left",p+"px"),h.get("boundingBox").setStyle("top",y[c]+"px");h._hasDataOverflow()&&(k="hidden")}if(j){m=
j.length;for(c=0;c<m;c++)h=j[c],h.get("width")!==a&&h.set("width",a),h.get("boundingBox").setStyle("left",p+"px"),h.get("boundingBox").setStyle("top",A[c]+"px");h._hasDataOverflow()&&(k="hidden")}if(e){m=e.length;for(c=0;c<m;++c)h=e[c],h.get("boundingBox").setStyle("top",s+"px"),h.get("boundingBox").setStyle("left",t[c]+"px"),h.get("height")!==b&&h.set("height",b);h._hasDataOverflow()&&(k="hidden")}if(n){m=n.length;for(c=0;c<m;++c)h=n[c],h.get("boundingBox").setStyle("top",s+"px"),h.get("boundingBox").setStyle("left",
v[c]+"px"),h.get("height")!==b&&h.set("height",b);h._hasDataOverflow()&&(k="hidden")}this._drawing=!1;if(this._callLater)this._redraw();else if(q&&(q.get("boundingBox").setStyle("left",p+"px"),q.get("boundingBox").setStyle("top",s+"px"),q.set("width",a),q.set("height",b),q.get("boundingBox").setStyle("overflow",k)),this._overlay)this._overlay.setStyle("left",p+"px"),this._overlay.setStyle("top",s+"px"),this._overlay.setStyle("width",a+"px"),this._overlay.setStyle("height",b+"px")}},_getLayoutBoxDimensions:function(){var a=
{top:0,right:0,bottom:0,left:0},b=this.get("legend"),e,f,d=this.get("width"),g=this.get("height"),l;if(b&&b.get("includeInChartLayout")&&(l=b.get("styles").gap,e=b.get("position"),"external"!=e))switch(f=b.get("direction"),f=b.get("horizontal"==f?"height":"width"),a[e]=f+l,e){case "top":b.set("y",0);break;case "bottom":b.set("y",g-f);break;case "right":b.set("x",d-f);break;case "left":b.set("x",0)}return a},destructor:function(){var a=this.get("legend");a&&a.destroy(!0)}},{ATTRS:{legend:E}});k.CartesianChart=
G;E=k.Base.create("pieChartLegend",k.PieChart,[],{_redraw:function(){if(this._drawing)this._callLater=!0;else{this._drawing=!0;this._callLater=!1;var a=this.get("graph"),b=this.get("width"),e=this.get("height"),f,d,g=this.get("legend"),l=0,k=0,i=0,j=0,c,m,h,u,q;if(a)if(g)if(g.get("position"),q=g.get("direction"),f=a.get("width"),d=a.get("height"),c=g.get("width"),m=g.get("height"),u=g.get("styles").gap,"vertical"==q&&f+c+u!==b||"horizontal"==q&&d+m+u!==e){switch(g.get("position")){case "left":h=Math.min(b-
(c+u),e);l=c+u;g.set("height",e);break;case "top":h=Math.min(e-(m+u),b);k=m+u;g.set("width",b);break;case "right":h=Math.min(b-(c+u),e);i=h+u;g.set("height",e);break;case "bottom":h=Math.min(e-(m+u),b),j=h+u,g.set("width",b)}a.set("width",h);a.set("height",h)}else switch(g.get("position")){case "left":l=c+u;break;case "top":k=m+u;break;case "right":i=f+u;break;case "bottom":j=d+u}else a.set("x",0),a.set("y",0),a.set("width",b),a.set("height",e);this._drawing=!1;if(this._callLater)this._redraw();else if(a&&
(a.set("x",l),a.set("y",k)),g)g.set("x",i),g.set("y",j)}}},{ATTRS:{legend:E}});k.PieChart=E;k.ChartLegend=k.Base.create("chartlegend",k.Widget,[k.Renderer],{initializer:function(){this._items=[]},renderUI:function(){var a=this.get("boundingBox"),b=this.get("contentBox"),e=this.get("styles").background,b=new k.Rect({graphic:b,fill:e.fill,stroke:e.border});a.setStyle("display","block");a.setStyle("position","absolute");this.set("background",b)},bindUI:function(){this.get("chart").after("seriesCollectionChange",
this._updateHandler);this.after("stylesChange",this._updateHandler);this.after("positionChange",this._positionChangeHandler);this.after("widthChange",this._handleSizeChange);this.after("heightChange",this._handleSizeChange)},syncUI:function(){var a=this.get("width"),b=this.get("height");isFinite(a)&&isFinite(b)&&0<a&&0<b&&this._drawLegend()},_updateHandler:function(){this.get("rendered")&&this._drawLegend()},_positionChangeHandler:function(){var a=this.get("chart");this._parentNode&&a&&this.get("includeInChartLayout")?
this.fire("legendRendered"):this.get("rendered")&&this._drawLegend()},_handleSizeChange:function(a){var a=a.attrName,b=this.get("position");(("bottom"==b||"top"==b)&&"width"==a||("left"==b||"right"==b)&&"height"==a)&&this._drawLegend()},_drawLegend:function(){if(this._drawing)this._callLater=!0;else{this._drawing=!0;this._callLater=!1;this.get("includeInChartLayout")&&this.get("chart")._itemRenderQueue.unshift(this);var a=this.get("chart"),b=this.get("contentBox"),e=a.get("seriesCollection"),f,d=
this.get("styles"),g=d.padding,l=d.item,n,i=l.hSpacing,j=l.vSpacing,c=d.hAlign,m=d.vAlign;f=d.marker;var l=l.label,h,u=this._layout[this.get("direction")],q,w,r,o,p,s,v,t=[],y=f.width,A=f.height,x=0-i,B=0-j,C=0,z=0;f&&f.shape&&(r=f.shape);this._destroyLegendItems();if(a instanceof k.PieChart){f=e[0];h=f.get("categoryAxis").getDataByKey(f.get("categoryKey"));n=f.get("styles").marker;e=n.fill.colors;s=n.border.colors;v=n.border.weight;q=0;w=h.length;r=r||k.Circle;for(n=k.Lang.isArray(r);q<w;++q)r=n?
r[q]:r,o={color:e[q]},p={colors:s[q],weight:v},h=a.getSeriesItems(f,q).category.value,h=this._getLegendItem(b,this._getShapeClass(r),o,p,l,y,A,h),o=h.width,p=h.height,C=Math.max(C,o),z=Math.max(z,p),x+=o+i,B+=p+j,t.push(h)}else{q=0;for(w=e.length;q<w;++q)f=e[q],n=this._getStylesBySeriesType(f,r),r||(r=n.shape,r||(r=k.Circle)),k.Lang.isArray(r),h=this._getLegendItem(b,this._getShapeClass(r),n.fill,n.border,l,y,A,f.get("valueDisplayName")),o=h.width,p=h.height,C=Math.max(C,o),z=Math.max(z,p),x+=o+i,
B+=p+j,t.push(h)}this.set("items",t);this._drawing=!1;this._callLater?this._drawLegend():(u._positionLegendItems.apply(this,[t,C,z,x,B,g,i,j,c,m]),this._updateBackground(d),this.fire("legendRendered"))}},_updateBackground:function(a){var b=a.background,e=this._contentRect,f=a.padding,a=e.left-f.left,d=e.top-f.top,g=e.right-a+f.right,e=e.bottom-d+f.bottom;this.get("background").set({fill:b.fill,stroke:b.border,width:g,height:e,x:a,y:d})},_getStylesBySeriesType:function(a){var b=a.get("styles");if(a instanceof
k.LineSeries||a instanceof k.StackedLineSeries)return b=a.get("styles").line,{border:{weight:1,color:b.color},fill:{color:b.color}};if(a instanceof k.AreaSeries||a instanceof k.StackedAreaSeries)return a.get("styles"),{border:{weight:1,color:b.color},fill:{color:b.color}};b=a.get("styles").marker;return{fill:b.fill,border:{weight:b.border.weight,color:b.border.color,shape:b.shape},shape:b.shape}},_getLegendItem:function(a,b,e,f,d,g,l,n){var i=k.one(F.createElement("div")),j=k.one(F.createElement("span")),
c;i.setStyle("position","absolute");j.setStyle("position","absolute");j.setStyles(d);j.appendChild(F.createTextNode(n));i.appendChild(j);a.appendChild(i);a=j.get("offsetHeight");d=a-l;c=g+d+2;j.setStyle("left",c+"px");i.setStyle("height",a+"px");i.setStyle("width",c+j.get("offsetWidth")+"px");b=new b({fill:e,stroke:f,width:g,height:l,x:0.5*d,y:0.5*d,w:g,h:l,graphic:i});j.setStyle("left",a+"px");n={node:i,width:i.get("offsetWidth"),height:i.get("offsetHeight"),shape:b,textNode:j,text:n};this._items.push(n);
return n},_getShapeClass:function(){var a=this.get("background").get("graphic");return a._getShapeClass.apply(a,arguments)},_getDefaultStyles:function(){return{padding:{top:8,right:8,bottom:8,left:9},gap:10,hAlign:"center",vAlign:"top",marker:this._getPlotDefaults(),item:{hSpacing:10,vSpacing:5,label:{color:"#808080",fontSize:"85%"}},background:{shape:"rect",fill:{color:"#faf9f2"},border:{color:"#dad8c9",weight:1}}}},_getPlotDefaults:function(){return{width:10,height:10}},_destroyLegendItems:function(){var a;
if(this._items)for(;0<this._items.length;)a=this._items.shift(),a.shape.get("graphic").destroy(),a.node.empty(),a.node.remove(!0);this._items=[]},_layout:{vertical:D,horizontal:z},destructor:function(){var a=this.get("graphic");this._destroyLegendItems();a&&a.destroy()}},{ATTRS:{includeInChartLayout:{value:!1},chart:{setter:function(a){this.after("legendRendered",k.bind(a._itemRendered,a));return a}},direction:{value:"vertical"},position:{lazyAdd:!1,value:"right",setter:function(a){"top"==a||"bottom"==
a?this.set("direction","horizontal"):("left"==a||"right"==a)&&this.set("direction","vertical");return a}},width:{getter:function(){var a=this.get("chart"),b=this._parentNode;return b?a&&this.get("includeInChartLayout")||this._width?(this._width||(this._width=0),this._width):b.get("offsetWidth"):""},setter:function(a){return this._width=a}},height:{valueFn:"_heightGetter",getter:function(){var a=this.get("chart"),b=this._parentNode;return b?a&&this.get("includeInChartLayout")||this._height?(this._height||
(this._height=0),this._height):b.get("offsetHeight"):""},setter:function(a){return this._height=a}},x:{lazyAdd:!1,value:0,setter:function(a){var b=this.get("boundingBox");b&&b.setStyle("left",a+"px");return a}},y:{lazyAdd:!1,value:0,setter:function(a){var b=this.get("boundingBox");b&&b.setStyle("top",a+"px");return a}},background:{}}});k.Chart=function(a){return"pie"!=a.type?new k.CartesianChart(a):new k.PieChart(a)}},"3.5.0",{requires:["charts-base"]});
