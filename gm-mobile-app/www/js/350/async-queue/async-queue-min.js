YUI.add("async-queue",function(c){c.AsyncQueue=function(){this._init();this.add.apply(this,arguments)};var d=c.AsyncQueue,f=c.Lang.isObject,e=c.Lang.isFunction;d.defaults=c.mix({autoContinue:!0,iterations:1,timeout:10,until:function(){this.iterations|=0;return 0>=this.iterations}},c.config.queueDefaults||{});c.extend(d,c.EventTarget,{_running:!1,_init:function(){c.EventTarget.call(this,{prefix:"queue",emitFacade:!0});this._q=[];this.defaults={};this._initEvents()},_initEvents:function(){this.publish({execute:{defaultFn:this._defExecFn,
emitFacade:!0},shift:{defaultFn:this._defShiftFn,emitFacade:!0},add:{defaultFn:this._defAddFn,emitFacade:!0},promote:{defaultFn:this._defPromoteFn,emitFacade:!0},remove:{defaultFn:this._defRemoveFn,emitFacade:!0}})},next:function(){for(var a;this._q.length;)if((a=this._q[0]=this._prepare(this._q[0]))&&a.until())this.fire("shift",{callback:a}),a=null;else break;return a||null},_defShiftFn:function(a){0===this.indexOf(a.callback)&&this._q.shift()},_prepare:function(a){if(e(a)&&a._prepared)return a;
var a=c.merge(d.defaults,{context:this,args:[],_prepared:!0},this.defaults,e(a)?{fn:a}:a),b=c.bind(function(){b._running||b.iterations--;e(b.fn)&&b.fn.apply(b.context||c,c.Array(b.args))},this);return c.mix(b,a)},run:function(){var a,b=!0;for(a=this.next();b&&a&&!this.isRunning();a=this.next())b=0>a.timeout?this._execute(a):this._schedule(a);a||this.fire("complete");return this},_execute:function(a){this._running=a._running=!0;a.iterations--;this.fire("execute",{callback:a});var b=this._running&&
a.autoContinue;this._running=a._running=!1;return b},_schedule:function(a){this._running=c.later(a.timeout,this,function(){this._execute(a)&&this.run()});return!1},isRunning:function(){return!!this._running},_defExecFn:function(a){a.callback()},add:function(){this.fire("add",{callbacks:c.Array(arguments,0,!0)});return this},_defAddFn:function(a){var b=this._q,g=[];c.Array.each(a.callbacks,function(a){f(a)&&(b.push(a),g.push(a))});a.added=g},pause:function(){f(this._running)&&this._running.cancel();
this._running=!1;return this},stop:function(){this._q=[];return this.pause()},indexOf:function(a){for(var b=0,c=this._q.length,d;b<c;++b)if(d=this._q[b],d===a||d.id===a)return b;return-1},getCallback:function(a){a=this.indexOf(a);return-1<a?this._q[a]:null},promote:function(a){var b={callback:a},c;this.isRunning()?c=this.after("shift",function(){this.fire("promote",b);c.detach()},this):this.fire("promote",b);return this},_defPromoteFn:function(a){var b=this.indexOf(a.callback),b=-1<b?this._q.splice(b,
1)[0]:null;(a.promoted=b)&&this._q.unshift(b)},remove:function(a){var b={callback:a},c;this.isRunning()?c=this.after("shift",function(){this.fire("remove",b);c.detach()},this):this.fire("remove",b);return this},_defRemoveFn:function(a){var b=this.indexOf(a.callback);a.removed=-1<b?this._q.splice(b,1)[0]:null},size:function(){this.isRunning()||this.next();return this._q.length}})},"3.5.0",{requires:["event-custom"]});
