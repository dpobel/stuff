YUI.add("editor-bidi",function(f){var e=function(){e.superclass.constructor.apply(this,arguments)};f.extend(e,f.Base,{lastDirection:null,firstEvent:null,_checkForChange:function(){var b=this.get("host"),a=new (b.getInstance().EditorSelection);if(a.isCollapsed){if(a=e.blockParent(a.focusNode))a=a.getStyle("direction"),a!==this.lastDirection&&(b.fire("bidiContextChange",{changedTo:a}),this.lastDirection=a)}else b.fire("bidiContextChange",{changedTo:"select"}),this.lastDirection=null},_afterNodeChange:function(b){if(this.firstEvent||
e.EVENTS[b.changedType])this._checkForChange(),this.firstEvent=!1},_afterMouseUp:function(){this._checkForChange();this.firstEvent=!1},initializer:function(){var b=this.get("host");this.firstEvent=!0;b.after("nodeChange",f.bind(this._afterNodeChange,this));b.after("dom:mouseup",f.bind(this._afterMouseUp,this))}},{EVENTS:{"backspace-up":!0,"pageup-up":!0,"pagedown-down":!0,"end-up":!0,"home-up":!0,"left-up":!0,"up-up":!0,"right-up":!0,"down-up":!0,"delete-up":!0},BLOCKS:f.EditorSelection.BLOCKS,DIV_WRAPPER:"<DIV></DIV>",
blockParent:function(b,a){var c=b,d,g;c||(c=f.one("BODY"));c.test(e.BLOCKS)||(c=c.ancestor(e.BLOCKS));a&&c.test("BODY")&&(d=f.Node.create(e.DIV_WRAPPER),c.get("children").each(function(a,b){0===b?g=a:d.append(a)}),g.replace(d),d.prepend(g),c=d);return c},_NODE_SELECTED:"bidiSelected",addParents:function(b){var a,c,d;for(a=0;a<b.length;a+=1)b[a].setData(e._NODE_SELECTED,!0);for(a=0;a<b.length;a+=1)c=b[a].get("parentNode"),!c.test("BODY")&&!c.getData(e._NODE_SELECTED)&&(d=!0,c.get("children").some(function(a){if(!a.getData(e._NODE_SELECTED)){d=
false;return true}}),d&&(b.push(c),c.setData(e._NODE_SELECTED,!0)));for(a=0;a<b.length;a+=1)b[a].clearData(e._NODE_SELECTED);return b},NAME:"editorBidi",NS:"editorBidi",ATTRS:{host:{value:!1}},RE_TEXT_ALIGN:/text-align:\s*\w*\s*;/,removeTextAlign:function(b){b&&(b.getAttribute("style").match(e.RE_TEXT_ALIGN)&&b.setAttribute("style",b.getAttribute("style").replace(e.RE_TEXT_ALIGN,"")),b.hasAttribute("align")&&b.removeAttribute("align"));return b}});f.namespace("Plugin");f.Plugin.EditorBidi=e;f.Plugin.ExecCommand.COMMANDS.bidi=
function(b,a){var c=this.getInstance(),d=new c.EditorSelection,g=this.get("host").get("host").editorBidi,h,i;if(g)return c.EditorSelection.filterBlocks(),d.isCollapsed?((d=e.blockParent(d.anchorNode))||(d=c.one("body").one(c.EditorSelection.BLOCKS)),d=e.removeTextAlign(d),a||(i=d.getAttribute("dir"),a=!i||"ltr"==i?"rtl":"ltr"),d.setAttribute("dir",a),f.UA.ie&&(c=d.all("br.yui-cursor"),1===c.size()&&1==d.get("childNodes").size()&&c.remove()),c=d):(d=d.getSelected(),h=[],d.each(function(a){h.push(e.blockParent(a))}),
h=c.all(e.addParents(h)),h.each(function(b){var c=a,b=e.removeTextAlign(b);c||(i=b.getAttribute("dir"),c=!i||"ltr"==i?"rtl":"ltr");b.setAttribute("dir",c)}),c=h),g._checkForChange(),c;f.error("bidi execCommand is not available without the EditorBiDi plugin.")}},"3.5.0",{skinnable:!1,requires:["editor-base"]});
