YUI.add("autocomplete-base",function(e){function g(){}var o=e.Escape,f=e.Lang,k=e.Array,p=e.Object,i=f.isFunction,n=f.isString,l=f.trim,j=e.Attribute.INVALID_VALUE,m="_sourceSuccess";g.prototype={initializer:function(){e.before(this._bindUIACBase,this,"bindUI");e.before(this._syncUIACBase,this,"syncUI");this.publish("clear",{defaultFn:this._defClearFn});this.publish("query",{defaultFn:this._defQueryFn});this.publish("results",{defaultFn:this._defResultsFn})},destructor:function(){this._acBaseEvents&&
this._acBaseEvents.detach();delete this._acBaseEvents;delete this._cache;delete this._inputNode;delete this._rawSource},clearCache:function(){this._cache&&(this._cache={});return this},sendRequest:function(a,b){var c,d=this.get("source");a||""===a?this._set("query",a):a=this.get("query")||"";d&&(b||(b=this.get("requestTemplate")),c=b?b.call(this,a):a,d.sendRequest({query:a,request:c,callback:{success:e.bind(this._onResponse,this,a)}}));return this},_bindUIACBase:function(){var a=this.get("inputNode"),
b=a&&a.tokenInput;b&&(a=b.get("inputNode"),this._set("tokenInput",b));a?(this._inputNode=a,this._acBaseEvents=new e.EventHandle([a.on("valueChange",this._onInputValueChange,this),a.on("blur",this._onInputBlur,this),this.after("allowBrowserAutocompleteChange",this._syncBrowserAutocomplete),this.after("sourceTypeChange",this._afterSourceTypeChange),this.after("valueChange",this._afterValueChange)])):e.error("No inputNode specified.")},_syncUIACBase:function(){this._syncBrowserAutocomplete();this.set("value",
this.get("inputNode").get("value"))},_createArraySource:function(a){var b=this;return{type:"array",sendRequest:function(c){b[m](a.concat(),c)}}},_createFunctionSource:function(a){var b=this;return{type:"function",sendRequest:function(c){function d(a){b[m](a||[],c)}var h;(h=a(c.query,d))&&d(h)}}},_createObjectSource:function(a){var b=this;return{type:"object",sendRequest:function(c){var d=c.query;b[m](p.owns(a,d)?a[d]:[],c)}}},_functionValidator:function(a){return null===a||i(a)},_getObjectValue:function(a,
b){if(a){for(var c=0,d=b.length;a&&c<d;c++)a=a[b[c]];return a}},_parseResponse:function(a,b,c){var c={data:c,query:a,results:[]},d=this.get("resultListLocator"),h=[],e=b&&b.results,f,g,i,j;e&&d&&(e=d.call(this,e));if(e&&e.length){f=this.get("resultFilters");j=this.get("resultTextLocator");b=0;for(d=e.length;b<d;++b)g=e[b],i=j?j.call(this,g):g.toString(),h.push({display:o.html(i),raw:g,text:i});b=0;for(d=f.length;b<d;++b){h=f[b].call(this,a,h.concat());if(!h)return;if(!h.length)break}if(h.length){e=
this.get("resultFormatter");b=this.get("resultHighlighter");if((d=this.get("maxResults"))&&0<d&&h.length>d)h.length=d;if(b){f=b.call(this,a,h.concat());if(!f)return;b=0;for(d=f.length;b<d;++b)g=h[b],g.highlighted=f[b],g.display=g.highlighted}if(e){a=e.call(this,a,h.concat());if(!a)return;b=0;for(d=a.length;b<d;++b)h[b].display=a[b]}}}c.results=h;this.fire("results",c)},_parseValue:function(a){var b=this.get("queryDelimiter");b&&(a=a.split(b),a=a[a.length-1]);return f.trimLeft(a)},_setEnableCache:function(a){this._cache=
a?{}:null},_setLocator:function(a){if(this._functionValidator(a))return a;var b=this,a=a.toString().split(".");return function(c){return c&&b._getObjectValue(c,a)}},_setRequestTemplate:function(a){if(this._functionValidator(a))return a;a=a.toString();return function(b){return f.sub(a,{query:encodeURIComponent(b)})}},_setResultFilters:function(a){var b,c;if(null===a)return[];b=e.AutoCompleteFilters;c=function(a){return i(a)?a:n(a)&&b&&i(b[a])?b[a]:!1};return f.isArray(a)?(a=k.map(a,c),k.every(a,function(a){return!!a})?
a:j):(a=c(a))?[a]:j},_setResultHighlighter:function(a){var b;if(this._functionValidator(a))return a;b=e.AutoCompleteHighlighters;return n(a)&&b&&i(b[a])?b[a]:j},_setSource:function(a){var b=this.get("sourceType")||f.type(a),c;if(a&&i(a.sendRequest)||null===a||"datasource"===b)return this._rawSource=a;if(c=g.SOURCE_TYPES[b])return this._rawSource=a,f.isString(c)?this[c](a):c(a);e.error("Unsupported source type '"+b+"'. Maybe autocomplete-sources isn't loaded?");return j},_sourceSuccess:function(a,
b){b.callback.success({data:a,response:{results:a}})},_syncBrowserAutocomplete:function(){var a=this.get("inputNode");"input"===a.get("nodeName").toLowerCase()&&a.setAttribute("autocomplete",this.get("allowBrowserAutocomplete")?"on":"off")},_updateValue:function(a){var b=this.get("queryDelimiter"),c,d,a=f.trimLeft(a);b&&(c=l(b),d=k.map(l(this.get("value")).split(b),l),b=d.length,1<b&&(d[b-1]=a,a=d.join(c+" ")),a=a+c+" ");this.set("value",a)},_afterSourceTypeChange:function(){this._rawSource&&this.set("source",
this._rawSource)},_afterValueChange:function(a){var b=a.newVal,c=this,d=a.src===g.UI_SRC,e,f;d||c._inputNode.set("value",b);e=c.get("minQueryLength");f=c._parseValue(b)||"";0<=e&&f.length>=e?d?(d=c.get("queryDelay"),e=function(){c.fire("query",{inputValue:b,query:f,src:a.src})},d?(clearTimeout(c._delay),c._delay=setTimeout(e,d)):e()):c._set("query",f):(clearTimeout(c._delay),c.fire("clear",{prevVal:a.prevVal?c._parseValue(a.prevVal):null,src:a.src}))},_onInputBlur:function(){var a=this.get("queryDelimiter"),
b,c,d;if(a&&!this.get("allowTrailingDelimiter")){a=f.trimRight(a);d=c=this._inputNode.get("value");if(a)for(;(c=f.trimRight(c))&&(b=c.length-a.length)&&c.lastIndexOf(a)===b;)c=c.substring(0,b);else c=f.trimRight(c);c!==d&&this.set("value",c)}},_onInputValueChange:function(a){a=a.newVal;a!==this.get("value")&&this.set("value",a,{src:g.UI_SRC})},_onResponse:function(a,b){if(a===(this.get("query")||""))this._parseResponse(a||"",b.response,b.data)},_defClearFn:function(){this._set("query",null);this._set("results",
[])},_defQueryFn:function(a){this.sendRequest(a.query)},_defResultsFn:function(a){this._set("results",a.results)}};g.ATTRS={allowBrowserAutocomplete:{value:!1},allowTrailingDelimiter:{value:!1},enableCache:{lazyAdd:!1,setter:"_setEnableCache",value:!0},inputNode:{setter:e.one,writeOnce:"initOnly"},maxResults:{value:0},minQueryLength:{value:1},query:{readOnly:!0,value:null},queryDelay:{value:100},queryDelimiter:{value:null},requestTemplate:{setter:"_setRequestTemplate",value:null},resultFilters:{setter:"_setResultFilters",
value:[]},resultFormatter:{validator:"_functionValidator",value:null},resultHighlighter:{setter:"_setResultHighlighter",value:null},resultListLocator:{setter:"_setLocator",value:null},results:{readOnly:!0,value:[]},resultTextLocator:{setter:"_setLocator",value:null},source:{setter:"_setSource",value:null},sourceType:{value:null},tokenInput:{readOnly:!0},value:{value:""}};g._buildCfg={aggregates:["SOURCE_TYPES"],statics:["UI_SRC"]};g.SOURCE_TYPES={array:"_createArraySource","function":"_createFunctionSource",
object:"_createObjectSource"};g.UI_SRC=e.Widget&&e.Widget.UI_SRC||"ui";e.AutoCompleteBase=g},"3.5.0",{requires:["array-extras","base-build","escape","event-valuechange","node-base"],optional:["autocomplete-sources"]});
