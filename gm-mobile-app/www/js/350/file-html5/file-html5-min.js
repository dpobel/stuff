YUI.add("file-html5",function(f){var i=f.bind,c=f.config.win,d=function(a){var b=null,b=d.isValidFile(a)?a:d.isValidFile(a.file)?a.file:!1;d.superclass.constructor.apply(this,arguments);if(b&&d.canUpload()){this.get("file")||this._set("file",b);this.get("name")||this._set("name",b.name||b.fileName);if(this.get("size")!=(b.size||b.fileSize))this._set("size",b.size||b.fileSize);this.get("type")||this._set("type",b.type);b.hasOwnProperty("lastModifiedDate")&&!this.get("dateModified")&&this._set("dateModified",
b.lastModifiedDate)}};f.extend(d,f.Base,{initializer:function(){this.get("id")||this._set("id",f.guid("file"))},_uploadEventHandler:function(a){switch(a.type){case "progress":this.fire("uploadprogress",{originEvent:a,bytesLoaded:a.loaded,bytesTotal:this.get("size"),percentLoaded:Math.min(100,Math.round(1E4*a.loaded/this.get("size"))/100)});this._set("bytesUploaded",a.loaded);break;case "load":this.fire("uploadcomplete",{originEvent:a,data:a.target.responseText});var a=this.get("xhr").upload,b=this.get("xhr"),
e=this.get("boundEventHandler");a.removeEventListener("progress",e);a.removeEventListener("error",e);a.removeEventListener("abort",e);b.removeEventListener("load",e);b.removeEventListener("readystatechange",e);this._set("xhr",null);break;case "error":b=this.get("xhr");this.fire("uploaderror",{originEvent:a,status:b.status,statusText:b.statusText});break;case "abort":this.fire("uploadcancel",{originEvent:a});break;case "readystatechange":this.fire("readystatechange",{readyState:a.target.readyState,
originEvent:a})}},startUpload:function(a,b,e){this._set("bytesUploaded",0);this._set("xhr",new XMLHttpRequest);this._set("boundEventHandler",i(this._uploadEventHandler,this));var d=new FormData,e=e||"Filedata",c=this.get("xhr"),h=this.get("xhr").upload,g=this.get("boundEventHandler");f.each(b,function(a,b){d.append(b,a)});d.append(e,this.get("file"));h.addEventListener("progress",g,!1);h.addEventListener("error",g,!1);h.addEventListener("abort",g,!1);c.addEventListener("load",g,!1);c.addEventListener("readystatechange",
g,!1);c.open("POST",a,!0);c.send(d);this.fire("uploadstart",{xhr:c})},cancelUpload:function(){this.get("xhr").abort()}},{NAME:"file",TYPE:"html5",ATTRS:{id:{writeOnce:"initOnly",value:null},size:{writeOnce:"initOnly",value:0},name:{writeOnce:"initOnly",value:null},dateCreated:{writeOnce:"initOnly",value:null},dateModified:{writeOnce:"initOnly",value:null},bytesUploaded:{readOnly:!0,value:0},type:{writeOnce:"initOnly",value:null},file:{writeOnce:"initOnly",value:null},xhr:{readOnly:!0,value:null},
boundEventHandler:{readOnly:!0,value:null}},isValidFile:function(a){return c&&c.File&&a instanceof File},canUpload:function(){return c&&c.FormData&&c.XMLHttpRequest}});f.FileHTML5=d},"3.5.0",{requires:["base"]});
