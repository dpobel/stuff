YUI.add("widget-buttons",function(e){function f(){this._stdModNode||e.error("WidgetStdMod must be added to a Widget before WidgetButtons.");this._buttonsHandles={}}var i=e.Array,m=e.Lang,j=e.Object,q=e.Plugin.Button,r=e.Widget,o=e.WidgetStdMod,s=e.ClassNameManager.getClassName,t=m.isArray,p=m.isNumber,n=m.isString,u=m.isValue;f.ATTRS={buttons:{getter:"_getButtons",setter:"_setButtons",value:{}},defaultButton:{readOnly:!0,value:null}};f.CLASS_NAMES={button:s("button"),buttons:r.getClassName("buttons"),
primary:s("button","primary")};f.HTML_PARSER={buttons:function(a){return this._parseButtons(a)}};f.NON_BUTTON_NODE_CFG="action,classNames,context,events,isDefault,section".split(",");f.prototype={BUTTONS:{},BUTTONS_TEMPLATE:"<span />",DEFAULT_BUTTONS_SECTION:o.FOOTER,initializer:function(){this._mapButtons(this.get("buttons"));this._updateDefaultButton();this.after("buttonsChange",e.bind("_afterButtonsChange",this));e.after(this._bindUIButtons,this,"bindUI");e.after(this._syncUIButtons,this,"syncUI")},
destructor:function(){j.each(this._buttonsHandles,function(a){a.detach()});delete this._buttonsHandles;delete this._buttonsMap;delete this._defaultButton},addButton:function(a,b,c){var d=this.get("buttons"),k;e.instanceOf(a,e.Node)||(a=this._mergeButtonConfig(a),b||(b=a.section));b||(b=this.DEFAULT_BUTTONS_SECTION);k=d[b]||(d[b]=[]);p(c)||(c=k.length);k.splice(c,0,a);this.set("buttons",d,{button:a,section:b,index:c,src:"add"});return this},getButton:function(a,b){if(u(a)){var c=this._buttonsMap;b||
(b=this.DEFAULT_BUTTONS_SECTION);return p(a)?(c=this.get("buttons"),c[b]&&c[b][a]):1<arguments.length?c[b+":"+a]:c[a]}},removeButton:function(a,b){if(!u(a))return this;var c=this.get("buttons"),d;p(a)?(b||(b=this.DEFAULT_BUTTONS_SECTION),d=a,a=c[b][d]):(n(a)&&(a=this.getButton.apply(this,arguments)),j.some(c,function(c,e){d=i.indexOf(c,a);if(-1<d)return b=e,!0}));a&&-1<d&&(c[b].splice(d,1),this.set("buttons",c,{button:a,section:b,index:d,src:"remove"}));return this},_bindUIButtons:function(){var a=
e.bind("_afterContentChangeButtons",this);this.after({defaultButtonChange:e.bind("_afterDefaultButtonChange",this),visibleChange:e.bind("_afterVisibleChangeButtons",this),headerContentChange:a,bodyContentChange:a,footerContentChange:a})},_createButton:function(a){var b,c,d,k;if(e.instanceOf(a,e.Node))return a.plug(q);b=e.merge({context:this,events:"click",label:a.value},a);a=e.merge(b);c=f.NON_BUTTON_NODE_CFG;d=0;for(k=c.length;d<k;d+=1)delete a[c[d]];a=q.createNode(a);d=b.context;c=b.action;n(c)&&
(c=e.bind(c,d));c=a.on(b.events,c,d);this._buttonsHandles[e.stamp(a,!0)]=c;a.setData("name",this._getButtonName(b));a.setData("default",this._getButtonDefault(b));i.each(i(b.classNames),a.addClass,a);return a},_getButtonContainer:function(a,b){var c=o.SECTION_CLASS_NAMES[a],d=f.CLASS_NAMES.buttons,c=this.get("contentBox").one("."+c+" ."+d);!c&&b&&(c=e.Node.create(this.BUTTONS_TEMPLATE),c.addClass(d));return c},_getButtonDefault:function(a){a=e.instanceOf(a,e.Node)?a.getData("default"):a.isDefault;
return n(a)?"true"===a.toLowerCase():!!a},_getButtonName:function(a){return e.instanceOf(a,e.Node)?a.getData("name")||a.get("name"):a&&(a.name||a.type)},_getButtons:function(a){var b={};j.each(a,function(a,d){b[d]=a.concat()});return b},_mapButton:function(a,b){var c=this._buttonsMap,d=this._getButtonName(a),e=this._getButtonDefault(a);d&&(c[d]=a,c[b+":"+d]=a);e&&(this._defaultButton=a)},_mapButtons:function(a){this._buttonsMap={};this._defaultButton=null;j.each(a,function(a,c){var d,e;d=0;for(e=
a.length;d<e;d+=1)this._mapButton(a[d],c)},this)},_mergeButtonConfig:function(a){var b,c,a=n(a)?{name:a}:e.merge(a);a.srcNode&&(b=a.srcNode,c=b.get("tagName").toLowerCase(),c=b.get("input"===c?"value":"text"),b={disabled:!!b.get("disabled"),isDefault:this._getButtonDefault(b),name:this._getButtonName(b)},c&&(b.label=c),e.mix(a,b,!1,null,0,!0));b=this._getButtonName(a);(b=this.BUTTONS&&this.BUTTONS[b])&&e.mix(a,b,!1,null,0,!0);return a},_parseButtons:function(){var a="."+f.CLASS_NAMES.button,b=null;
i.each(["header","body","footer"],function(c){var d=this._getButtonContainer(c),d=d&&d.all(a),e;d&&!d.isEmpty()&&(e=[],d.each(function(a){e.push({srcNode:a})}),b||(b={}),b[c]=e)},this);return b},_setButtons:function(a){function b(a,b){if(t(a)){var f,l,g,h;f=0;for(l=a.length;f<l;f+=1)g=a[f],h=b,e.instanceOf(g,e.Node)||(g=this._mergeButtonConfig(g),h||(h=g.section)),g=this._createButton(g),h||(h=c),(d[h]||(d[h]=[])).push(g)}}var c=this.DEFAULT_BUTTONS_SECTION,d={};t(a)?b.call(this,a):j.each(a,b,this);
return d},_syncUIButtons:function(){this._uiSetButtons(this.get("buttons"));this._uiSetDefaultButton(this.get("defaultButton"));this._uiSetVisibleButtons(this.get("visible"))},_uiInsertButton:function(a,b,c){var d=f.CLASS_NAMES.button,e=this._getButtonContainer(b,!0),d=e.all("."+d);e.insertBefore(a,d.item(c));this.setStdModContent(b,e,"after")},_uiRemoveButton:function(a,b,c){var d=e.stamp(a,this),k=this._buttonsHandles,v=k[d];v&&v.detach();delete k[d];a.remove();c||(c={});c.preserveContent||(a=this._getButtonContainer(b),
c=f.CLASS_NAMES.button,a&&a.all("."+c).isEmpty()&&(a.remove(),this._updateContentButtons(b)))},_uiSetButtons:function(a){var b=f.CLASS_NAMES.button;i.each(["header","body","footer"],function(c){var d=a[c]||[],e=d.length,f=this._getButtonContainer(c,e),i=!1,l,g,h,j;if(f){l=f.all("."+b);for(g=0;g<e;g+=1)h=d[g],j=l?l.indexOf(h):-1,-1<j?(l.splice(j,1),j!==g&&(f.insertBefore(h,g+1),i=!0)):(f.appendChild(h),i=!0);l.each(function(a){this._uiRemoveButton(a,c,{preserveContent:!0});i=!0},this);0===e?(f.remove(),
this._updateContentButtons(c)):i&&this.setStdModContent(c,f,"after")}},this)},_uiSetDefaultButton:function(a,b){var c=f.CLASS_NAMES.primary;a&&a.addClass(c);b&&b.removeClass(c)},_uiSetVisibleButtons:function(a){a&&(a=this.get("defaultButton"))&&a.focus()},_unMapButton:function(a,b){var c=this._buttonsMap,d=this._getButtonName(a);d&&(c[d]===a&&delete c[d],d=b+":"+d,c[d]===a&&delete c[d]);this._defaultButton===a&&(this._defaultButton=null)},_updateDefaultButton:function(){var a=this._defaultButton;
this.get("defaultButton")!==a&&this._set("defaultButton",a)},_updateContentButtons:function(a){var b=this.getStdModNode(a).get("childNodes");this.set(a+"Content",b.isEmpty()?null:b,{src:"buttons"})},_afterButtonsChange:function(a){var b=a.newVal,c=a.section,d=a.index,e=a.src;"add"===e?(a=b[c][d],this._mapButton(a,c),this._updateDefaultButton(),this._uiInsertButton(a,c,d)):"remove"===e?(a=a.button,this._unMapButton(a,c),this._updateDefaultButton(),this._uiRemoveButton(a,c)):(this._mapButtons(b),this._updateDefaultButton(),
this._uiSetButtons(b))},_afterContentChangeButtons:function(a){var b=a.src,a=a.stdModPosition;(!a||a===o.REPLACE)&&"buttons"!==b&&b!==r.UI_SRC&&this._uiSetButtons(this.get("buttons"))},_afterDefaultButtonChange:function(a){this._uiSetDefaultButton(a.newVal,a.prevVal)},_afterVisibleChangeButtons:function(a){this._uiSetVisibleButtons(a.newVal)}};e.WidgetButtons=f},"3.5.0",{requires:["button-plugin","cssbutton","widget-stdmod"]});
