YUI.add("console-filters",function(c){function g(){g.superclass.constructor.apply(this,arguments)}var h=c.ClassNameManager.getClassName,j="."+c.Console.CHROME_CLASSES.console_bd_class,k="."+c.Console.CHROME_CLASSES.console_ft_class,i=c.Lang.isString;c.namespace("Plugin").ConsoleFilters=c.extend(g,c.Plugin.Base,{_entries:null,_cacheLimit:Number.POSITIVE_INFINITY,_categories:null,_sources:null,initializer:function(){this._entries=[];this.get("host").on("entry",this._onEntry,this);this.doAfter("renderUI",
this.renderUI);this.doAfter("syncUI",this.syncUI);this.doAfter("bindUI",this.bindUI);this.doAfter("clearConsole",this._afterClearConsole);this.get("host").get("rendered")&&(this.renderUI(),this.syncUI(),this.bindUI());this.after("cacheLimitChange",this._afterCacheLimitChange)},destructor:function(){this._entries=[];this._categories&&this._categories.remove();this._sources&&this._sources.remove()},renderUI:function(){var a=this.get("host").get("contentBox").one(k),b;a&&(b=c.substitute(g.CATEGORIES_TEMPLATE,
g.CHROME_CLASSES),this._categories=a.appendChild(c.Node.create(b)),b=c.substitute(g.SOURCES_TEMPLATE,g.CHROME_CLASSES),this._sources=a.appendChild(c.Node.create(b)))},bindUI:function(){this._categories.on("click",c.bind(this._onCategoryCheckboxClick,this));this._sources.on("click",c.bind(this._onSourceCheckboxClick,this));this.after("categoryChange",this._afterCategoryChange);this.after("sourceChange",this._afterSourceChange)},syncUI:function(){c.each(this.get("category"),function(a,b){this._uiSetCheckbox("category",
b,a)},this);c.each(this.get("source"),function(a,b){this._uiSetCheckbox("source",b,a)},this);this.refreshConsole()},_onEntry:function(a){this._entries.push(a.message);var b="category."+a.message.category,c="source."+a.message.source,d=this.get(b),e=this.get(c),f=this._entries.length-this._cacheLimit;0<f&&this._entries.splice(0,f);void 0===d&&(f=this.get("defaultVisibility"),this.set(b,f),d=f);void 0===e&&(f=this.get("defaultVisibility"),this.set(c,f),e=f);(!d||!e)&&a.preventDefault()},_afterClearConsole:function(){this._entries=
[]},_afterCategoryChange:function(a){var b=a.subAttrName.replace(/category\./,""),c=a.prevVal,d=a.newVal;if(!b||void 0!==c[b])this.refreshConsole(),this._filterBuffer();b&&!a.fromUI&&this._uiSetCheckbox("category",b,d[b])},_afterSourceChange:function(a){var b=a.subAttrName.replace(/source\./,""),c=a.prevVal,d=a.newVal;if(!b||void 0!==c[b])this.refreshConsole(),this._filterBuffer();b&&!a.fromUI&&this._uiSetCheckbox("source",b,d[b])},_filterBuffer:function(){var a=this.get("category"),b=this.get("source"),
c=this.get("host").buffer,d=null,e;for(e=c.length-1;0<=e;--e)!a[c[e].category]||!b[c[e].source]?d=d||e:d&&(c.splice(e,d-e),d=null);d&&c.splice(0,d+1)},_afterCacheLimitChange:function(a){isFinite(a.newVal)&&(a=this._entries.length-a.newVal,0<a&&this._entries.splice(0,a))},refreshConsole:function(){var a=this._entries,b=this.get("host"),c=b.get("contentBox").one(j),d=b.get("consoleLimit"),e=this.get("category"),f=this.get("source"),g=[],h,i;if(c){b._cancelPrintLoop();for(h=a.length-1;0<=h&&0<=d;--h)i=
a[h],e[i.category]&&f[i.source]&&(g.unshift(i),--d);c.setContent("");b.buffer=g;b.printBuffer()}},_uiSetCheckbox:function(a,b,c){if(a&&b){var a="category"===a?this._categories:this._sources,d="input[type=checkbox]."+h("console","filter",b),e=a.one(d),f;e||(f=this.get("host"),this._createCheckbox(a,b),e=a.one(d),f._uiSetHeight(f.get("height")));e.set("checked",c)}},_onCategoryCheckboxClick:function(a){var a=a.target,b;a.hasClass(g.CHROME_CLASSES.filter)&&(b=a.get("value"))&&b in this.get("category")&&
this.set("category."+b,a.get("checked"),{fromUI:!0})},_onSourceCheckboxClick:function(a){var a=a.target,b;a.hasClass(g.CHROME_CLASSES.filter)&&(b=a.get("value"))&&b in this.get("source")&&this.set("source."+b,a.get("checked"),{fromUI:!0})},hideCategory:function(a,b){i(b)?c.Array.each(arguments,this.hideCategory,this):this.set("category."+a,!1)},showCategory:function(a,b){i(b)?c.Array.each(arguments,this.showCategory,this):this.set("category."+a,!0)},hideSource:function(a,b){i(b)?c.Array.each(arguments,
this.hideSource,this):this.set("source."+a,!1)},showSource:function(a,b){i(b)?c.Array.each(arguments,this.showSource,this):this.set("source."+a,!0)},_createCheckbox:function(a,b){var i=c.merge(g.CHROME_CLASSES,{filter_name:b,filter_class:h("console","filter",b)}),i=c.Node.create(c.substitute(g.FILTER_TEMPLATE,i));a.appendChild(i)},_validateCategory:function(a,b){return c.Lang.isObject(b,!0)&&3>a.split(/\./).length},_validateSource:function(a,b){return c.Lang.isObject(b,!0)&&3>a.split(/\./).length},
_setCacheLimit:function(a){return c.Lang.isNumber(a)?this._cacheLimit=a:c.Attribute.INVALID_VALUE}},{NAME:"consoleFilters",NS:"filter",CATEGORIES_TEMPLATE:'<div class="{categories}"></div>',SOURCES_TEMPLATE:'<div class="{sources}"></div>',FILTER_TEMPLATE:'<label class="{filter_label}"><input type="checkbox" value="{filter_name}" class="{filter} {filter_class}"> {filter_name}</label>&#8201;',CHROME_CLASSES:{categories:h("console","filters","categories"),sources:h("console","filters","sources"),category:h("console",
"filter","category"),source:h("console","filter","source"),filter:h("console","filter"),filter_label:h("console","filter","label")},ATTRS:{defaultVisibility:{value:!0,validator:c.Lang.isBoolean},category:{value:{},validator:function(a,b){return this._validateCategory(b,a)}},source:{value:{},validator:function(a,b){return this._validateSource(b,a)}},cacheLimit:{value:Number.POSITIVE_INFINITY,setter:function(a){return this._setCacheLimit(a)}}}})},"3.5.0",{requires:["console","plugin"]});
