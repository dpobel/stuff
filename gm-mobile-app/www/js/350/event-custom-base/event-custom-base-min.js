YUI.add("event-custom-base",function(b){b.Env.evt={handles:{},plugins:{}};var h={objs:{},before:function(a,d,c,e){var f=a;e&&(f=[a,e].concat(b.Array(arguments,4,!0)),f=b.rbind.apply(b,f));return this._inject(0,f,d,c)},after:function(a,d,c,e){var f=a;e&&(f=[a,e].concat(b.Array(arguments,4,!0)),f=b.rbind.apply(b,f));return this._inject(1,f,d,c)},_inject:function(a,d,c,e){var f=b.stamp(c),g;this.objs[f]||(this.objs[f]={});g=this.objs[f];g[e]||(g[e]=new b.Do.Method(c,e),c[e]=function(){return g[e].exec.apply(g[e],
arguments)});c=f+b.stamp(d)+e;g[e].register(c,d,a);return new b.EventHandle(g[e],c)},detach:function(a){a.detach&&a.detach()},_unload:function(){}};b.Do=h;h.Method=function(a,d){this.obj=a;this.methodName=d;this.method=a[d];this.before={};this.after={}};h.Method.prototype.register=function(a,d,c){c?this.after[a]=d:this.before[a]=d};h.Method.prototype._delete=function(a){delete this.before[a];delete this.after[a]};h.Method.prototype.exec=function(){var a=b.Array(arguments,0,!0),d,c,e;e=this.before;
var f=this.after,g=!1;for(d in e)if(e.hasOwnProperty(d)&&(c=e[d].apply(this.obj,a)))switch(c.constructor){case h.Halt:return c.retVal;case h.AlterArgs:a=c.newArgs;break;case h.Prevent:g=!0}g||(c=this.method.apply(this.obj,a));h.originalRetVal=c;h.currentRetVal=c;for(d in f)if(f.hasOwnProperty(d)){if((e=f[d].apply(this.obj,a))&&e.constructor==h.Halt)return e.retVal;e&&e.constructor==h.AlterReturn&&(c=e.newRetVal,h.currentRetVal=c)}return c};h.AlterArgs=function(a,d){this.msg=a;this.newArgs=d};h.AlterReturn=
function(a,d){this.msg=a;this.newRetVal=d};h.Halt=function(a,d){this.msg=a;this.retVal=d};h.Prevent=function(a){this.msg=a};h.Error=h.Halt;var w="broadcast,monitored,bubbles,context,contextFn,currentTarget,defaultFn,defaultTargetOnly,details,emitFacade,fireOnce,async,host,preventable,preventedFn,queuable,silent,stoppedFn,target,type".split(",");b.CustomEvent=function(a,d){d=d||{};this.id=b.stamp(this);this.type=a;this.context=b;this.silent=this.logSystem="yui:log"==a;this.subscribers={};this.afters=
{};this.bubbles=this.preventable=!0;this.signature=9;this.afterCount=this.subCount=0;this.applyConfig(d,!0)};b.CustomEvent.prototype={constructor:b.CustomEvent,hasSubs:function(a){var d=this.subCount,c=this.afterCount,b=this.sibling;b&&(d+=b.subCount,c+=b.afterCount);return a?"after"==a?c:d:d+c},monitor:function(a){this.monitored=!0;var d=this.id+"|"+this.type+"_"+a,c=b.Array(arguments,0,!0);c[0]=d;return this.host.on.apply(this.host,c)},getSubs:function(){var a=b.merge(this.subscribers),d=b.merge(this.afters),
c=this.sibling;c&&(b.mix(a,c.subscribers),b.mix(d,c.afters));return[a,d]},applyConfig:function(a,d){a&&b.mix(this,a,d,w)},_on:function(a,d,c,e){a||this.log("Invalid callback for CE: "+this.type);a=new b.Subscriber(a,d,c,e);this.fireOnce&&this.fired&&(this.async?setTimeout(b.bind(this._notify,this,a,this.firedWith),0):this._notify(a,this.firedWith));"after"==e?(this.afters[a.id]=a,this.afterCount++):(this.subscribers[a.id]=a,this.subCount++);return new b.EventHandle(this,a)},subscribe:function(a,d){var c=
2<arguments.length?b.Array(arguments,2,!0):null;return this._on(a,d,c,!0)},on:function(a,d){var c=2<arguments.length?b.Array(arguments,2,!0):null;this.host&&this.host._monitor("attach",this.type,{args:arguments});return this._on(a,d,c,!0)},after:function(a,d){var c=2<arguments.length?b.Array(arguments,2,!0):null;return this._on(a,d,c,"after")},detach:function(a){if(a&&a.detach)return a.detach();var d,c,e=0,f=b.merge(this.subscribers,this.afters);for(d in f)if(f.hasOwnProperty(d)&&(c=f[d])&&(!a||a===
c.fn))this._delete(c),e++;return e},unsubscribe:function(){return this.detach.apply(this,arguments)},_notify:function(a,d){this.log(this.type+"->sub: "+a.id);return!1===a.notify(d,this)||1<this.stopped?(this.log(this.type+" cancelled by subscriber"),!1):!0},log:function(){},fire:function(){if(this.fireOnce&&this.fired)return this.log("fireOnce event: "+this.type+" already fired"),!0;var a=b.Array(arguments,0,!0);this.fired=!0;this.firedWith=a;return this.emitFacade?this.fireComplex(a):this.fireSimple(a)},
fireSimple:function(a){this.prevented=this.stopped=0;if(this.hasSubs()){var d=this.getSubs();this._procSubs(d[0],a);this._procSubs(d[1],a)}this._broadcast(a);return this.stopped?!1:!0},fireComplex:function(a){a[0]=a[0]||{};return this.fireSimple(a)},_procSubs:function(a,d,c){var b,f;for(f in a)if(a.hasOwnProperty(f)&&(b=a[f])&&b.fn)if(!1===this._notify(b,d,c)&&(this.stopped=2),2==this.stopped)return!1;return!0},_broadcast:function(a){!this.stopped&&this.broadcast&&(a=b.Array(a),a.unshift(this.type),
this.host!==b&&b.fire.apply(b,a),2==this.broadcast&&b.Global.fire.apply(b.Global,a))},unsubscribeAll:function(){return this.detachAll.apply(this,arguments)},detachAll:function(){return this.detach()},_delete:function(a){if(a&&(this.subscribers[a.id]&&(delete this.subscribers[a.id],this.subCount--),this.afters[a.id]))delete this.afters[a.id],this.afterCount--;this.host&&this.host._monitor("detach",this.type,{ce:this,sub:a});a&&(a.deleted=!0)}};b.Subscriber=function(a,d,c){this.fn=a;this.context=d;
this.id=b.stamp(this);this.args=c};b.Subscriber.prototype={constructor:b.Subscriber,_notify:function(a,d,c){if(this.deleted&&!this.postponed)if(this.postponed)delete this.fn,delete this.context;else return delete this.postponed,null;var b=this.args;switch(c.signature){case 0:a=this.fn.call(a,c.type,d,a);break;case 1:a=this.fn.call(a,d[0]||null,a);break;default:b||d?(d=d||[],b=b?d.concat(b):d,a=this.fn.apply(a,b)):a=this.fn.call(a)}this.once&&c._delete(this);return a},notify:function(a,d){var c=this.context,
e=!0;c||(c=d.contextFn?d.contextFn():d.context);if(b.config.throwFail)e=this._notify(c,a,d);else try{e=this._notify(c,a,d)}catch(f){b.error(this+" failed: "+f.message,f)}return e},contains:function(a,d){return d?this.fn==a&&this.context==d:this.fn==a}};b.EventHandle=function(a,d){this.evt=a;this.sub=d};b.EventHandle.prototype={batch:function(a,d){a.call(d||this,this);b.Lang.isArray(this.evt)&&b.Array.each(this.evt,function(c){c.batch.call(d||c,a)})},detach:function(){var a=this.evt,d=0,c;if(a)if(b.Lang.isArray(a))for(c=
0;c<a.length;c++)d+=a[c].detach();else a._delete(this.sub),d=1;return d},monitor:function(a){return this.evt.monitor.apply(this.evt,arguments)}};var m=b.Lang,n=b.Array,x=b.cached(function(a){return a.replace(/(.*)(:)(.*)/,"*$2$3")}),s=b.cached(function(a,d){return!d||!m.isString(a)||-1<a.indexOf(":")?a:d+":"+a}),u=b.cached(function(a,d){var c=a,b,f,g;if(!m.isString(c))return c;g=c.indexOf("~AFTER~");-1<g&&(f=!0,c=c.substr(7));g=c.indexOf("|");-1<g&&(b=c.substr(0,g),c=c.substr(g+1),"*"==c&&(c=null));
return[b,d?s(c,d):c,f,c]}),k=function(a){a=m.isObject(a)?a:{};this._yuievt=this._yuievt||{id:b.guid(),events:{},targets:{},config:a,chain:"chain"in a?a.chain:b.config.chain,bubbling:!1,defaults:{context:a.context||this,host:this,emitFacade:a.emitFacade,fireOnce:a.fireOnce,queuable:a.queuable,monitored:a.monitored,broadcast:a.broadcast,defaultTargetOnly:a.defaultTargetOnly,bubbles:"bubbles"in a?a.bubbles:!0}}};k.prototype={constructor:k,once:function(){var a=this.on.apply(this,arguments);a.batch(function(a){a.sub&&
(a.sub.once=!0)});return a},onceAfter:function(){var a=this.after.apply(this,arguments);a.batch(function(a){a.sub&&(a.sub.once=!0)});return a},parseType:function(a,d){return u(a,d||this._yuievt.config.prefix)},on:function(a,d,c){var e=u(a,this._yuievt.config.prefix),f,g,l,h,j,i,q=b.Env.evt.handles,r,t,o=b.Node,p,v,k;this._monitor("attach",e[1],{args:arguments,category:e[0],after:e[2]});if(m.isObject(a)){if(m.isFunction(a))return b.Do.before.apply(b.Do,arguments);f=d;g=c;l=n(arguments,0,!0);h=[];m.isArray(a)&&
(k=!0);r=a._after;delete a._after;b.each(a,function(a,c){m.isObject(a)&&(f=a.fn||(m.isFunction(a)?a:f),g=a.context||g);l[0]=(r?"~AFTER~":"")+(k?a:c);l[1]=f;l[2]=g;h.push(this.on.apply(this,l))},this);return this._yuievt.chain?this:new b.EventHandle(h)}i=e[0];r=e[2];t=e[3];if(o&&b.instanceOf(this,o)&&t in o.DOM_EVENTS)return l=n(arguments,0,!0),l.splice(2,0,o.getDOMNode(this)),b.on.apply(b,l);a=e[1];if(b.instanceOf(this,YUI))if(e=b.Env.evt.plugins[a],l=n(arguments,0,!0),l[0]=t,o&&(p=l[2],b.instanceOf(p,
b.NodeList)?p=b.NodeList.getDOMNodes(p):b.instanceOf(p,o)&&(p=o.getDOMNode(p)),(v=t in o.DOM_EVENTS)&&(l[2]=p)),e)j=e.on.apply(b,l);else if(!a||v)j=b.Event._attach(l);j||(j=this._yuievt.events[a]||this.publish(a),j=j._on(d,c,3<arguments.length?n(arguments,3,!0):null,r?"after":!0));i&&(q[i]=q[i]||{},q[i][a]=q[i][a]||[],q[i][a].push(j));return this._yuievt.chain?this:j},subscribe:function(){return this.on.apply(this,arguments)},detach:function(a,d,c){var e=this._yuievt.events,f,g=b.Node,h=g&&b.instanceOf(this,
g);if(!a&&this!==b){for(f in e)e.hasOwnProperty(f)&&e[f].detach(d,c);h&&b.Event.purgeElement(g.getDOMNode(this));return this}var k=u(a,this._yuievt.config.prefix),j=m.isArray(k)?k[0]:null,i=k?k[3]:null,q=b.Env.evt.handles,r=function(a,c,d){var a=a[c],b;if(a)for(b=a.length-1;0<=b;--b)c=a[b].evt,(c.host===d||c.el===d)&&a[b].detach()};if(j){if(j=q[j],a=k[1],h=h?b.Node.getDOMNode(this):this,j){if(a)r(j,a,h);else for(f in j)j.hasOwnProperty(f)&&r(j,f,h);return this}}else{if(m.isObject(a)&&a.detach)return a.detach(),
this;if(h&&(!i||i in g.DOM_EVENTS))return i=n(arguments,0,!0),i[2]=g.getDOMNode(this),b.detach.apply(b,i),this}f=b.Env.evt.plugins[i];if(b.instanceOf(this,YUI)){i=n(arguments,0,!0);if(f&&f.detach)return f.detach.apply(b,i),this;if(!a||!f&&g&&a in g.DOM_EVENTS)return i[0]=a,b.Event.detach.apply(b.Event,i),this}(e=e[k[1]])&&e.detach(d,c);return this},unsubscribe:function(){return this.detach.apply(this,arguments)},detachAll:function(a){return this.detach(a)},unsubscribeAll:function(){return this.detachAll.apply(this,
arguments)},publish:function(a,d){var c,e,f,g;g=this._yuievt;c=g.config.prefix;if(m.isObject(a))return f={},b.each(a,function(a,c){f[c]=this.publish(c,a||d)},this),f;a=c?s(a,c):a;this._monitor("publish",a,{args:arguments});c=g.events;(e=c[a])?d&&e.applyConfig(d,!0):(g=g.defaults,e=new b.CustomEvent(a,d?b.merge(g,d):g),c[a]=e);return c[a]},_monitor:function(a,d,c){var b=this.getEvent(d);if(this._yuievt.config.monitored&&(!b||b.monitored)||b&&b.monitored)c.monitored=a,this.fire.call(this,d+"_"+a,c)},
fire:function(a){var d=m.isString(a),c=d?a:a&&a.type,b;b=this._yuievt.config.prefix;var f,d=d?n(arguments,1,!0):arguments,c=b?s(c,b):c;this._monitor("fire",c,{args:d});b=this.getEvent(c,!0);(f=this.getSibling(c,b))&&!b&&(b=this.publish(c));if(b)b.sibling=f,c=b.fire.apply(b,d);else{if(this._yuievt.hasTargets)return this.bubble({type:c},d,this);c=!0}return this._yuievt.chain?this:c},getSibling:function(a,b){var c;if(-1<a.indexOf(":")&&(a=x(a),c=this.getEvent(a,!0)))c.applyConfig(b),c.bubbles=!1,c.broadcast=
0;return c},getEvent:function(a,b){var c;b||(a=(c=this._yuievt.config.prefix)?s(a,c):a);return this._yuievt.events[a]||null},after:function(a,d){var c=n(arguments,0,!0);switch(m.type(a)){case "function":return b.Do.after.apply(b.Do,arguments);case "array":case "object":c[0]._after=!0;break;default:c[0]="~AFTER~"+a}return this.on.apply(this,c)},before:function(){return this.on.apply(this,arguments)}};b.EventTarget=k;b.mix(b,k.prototype);k.call(b,{bubbles:!1});YUI.Env.globalEvents=YUI.Env.globalEvents||
new k;b.Global=YUI.Env.globalEvents},"3.5.0",{requires:["oop"]});
