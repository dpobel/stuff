YUI.add("dd-drag",function(b){var d=b.DD.DDM,g=function(a){this._lazyAddAttrs=!1;g.superclass.constructor.apply(this,arguments);d._regDrag(this)||b.error("Failed to register node, already in use: "+a.node)};g.NAME="drag";g.START_EVENT="mousedown";g.ATTRS={node:{setter:function(a){if(this._canDrag(a))return a;var e=b.one(a);e||b.error("DD.Drag: Invalid Node Given: "+a);return e}},dragNode:{setter:function(a){if(this._canDrag(a))return a;var e=b.one(a);e||b.error("DD.Drag: Invalid dragNode Given: "+
a);return e}},offsetNode:{value:!0},startCentered:{value:!1},clickPixelThresh:{value:d.get("clickPixelThresh")},clickTimeThresh:{value:d.get("clickTimeThresh")},lock:{value:!1,setter:function(a){a?this.get("node").addClass(d.CSS_PREFIX+"-locked"):this.get("node").removeClass(d.CSS_PREFIX+"-locked");return a}},data:{value:!1},move:{value:!0},useShim:{value:!0},activeHandle:{value:!1},primaryButtonOnly:{value:!0},dragging:{value:!1},parent:{value:!1},target:{value:!1,setter:function(a){this._handleTarget(a);
return a}},dragMode:{value:null,setter:function(a){return d._setDragMode(a)}},groups:{value:["default"],getter:function(){this._groups||(this._groups={});var a=[];b.each(this._groups,function(b,c){a[a.length]=c});return a},setter:function(a){this._groups={};b.each(a,function(a){this._groups[a]=!0},this);return a}},handles:{value:null,setter:function(a){a?(this._handles={},b.each(a,function(a){var c=a;if(a instanceof b.Node||a instanceof b.NodeList)c=a._yuid;this._handles[c]=a},this)):this._handles=
null;return a}},bubbles:{setter:function(a){this.addTarget(a);return a}},haltDown:{value:!0}};b.extend(g,b.Base,{_canDrag:function(a){return a&&a.setXY&&a.getXY&&a.test&&a.contains?!0:!1},_bubbleTargets:b.DD.DDM,addToGroup:function(a){this._groups[a]=!0;d._activateTargets();return this},removeFromGroup:function(a){delete this._groups[a];d._activateTargets();return this},target:null,_handleTarget:function(a){if(b.DD.Drop){if(!1===a)return this.target&&(d._unregTarget(this.target),this.target=null),
!1;b.Lang.isObject(a)||(a={});a.bubbleTargets="bubbleTargets"in a?a.bubbleTargets:b.Object.values(this._yuievt.targets);a.node=this.get("node");a.groups=a.groups||this.get("groups");this.target=new b.DD.Drop(a)}else return!1},_groups:null,_createEvents:function(){this.publish("drag:mouseDown",{defaultFn:this._defMouseDownFn,queuable:!1,emitFacade:!0,bubbles:!0,prefix:"drag"});this.publish("drag:align",{defaultFn:this._defAlignFn,queuable:!1,emitFacade:!0,bubbles:!0,prefix:"drag"});this.publish("drag:drag",
{defaultFn:this._defDragFn,queuable:!1,emitFacade:!0,bubbles:!0,prefix:"drag"});this.publish("drag:end",{defaultFn:this._defEndFn,preventedFn:this._prevEndFn,queuable:!1,emitFacade:!0,bubbles:!0,prefix:"drag"});b.each("drag:afterMouseDown,drag:removeHandle,drag:addHandle,drag:removeInvalid,drag:addInvalid,drag:start,drag:drophit,drag:dropmiss,drag:over,drag:enter,drag:exit".split(","),function(a){this.publish(a,{type:a,emitFacade:true,bubbles:true,preventable:false,queuable:false,prefix:"drag"})},
this)},_ev_md:null,_startTime:null,_endTime:null,_handles:null,_invalids:null,_invalidsDefault:{textarea:!0,input:!0,a:!0,button:!0,select:!0},_dragThreshMet:null,_fromTimeout:null,_clickTimeout:null,deltaXY:null,startXY:null,nodeXY:null,lastXY:null,actXY:null,realXY:null,mouseXY:null,region:null,_handleMouseUp:function(){this.fire("drag:mouseup");this._fixIEMouseUp();d.activeDrag&&d._end()},_fixDragStart:function(a){a.preventDefault()},_ieSelectFix:function(){return!1},_ieSelectBack:null,_fixIEMouseDown:function(){b.UA.ie&&
(this._ieSelectBack=b.config.doc.body.onselectstart,b.config.doc.body.onselectstart=this._ieSelectFix)},_fixIEMouseUp:function(){b.UA.ie&&(b.config.doc.body.onselectstart=this._ieSelectBack)},_handleMouseDownEvent:function(a){this.fire("drag:mouseDown",{ev:a})},_defMouseDownFn:function(a){a=a.ev;this._dragThreshMet=!1;this._ev_md=a;if(this.get("primaryButtonOnly")&&1<a.button)return!1;this.validClick(a)&&(this._fixIEMouseDown(a),this.get("haltDown")?a.halt():a.preventDefault(),this._setStartPosition([a.pageX,
a.pageY]),d.activeDrag=this,this._clickTimeout=b.later(this.get("clickTimeThresh"),this,this._timeoutCheck));this.fire("drag:afterMouseDown",{ev:a})},validClick:function(a){var e=!1,c=!1,d=a.target,f=null,g=c=null,h=!1;if(this._handles)b.each(this._handles,function(a,c){a instanceof b.Node||a instanceof b.NodeList?e||(g=a,g instanceof b.Node&&(g=new b.NodeList(a._node)),g.each(function(a){a.contains(d)&&(e=!0)})):b.Lang.isString(c)&&d.test(c+", "+c+" *")&&!f&&(f=c,e=!0)});else if(c=this.get("node"),
c.contains(d)||c.compareTo(d))e=!0;e&&this._invalids&&b.each(this._invalids,function(a,c){b.Lang.isString(c)&&d.test(c+", "+c+" *")&&(e=!1)});e&&(f?(c=a.currentTarget.all(f),h=!1,c.each(function(a){if((a.contains(d)||a.compareTo(d))&&!h)h=!0,this.set("activeHandle",a)},this)):this.set("activeHandle",this.get("node")));return e},_setStartPosition:function(a){this.startXY=a;this.nodeXY=this.lastXY=this.realXY=this.get("node").getXY();this.deltaXY=this.get("offsetNode")?[this.startXY[0]-this.nodeXY[0],
this.startXY[1]-this.nodeXY[1]]:[0,0]},_timeoutCheck:function(){!this.get("lock")&&!this._dragThreshMet&&this._ev_md&&(this._fromTimeout=this._dragThreshMet=!0,this.start(),this._alignNode([this._ev_md.pageX,this._ev_md.pageY],!0))},removeHandle:function(a){var e=a;if(a instanceof b.Node||a instanceof b.NodeList)e=a._yuid;this._handles[e]&&(delete this._handles[e],this.fire("drag:removeHandle",{handle:a}));return this},addHandle:function(a){this._handles||(this._handles={});var e=a;if(a instanceof
b.Node||a instanceof b.NodeList)e=a._yuid;this._handles[e]=a;this.fire("drag:addHandle",{handle:a});return this},removeInvalid:function(a){this._invalids[a]&&(this._invalids[a]=null,delete this._invalids[a],this.fire("drag:removeInvalid",{handle:a}));return this},addInvalid:function(a){b.Lang.isString(a)&&(this._invalids[a]=!0,this.fire("drag:addInvalid",{handle:a}));return this},initializer:function(){this.get("node").dd=this;if(!this.get("node").get("id")){var a=b.stamp(this.get("node"));this.get("node").set("id",
a)}this.actXY=[];this._invalids=b.clone(this._invalidsDefault,!0);this._createEvents();this.get("dragNode")||this.set("dragNode",this.get("node"));this.on("initializedChange",b.bind(this._prep,this));this.set("groups",this.get("groups"))},_prep:function(){this._dragThreshMet=!1;var a=this.get("node");a.addClass(d.CSS_PREFIX+"-draggable");a.on(g.START_EVENT,b.bind(this._handleMouseDownEvent,this));a.on("mouseup",b.bind(this._handleMouseUp,this));a.on("dragstart",b.bind(this._fixDragStart,this))},_unprep:function(){var a=
this.get("node");a.removeClass(d.CSS_PREFIX+"-draggable");a.detachAll("mouseup");a.detachAll("dragstart");a.detachAll(g.START_EVENT);this.mouseXY=[];this.deltaXY=[0,0];this.startXY=[];this.nodeXY=[];this.lastXY=[];this.actXY=[];this.realXY=[]},start:function(){if(!this.get("lock")&&!this.get("dragging")){var a=this.get("node"),b,c;this._startTime=(new Date).getTime();d._start();a.addClass(d.CSS_PREFIX+"-dragging");this.fire("drag:start",{pageX:this.nodeXY[0],pageY:this.nodeXY[1],startTime:this._startTime});
a=this.get("dragNode");c=this.nodeXY;b=a.get("offsetWidth");a=a.get("offsetHeight");this.get("startCentered")&&this._setStartPosition([c[0]+b/2,c[1]+a/2]);this.region={"0":c[0],1:c[1],area:0,top:c[1],right:c[0]+b,bottom:c[1]+a,left:c[0]};this.set("dragging",!0)}return this},end:function(){this._endTime=(new Date).getTime();this._clickTimeout&&this._clickTimeout.cancel();this._dragThreshMet=this._fromTimeout=!1;!this.get("lock")&&this.get("dragging")&&this.fire("drag:end",{pageX:this.lastXY[0],pageY:this.lastXY[1],
startTime:this._startTime,endTime:this._endTime});this.get("node").removeClass(d.CSS_PREFIX+"-dragging");this.set("dragging",!1);this.deltaXY=[0,0];return this},_defEndFn:function(){this._fixIEMouseUp();this._ev_md=null},_prevEndFn:function(){this._fixIEMouseUp();this.get("dragNode").setXY(this.nodeXY);this.region=this._ev_md=null},_align:function(a){this.fire("drag:align",{pageX:a[0],pageY:a[1]})},_defAlignFn:function(a){this.actXY=[a.pageX-this.deltaXY[0],a.pageY-this.deltaXY[1]]},_alignNode:function(a){this._align(a);
this._moveNode()},_moveNode:function(a){var b=[],c=[],d=this.nodeXY,f=this.actXY;b[0]=f[0]-this.lastXY[0];b[1]=f[1]-this.lastXY[1];c[0]=f[0]-this.nodeXY[0];c[1]=f[1]-this.nodeXY[1];this.region={"0":f[0],1:f[1],area:0,top:f[1],right:f[0]+this.get("dragNode").get("offsetWidth"),bottom:f[1]+this.get("dragNode").get("offsetHeight"),left:f[0]};this.fire("drag:drag",{pageX:f[0],pageY:f[1],scroll:a,info:{start:d,xy:f,delta:b,offset:c}});this.lastXY=f},_defDragFn:function(a){this.get("move")&&(a.scroll&&
(a.scroll.node.set("scrollTop",a.scroll.top),a.scroll.node.set("scrollLeft",a.scroll.left)),this.get("dragNode").setXY([a.pageX,a.pageY]),this.realXY=[a.pageX,a.pageY])},_move:function(a){if(this.get("lock"))return!1;this.mouseXY=[a.pageX,a.pageY];if(this._dragThreshMet)this._clickTimeout&&this._clickTimeout.cancel(),this._alignNode([a.pageX,a.pageY]);else{var b=Math.abs(this.startXY[0]-a.pageX),c=Math.abs(this.startXY[1]-a.pageY);if(b>this.get("clickPixelThresh")||c>this.get("clickPixelThresh"))this._dragThreshMet=
!0,this.start(),this._alignNode([a.pageX,a.pageY])}},stopDrag:function(){this.get("dragging")&&d._end();return this},destructor:function(){this._unprep();this.target&&this.target.destroy();d._unregDrag(this)}});b.namespace("DD");b.DD.Drag=g},"3.5.0",{skinnable:!1,requires:["dd-ddm-base"]});
