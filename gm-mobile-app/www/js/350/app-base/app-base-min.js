YUI.add("app-base",function(c){var h=c.Lang,j=c.Object,l=c.PjaxBase,k=c.Router,m=c.View,n=c.ClassNameManager.getClassName,i=c.config.win,g;g=c.Base.create("app",c.Base,[m,k,l],{views:{},initializer:function(a){function b(a,b){d[b]=c.merge(d[b],a)}a||(a={});var d={};j.each(this.views,b);j.each(a.views,b);this.views=d;this._viewInfoMap={};this.after("activeViewChange",c.bind("_afterActiveViewChange",this));this.get("serverRouting")||this._pjaxBindUI()},createView:function(a,b){var d=this.getViewInfo(a),
e=d&&d.type||m,e=new (h.isString(e)?j.getValue(c,e.split(".")):e)(b);this._viewInfoMap[c.stamp(e,!0)]=d;return e},getViewInfo:function(a){return h.isString(a)?this.views[a]:a&&this._viewInfoMap[c.stamp(a,!0)]},render:function(){var a=this.get("container"),b=this.get("viewContainer"),d=this.get("activeView"),c=d&&d.get("container"),f=a.compareTo(b);a.addClass(g.CSS_CLASS);b.addClass(g.VIEWS_CSS_CLASS);d&&!b.contains(c)&&b.appendChild(c);!a.contains(b)&&!f&&a.appendChild(b);return this},showView:function(a,
b,d,e){var f;h.isString(a)&&((f=this.getViewInfo(a))&&f.preserve&&f.instance?(a=f.instance,this._viewInfoMap[c.stamp(a,!0)]=f):(a=this.createView(a,b),a.render()));d||(d={});e?d.callback=e:h.isFunction(d)&&(d={callback:d});return this._set("activeView",a,{options:d})},_attachView:function(a,b){if(a){var d=this.getViewInfo(a),c=this.get("viewContainer");a.addTarget(this);d&&(d.instance=a);c[b?"prepend":"append"](a.get("container"))}},_destroyContainer:function(){var a=this.get("container"),b=this.get("viewContainer"),
d=a.compareTo(b);c.one("body").compareTo(a)?(this.detachEvents(),a&&a.removeClass(g.CSS_CLASS),d?a&&a.removeClass(g.VIEWS_CSS_CLASS):b&&b.remove(!0)):(b&&b.remove(!0),!d&&a&&a.remove(!0))},_detachView:function(a){if(a){var b=this.getViewInfo(a)||{};b.preserve?a.remove():(a.destroy({remove:!0}),delete this._viewInfoMap[c.stamp(a,!0)],a===b.instance&&delete b.instance);a.removeTarget(this)}},_getViewContainer:function(a){!a&&!this._viewContainer&&(a=this._viewContainer=this.create(),this._set("viewContainer",
a));return a},_getURL:function(){var a=c.getLocation().toString();return this._html5?a:this._upgradeURL(a)},_initHtml5:function(){return!1===this.get("serverRouting")?!1:k.html5},_isChildView:function(a,b){var d=this.getViewInfo(a),c=this.getViewInfo(b);return d&&c?this.getViewInfo(d.parent)===c:!1},_isParentView:function(a,b){var d=this.getViewInfo(a),c=this.getViewInfo(b);return d&&c?this.getViewInfo(c.parent)===d:!1},_navigate:function(a,b){a=this._upgradeURL(a);b||(b={});this.get("serverRouting")||
h.isValue(b.force)||(b.force=!0);return l.prototype._navigate.call(this,a,b)},_save:function(a,b){if(this.get("serverRouting")&&!this.get("html5")){if(!this._hasSameOrigin(a))return c.error("Security error: The new URL must be of the same origin as the current URL."),this;a=this._joinURL(a||"");b?i&&i.location.replace(a):i&&(i.location=a);return this}return k.prototype._save.apply(this,arguments)},_uiSetActiveView:function(a,b,d){d||(d={});var c=d.callback,f=!this._isChildView(a,b)&&this._isParentView(a,
b),d=!!d.prepend||f;if(a===b)return c&&c.call(this,a);this._attachView(a,d);this._detachView(b);c&&c.call(this,a)},_upgradeURL:function(a){if(!this._hasSameOrigin(a))return a;var b=(a.match(/#(.*)$/)||[])[1]||"",d=c.HistoryHash.hashPrefix;d&&0===b.indexOf(d)&&(b=b.replace(d,""));b&&"/"===b.charAt(0)&&(a=this._resolveURL(this._joinURL(b)));return a},_afterActiveViewChange:function(a){this._uiSetActiveView(a.newVal,a.prevVal,a.options)}},{ATTRS:{activeView:{value:null,readOnly:!0},container:{valueFn:function(){return c.one("body")}},
html5:{valueFn:"_initHtml5"},linkSelector:{value:"a"},serverRouting:{value:void 0,writeOnce:"initOnly"},viewContainer:{getter:"_getViewContainer",setter:c.one,writeOnce:!0}},CSS_CLASS:n("app"),VIEWS_CSS_CLASS:n("app","views"),_NON_ATTRS_CFG:["views"]});c.namespace("App").Base=g;c.App=c.mix(c.Base.create("app",c.App.Base,[]),c.App,!0)},"3.5.0",{requires:["classnamemanager","pjax-base","router","view"]});
