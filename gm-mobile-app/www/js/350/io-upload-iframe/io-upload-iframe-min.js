YUI.add("io-upload-iframe",function(f){function l(a,e,b){var c=f.Node.create('<iframe src="#" id="io_iframe'+a.id+'" name="io_iframe'+a.id+'" />');c._node.style.position="absolute";c._node.style.top="-1000px";c._node.style.left="-1000px";f.one("body").appendChild(c);f.on("load",function(){b._uploadComplete(a,e)},"#io_iframe"+a.id)}function k(a){f.Event.purgeElement("#io_iframe"+a,!1);f.one("body").removeChild(f.one("#io_iframe"+a))}var g=f.config.win,i=f.config.doc,m=i.documentMode&&8<=i.documentMode,
j=decodeURIComponent;f.mix(f.IO.prototype,{_addData:function(a,e){f.Lang.isObject(e)&&(e=f.QueryString.stringify(e));var b=[],c=e.split("="),d,h;d=0;for(h=c.length-1;d<h;d++)b[d]=i.createElement("input"),b[d].type="hidden",b[d].name=j(c[d].substring(c[d].lastIndexOf("&")+1)),b[d].value=d+1===h?j(c[d+1]):j(c[d+1].substring(0,c[d+1].lastIndexOf("&"))),a.appendChild(b[d]);return b},_removeData:function(a,e){var b,c;b=0;for(c=e.length;b<c;b++)a.removeChild(e[b])},_setAttrs:function(a,e,b){a.setAttribute("action",
b);a.setAttribute("method","POST");a.setAttribute("target","io_iframe"+e);a.setAttribute(f.UA.ie&&!m?"encoding":"enctype","multipart/form-data")},_resetAttrs:function(a,e){f.Object.each(e,function(b,c){b?a.setAttribute(c,b):a.removeAttribute(c)})},_startUploadTimeout:function(a,e){var b=this;b._timeout[a.id]=g.setTimeout(function(){a.status=0;a.statusText="timeout";b.complete(a,e);b.end(a,e)},e.timeout)},_clearUploadTimeout:function(a){g.clearTimeout(this._timeout[a]);delete this._timeout[a]},_uploadComplete:function(a,
e){var b=f.one("#io_iframe"+a.id).get("contentWindow.document"),c=b.one("body"),d;e.timeout&&this._clearUploadTimeout(a.id);try{c?(d=c.one("pre:first-child"),a.c.responseText=d?d.get("text"):c.get("text")):a.c.responseXML=b._node}catch(h){a.e="upload failure"}this.complete(a,e);this.end(a,e);g.setTimeout(function(){k(a.id)},0)},_upload:function(a,e,b){var c=this,d="string"===typeof b.form.id?i.getElementById(b.form.id):b.form.id,h={action:d.getAttribute("action"),target:d.getAttribute("target")},
g;c._setAttrs(d,a.id,e);b.data&&(g=c._addData(d,b.data));b.timeout&&c._startUploadTimeout(a,b);d.submit();c.start(a,b);b.data&&c._removeData(d,g);c._resetAttrs(d,h);return{id:a.id,abort:function(){a.status=0;a.statusText="abort";if(f.one("#io_iframe"+a.id))k(a.id),c.complete(a,b),c.end(a,b);else return!1},isInProgress:function(){return f.one("#io_iframe"+a.id)?!0:!1},io:c}},upload:function(a,e,b){l(a,b,this);return this._upload(a,e,b)}})},"3.5.0",{requires:["io-base","node-base"]});
