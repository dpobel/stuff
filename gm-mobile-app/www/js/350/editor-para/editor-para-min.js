YUI.add("editor-para",function(f){var k=function(){k.superclass.constructor.apply(this,arguments)};f.extend(k,f.Plugin.EditorParaBase,{_onNodeChange:function(d){var e=this.get("host"),c=e.getInstance(),a,b,g,h=c.EditorSelection.DEFAULT_BLOCK_TAG,i,l,m,j;switch(d.changedType){case "enter-up":c=this._lastPara?this._lastPara:d.changedNode;a=c.one("br.yui-cursor");this._lastPara&&delete this._lastPara;a&&(a.previous()||a.next())&&a.ancestor("p")&&a.remove();if(!c.test(h)&&(a=c.ancestor(h)))c=a,a=null;
if(c.test(h)&&(b=c.previous(),a=!1,b)){for(b=b.one(":last-child");!a;)b?(g=b.one(":last-child"))?b=g:a=!0:a=!0;b&&e.copyStyles(b,c)}break;case "enter":f.UA.webkit&&d.changedEvent.shiftKey&&(e.execCommand("insertbr"),d.changedEvent.preventDefault());d.changedNode.test("li")&&!f.UA.ie&&(a=c.EditorSelection.getText(d.changedNode),""===a&&(a=d.changedNode.ancestor("ol,ul"),b=a.getAttribute("dir"),""!==b&&(b=' dir = "'+b+'"'),a=d.changedNode.ancestor(c.EditorSelection.BLOCKS),b=c.Node.create("<p"+b+">"+
c.EditorSelection.CURSOR+"</p>"),a.insert(b,"after"),d.changedNode.remove(),d.changedEvent.halt(),g=new c.EditorSelection,g.selectNode(b,!0,!1)));if(f.UA.gecko&&"p"!==e.get("defaultblock")&&(a=d.changedNode,!a.test("li")&&!a.ancestor("li"))){a.test(h)||(a=a.ancestor(h));b=c.Node.create("<"+h+"></"+h+">");a.insert(b,"after");g=new c.EditorSelection;if(g.anchorOffset){e=g.anchorNode.get("textContent");a=c.one(c.config.doc.createTextNode(e.substr(0,g.anchorOffset)));i=c.one(c.config.doc.createTextNode(e.substr(g.anchorOffset)));
l=g.anchorNode;l.setContent("");e=l.cloneNode();e.append(i);i=!1;for(j=l;!i;)if((j=j.get("parentNode"))&&!j.test(h)){m=j.cloneNode();m.set("innerHTML","");m.append(e);var e=j.get("childNodes"),k=!1;e.each(function(a){k&&m.append(a);a===l&&(k=true)});l=j;e=m}else i=!0;i=e;g.anchorNode.append(a);i&&b.append(i)}b.get("firstChild")&&(b=b.get("firstChild"));b.prepend(c.EditorSelection.CURSOR);g.focusCursor(!0,!0);a=c.EditorSelection.getText(b);""!==a&&c.EditorSelection.cleanCursor();d.changedEvent.preventDefault()}break;
case "keyup":f.UA.gecko&&c.config.doc&&c.config.doc.body&&20>c.config.doc.body.innerHTML.length&&(c.one("body > p")||this._fixFirstPara());break;case "backspace-up":case "backspace-down":case "delete-up":if(!f.UA.ie){a=c.all("body > p");b=c.one("body");a.item(0)&&(b=a.item(0));if(a=b.one("br"))a.removeAttribute("id"),a.removeAttribute("class");a=c.EditorSelection.getText(b);a=a.replace(/ /g,"").replace(/\n/g,"");g=b.all("img");if(0===a.length&&!g.size()&&(b.test("p")||this._fixFirstPara(),a=null,
d.changedNode&&d.changedNode.test("p")&&(a=d.changedNode),!a&&e._lastPara&&e._lastPara.inDoc()&&(a=e._lastPara),a&&!a.test("p")&&(a=a.ancestor("p")),a&&!a.previous()&&a.get("parentNode")&&a.get("parentNode").test("body")))d.changedEvent.frameEvent.halt(),d.preventDefault();f.UA.webkit&&d.changedNode&&(d.preventDefault(),b=d.changedNode,b.test("li")&&!b.previous()&&!b.next()&&(a=b.get("innerHTML").replace("<br>",""),""===a&&b.get("parentNode")&&(b.get("parentNode").replace(c.Node.create("<br>")),d.changedEvent.frameEvent.halt(),
c.EditorSelection.filterBlocks())))}f.UA.gecko&&(b=d.changedNode,e=c.config.doc.createTextNode(" "),b.appendChild(e),b.removeChild(e))}if(f.UA.gecko&&d.changedNode&&!d.changedNode.test(h)&&(a=d.changedNode.ancestor(h)))this._lastPara=a},initializer:function(){var d=this.get("host");if(d.editorBR)f.error("Can not plug EditorPara and EditorBR at the same time.");else d.on("nodeChange",f.bind(this._onNodeChange,this))}},{NAME:"editorPara",NS:"editorPara",ATTRS:{host:{value:!1}}});f.namespace("Plugin");
f.Plugin.EditorPara=k},"3.5.0",{skinnable:!1,requires:["editor-base"]});
