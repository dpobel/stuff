YUI.add("dd-constrain",function(c){var i=c.DD.DDM,j=null,g=function(a){this._lazyAddAttrs=!1;g.superclass.constructor.apply(this,arguments)};g.NAME="ddConstrained";g.NS="con";g.ATTRS={host:{},stickX:{value:!1},stickY:{value:!1},tickX:{value:!1},tickY:{value:!1},tickXArray:{value:!1},tickYArray:{value:!1},gutter:{value:"0",setter:function(a){return c.DD.DDM.cssSizestoObject(a)}},constrain:{value:"view",setter:function(a){var b=c.one(a);b&&(a=b);return a}},constrain2region:{setter:function(a){return this.set("constrain",
a)}},constrain2node:{setter:function(a){return this.set("constrain",c.one(a))}},constrain2view:{setter:function(){return this.set("constrain","view")}},cacheRegion:{value:!0}};j={_lastTickXFired:null,_lastTickYFired:null,initializer:function(){this._createEvents();this.get("host").on("drag:end",c.bind(this._handleEnd,this));this.get("host").on("drag:start",c.bind(this._handleStart,this));this.get("host").after("drag:align",c.bind(this.align,this));this.get("host").after("drag:drag",c.bind(this.drag,
this))},destructor:function(){this._cacheHandle&&this._cacheHandle.detach();this._cacheHandle=null},_createEvents:function(){c.each(["drag:tickAlignX","drag:tickAlignY"],function(a){this.publish(a,{type:a,emitFacade:!0,bubbles:!0,queuable:!1,prefix:"drag"})},this)},_handleEnd:function(){this._lastTickXFired=this._lastTickYFired=null},_handleStart:function(){this.resetCache()},_regionCache:null,_cacheHandle:null,_cacheRegion:function(){this._regionCache=this.get("constrain").get("region")},resetCache:function(){this._regionCache=
null},_getConstraint:function(){var a=this.get("constrain"),b=this.get("gutter"),d;a&&(a instanceof c.Node?(this._regionCache||(this._cacheHandle=c.on("resize",c.bind(this._cacheRegion,this),c.config.win),this._cacheRegion()),d=c.clone(this._regionCache),this.get("cacheRegion")||this.resetCache()):c.Lang.isObject(a)&&(d=c.clone(a)));if(!a||!d)a="view";"view"===a&&(d=this.get("host").get("dragNode").get("viewportRegion"));c.each(b,function(a,b){d[b]=b=="right"||b=="bottom"?d[b]-a:d[b]+a});return d},
getRegion:function(a){var b={},d=null,c=null,c=this.get("host"),b=this._getConstraint();a&&(d=c.get("dragNode").get("offsetHeight"),c=c.get("dragNode").get("offsetWidth"),b.right-=c,b.bottom-=d);return b},_checkRegion:function(a){var b=this.getRegion(),d=this.get("host"),c=d.get("dragNode").get("offsetHeight"),d=d.get("dragNode").get("offsetWidth");a[1]>b.bottom-c&&(a[1]=b.bottom-c);b.top>a[1]&&(a[1]=b.top);a[0]>b.right-d&&(a[0]=b.right-d);b.left>a[0]&&(a[0]=b.left);return a},inRegion:function(a){var a=
a||this.get("host").get("dragNode").getXY(),b=this._checkRegion([a[0],a[1]]),d=!1;a[0]===b[0]&&a[1]===b[1]&&(d=!0);return d},align:function(){var a=this.get("host"),b=[a.actXY[0],a.actXY[1]],d=this.getRegion(!0);this.get("stickX")&&(b[1]=a.startXY[1]-a.deltaXY[1]);this.get("stickY")&&(b[0]=a.startXY[0]-a.deltaXY[0]);d&&(b=this._checkRegion(b));b=this._checkTicks(b,d);a.actXY=b},drag:function(){var a=this.get("host"),b=this.get("tickX"),d=this.get("tickY"),a=[a.actXY[0],a.actXY[1]];if((c.Lang.isNumber(b)||
this.get("tickXArray"))&&this._lastTickXFired!==a[0])this._tickAlignX(),this._lastTickXFired=a[0];if((c.Lang.isNumber(d)||this.get("tickYArray"))&&this._lastTickYFired!==a[1])this._tickAlignY(),this._lastTickYFired=a[1]},_checkTicks:function(a,b){var d=this.get("host"),c=d.startXY[0]-d.deltaXY[0],d=d.startXY[1]-d.deltaXY[1],f=this.get("tickX"),h=this.get("tickY");f&&!this.get("tickXArray")&&(a[0]=i._calcTicks(a[0],c,f,b.left,b.right));h&&!this.get("tickYArray")&&(a[1]=i._calcTicks(a[1],d,h,b.top,
b.bottom));this.get("tickXArray")&&(a[0]=i._calcTickArray(a[0],this.get("tickXArray"),b.left,b.right));this.get("tickYArray")&&(a[1]=i._calcTickArray(a[1],this.get("tickYArray"),b.top,b.bottom));return a},_tickAlignX:function(){this.fire("drag:tickAlignX")},_tickAlignY:function(){this.fire("drag:tickAlignY")}};c.namespace("Plugin");c.extend(g,c.Base,j);c.Plugin.DDConstrained=g;c.mix(i,{_calcTicks:function(a,b,d,c,f){var h=(a-b)/d,e=Math.floor(h),g=Math.ceil(h);if((0!==e||0!==g)&&h>=e&&h<=g)a=b+d*
e,c&&f&&(a<c&&(a=b+d*(e+1)),a>f&&(a=b+d*(e-1)));return a},_calcTickArray:function(a,b,d,c){var f=0,h=b.length,e=0,g;if(!b||0===b.length)return a;if(b[0]>=a)return b[0];for(f=0;f<h;f++)if(e=f+1,b[e]&&b[e]>=a)return g=a-b[f],a=b[e]-a,e=a>g?b[f]:b[e],d&&c&&e>c&&(e=b[f]?b[f]:b[h-1]),e;return b[b.length-1]}})},"3.5.0",{skinnable:!1,requires:["dd-drag"]});
