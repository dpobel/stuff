YUI.add("calendar-base",function(g){function n(a){n.superclass.constructor.apply(this,arguments)}var h=g.ClassNameManager.getClassName,w=h("calendar","grid"),y=h("calendar","left-grid"),z=h("calendar","right-grid"),A=h("calendar","body"),x=h("calendar","header"),s=h("calendar","header-label"),B=h("calendar","weekdayrow"),C=h("calendar","weekday"),t=h("calendar","column-hidden"),l=h("calendar","day-selected"),u=h("calendar","selection-disabled"),D=h("calendar","row"),m=h("calendar","day"),E=h("calendar",
"prevmonth-day"),i=h("calendar","nextmonth-day"),F=h("calendar","anchor"),G=h("calendar","pane"),h=h("calendar","status"),o=g.Lang,p=g.substitute,q=g.each,v=g.Array.indexOf,r=g.Object.hasKey,H=g.Object.setValue,I=g.Object.isEmpty,k=g.DataType.Date;g.CalendarBase=g.extend(n,g.Widget,{_paneProperties:{},_paneNumber:1,_calendarId:null,_selectedDates:{},_rules:{},_filterFunction:null,_storedDateCells:{},initializer:function(){this._paneProperties={};this._calendarId=g.guid("calendar");this._selectedDates=
{};this._rules={};this._storedDateCells={}},renderUI:function(){this.get("contentBox").appendChild(this._initCalendarHTML(this.get("date")));this.get("showPrevMonth")&&this._afterShowPrevMonthChange();this.get("showNextMonth")&&this._afterShowNextMonthChange();this._renderCustomRules();this._renderSelectedDates();this.get("boundingBox").setAttribute("aria-labelledby",this._calendarId+"_header")},bindUI:function(){this.after("dateChange",this._afterDateChange);this.after("showPrevMonthChange",this._afterShowPrevMonthChange);
this.after("showNextMonthChange",this._afterShowNextMonthChange);this.after("headerRendererChange",this._afterHeaderRendererChange);this.after("customRendererChange",this._afterCustomRendererChange);this.after("enabledDatesRuleChange",this._afterCustomRendererChange);this.after("disabledDatesRuleChange",this._afterCustomRendererChange);this.after("focusedChange",this._afterFocusedChange);this._bindCalendarEvents()},syncUI:function(){this.get("showPrevMonth")&&this._afterShowPrevMonthChange();this.get("showNextMonth")&&
this._afterShowNextMonthChange()},_getSelectedDatesList:function(){var a=[];q(this._selectedDates,function(c){q(c,function(b){q(b,function(b){a.push(b)},this)},this)},this);return a},_getSelectedDatesInMonth:function(a){var c=a.getFullYear(),a=a.getMonth();return r(this._selectedDates,c)&&r(this._selectedDates[c],a)?g.Object.values(this._selectedDates[c][a]):[]},_renderSelectedDate:function(a){this._isDateVisible(a)&&this._dateToNode(a).addClass(l).setAttribute("aria-selected",!0)},_renderUnselectedDate:function(a){this._isDateVisible(a)&&
this._dateToNode(a).removeClass(l).setAttribute("aria-selected",!1)},_isDateVisible:function(a){var c=this.get("date"),b=k.addMonths(c,this._paneNumber-1),a=this._normalizeDate(a).getTime();return c.getTime()<=a&&a<=b?!0:!1},_isNumInList:function(a,c){if("all"==c)return!0;for(var b=c.split(","),e=b.length;e--;){var d=b[e].split("-");if(2==d.length&&a>=parseInt(d[0],10)&&a<=parseInt(d[1],10)||1==d.length&&parseInt(b[e],10)==a)return!0}return!1},_getRulesForDate:function(a){var c=a.getFullYear(),b=
a.getMonth(),e=a.getDate(),a=a.getDay(),d=this._rules,j=[],f,i,h,g;for(f in d)if(this._isNumInList(c,f))if(o.isString(d[f]))j.push(d[f]);else for(i in d[f])if(this._isNumInList(b,i))if(o.isString(d[f][i]))j.push(d[f][i]);else for(h in d[f][i])if(this._isNumInList(e,h))if(o.isString(d[f][i][h]))j.push(d[f][i][h]);else for(g in d[f][i][h])this._isNumInList(a,g)&&o.isString(d[f][i][h][g])&&j.push(d[f][i][h][g]);return j},_matchesRule:function(a,c){return 0<=v(this._getRulesForDate(a),c)},_canBeSelected:function(a){var c=
this.get("enabledDatesRule"),b=this.get("disabledDatesRule");return c?this._matchesRule(a,c):b?!this._matchesRule(a,b):!0},selectDates:function(a){k.isValidDate(a)?this._addDateToSelection(a):o.isArray(a)&&this._addDatesToSelection(a)},deselectDates:function(a){a?k.isValidDate(a)?this._removeDateFromSelection(a):o.isArray(a)&&this._removeDatesFromSelection(a):this._clearSelection()},_addDateToSelection:function(a,c){if(this._canBeSelected(a)){var b=a.getFullYear(),e=a.getMonth(),d=a.getDate();r(this._selectedDates,
b)?r(this._selectedDates[b],e)||(this._selectedDates[b][e]={}):(this._selectedDates[b]={},this._selectedDates[b][e]={});this._selectedDates[b][e][d]=a;this._selectedDates=H(this._selectedDates,[b,e,d],a);this._renderSelectedDate(a);c||this._fireSelectionChange()}},_addDatesToSelection:function(a){q(a,this._addDateToSelection,this);this._fireSelectionChange()},_addDateRangeToSelection:function(a,c){var b=6E4*(c.getTimezoneOffset()-a.getTimezoneOffset()),e=a.getTime(),d=c.getTime();if(e>d)var j=e,e=
d,d=j+b;else d-=b;for(b=e;b<=d;b+=864E5)e=new Date(b),e.setHours(12),this._addDateToSelection(e,b);this._fireSelectionChange()},_removeDateFromSelection:function(a,c){var b=a.getFullYear(),e=a.getMonth(),d=a.getDate();r(this._selectedDates,b)&&r(this._selectedDates[b],e)&&r(this._selectedDates[b][e],d)&&(delete this._selectedDates[b][e][d],this._renderUnselectedDate(a),c||this._fireSelectionChange())},_removeDatesFromSelection:function(a){q(a,this._removeDateDromSelection);this._fireSelectionChange()},
_removeDateRangeFromSelection:function(a,c){for(var b=a.getTime(),e=c.getTime();b<=e;b+=864E5)this._removeDateFromSelection(new Date(b),b);this._fireSelectionChange()},_clearSelection:function(a){this._selectedDates={};this.get("contentBox").all("."+l).removeClass(l).setAttribute("aria-selected",!1);a||this._fireSelectionChange()},_fireSelectionChange:function(){this.fire("selectionChange",{newSelection:this._getSelectedDatesList()})},_restoreModifiedCells:function(){var a=this.get("contentBox"),
c;for(c in this._storedDateCells)a.one("#"+c).replace(this._storedDateCells[c]),delete this._storedDateCells[c]},_renderCustomRules:function(){this.get("contentBox").all("."+m+",."+i).removeClass(u).setAttribute("aria-disabled",!1);if(!I(this._rules))for(var a=this.get("enabledDatesRule"),c=this.get("disabledDatesRule"),b=0;b<this._paneNumber;b++){var e=k.addMonths(this.get("date"),b),e=k.listOfDatesInMonth(e);q(e,function(b){var e=this._getRulesForDate(b);if(0<e.length){var f=this._dateToNode(b);
(a&&0>v(e,a)||!a&&c&&0<=v(e,c))&&f.addClass(u).setAttribute("aria-disabled",!0);o.isFunction(this._filterFunction)&&(this._storedDateCells[f.get("id")]=f.cloneNode(!0),this._filterFunction(b,f,e))}else a&&(f=this._dateToNode(b),f.addClass(u).setAttribute("aria-disabled",!0))},this)}},_renderSelectedDates:function(){this.get("contentBox").all("."+l).removeClass(l).setAttribute("aria-selected",!1);for(var a=0;a<this._paneNumber;a++){var c=this._getSelectedDatesInMonth(k.addMonths(this.get("date"),a));
q(c,function(a){this._dateToNode(a).addClass(l).setAttribute("ari-selected",!0)},this)}},_dateToNode:function(a){var c=a.getDate(),b=0,e=c%7,a=(12+a.getMonth()-this.get("date").getMonth())%12,d=this._paneProperties[this._calendarId+"_pane_"+a].cutoffCol;switch(e){case 0:b=6<=d?12:5;break;case 1:b=6;break;case 2:b=0<d?7:0;break;case 3:b=1<d?8:1;break;case 4:b=2<d?9:2;break;case 5:b=3<d?10:3;break;case 6:b=4<d?11:4}return this.get("contentBox").one("#"+this._calendarId+"_pane_"+a+"_"+b+"_"+c)},_nodeToDate:function(a){var a=
a.get("id").split("_").reverse(),c=parseInt(a[2],10),a=parseInt(a[0],10),b=k.addMonths(this.get("date"),c),c=b.getFullYear(),b=b.getMonth();return new Date(c,b,a,12,0,0,0)},_bindCalendarEvents:function(){},_normalizeDate:function(a){return a?new Date(a.getFullYear(),a.getMonth(),1,12,0,0,0):null},_getCutoffColumn:function(a,c){return 6-(this._normalizeDate(a).getDay()-c+7)%7},_turnPrevMonthOn:function(a){var c=a.get("id"),b=k.daysInMonth(k.addMonths(this._paneProperties[c].paneDate,-1));this._paneProperties[c].hasOwnProperty("daysInPrevMonth")||
(this._paneProperties[c].daysInPrevMonth=0);if(b!=this._paneProperties[c].daysInPrevMonth){this._paneProperties[c].daysInPrevMonth=b;for(var e=5;0<=e;e--)a.one("#"+c+"_"+e+"_"+(e-5)).set("text",b--)}},_turnPrevMonthOff:function(a){var c=a.get("id");this._paneProperties[c].daysInPrevMonth=0;for(var b=5;0<=b;b--)a.one("#"+c+"_"+b+"_"+(b-5)).setContent("&nbsp;")},_cleanUpNextMonthCells:function(a){var c=a.get("id");a.one("#"+c+"_6_29").removeClass(i);a.one("#"+c+"_7_30").removeClass(i);a.one("#"+c+"_8_31").removeClass(i);
a.one("#"+c+"_0_30").removeClass(i);a.one("#"+c+"_1_31").removeClass(i)},_turnNextMonthOn:function(a){for(var c=1,b=a.get("id"),e=this._paneProperties[b].daysInMonth,d=this._paneProperties[b].cutoffCol,j=e-22;j<d+7;j++)a.one("#"+b+"_"+j+"_"+(j+23)).set("text",c++).addClass(i);j=d;for(31==e&&1>=d?j=2:30==e&&0===d&&(j=1);j<d+7;j++)a.one("#"+b+"_"+j+"_"+(j+30)).set("text",c++).addClass(i)},_turnNextMonthOff:function(a){for(var c=a.get("id"),b=this._paneProperties[c].daysInMonth,e=this._paneProperties[c].cutoffCol,
d=b-22;12>=d;d++)a.one("#"+c+"_"+d+"_"+(d+23)).setContent("&nbsp;").addClass(i);d=0;for(31==b&&1>=e?d=2:30==b&&0===e&&(d=1);12>=d;d++)a.one("#"+c+"_"+d+"_"+(d+30)).setContent("&nbsp;").addClass(i)},_afterShowNextMonthChange:function(){var a=this.get("contentBox").one("#"+this._calendarId+"_pane_"+(this._paneNumber-1));this._cleanUpNextMonthCells(a);this.get("showNextMonth")?this._turnNextMonthOn(a):this._turnNextMonthOff(a)},_afterShowPrevMonthChange:function(){var a=this.get("contentBox").one("#"+
this._calendarId+"_pane_0");this.get("showPrevMonth")?this._turnPrevMonthOn(a):this._turnPrevMonthOff(a)},_afterHeaderRendererChange:function(){this.get("contentBox").one("."+s).setContent(this._updateCalendarHeader(this.get("date")))},_afterCustomRendererChange:function(){this._restoreModifiedCells();this._renderCustomRules()},_afterDateChange:function(){var a=this.get("contentBox"),c=a.one("."+x).one("."+s),b=a.all("."+w),e=this.get("date"),d=0;a.setStyle("visibility","hidden");c.setContent(this._updateCalendarHeader(e));
this._restoreModifiedCells();b.each(function(a){this._rerenderCalendarPane(k.addMonths(e,d++),a)},this);this._afterShowPrevMonthChange();this._afterShowNextMonthChange();this._renderCustomRules();this._renderSelectedDates();a.setStyle("visibility","visible")},_initCalendarPane:function(a,c){for(var b=this.get("strings.very_short_weekdays")||"Su,Mo,Tu,We,Th,Fr,Sa".split(","),e=this.get("strings.weekdays")||"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),d=this.get("strings.first_weekday")||
0,j=this._getCutoffColumn(a,d),f=k.daysInMonth(a),h=",,,,,".split(","),g={weekday_row:""},l=d;l<=d+6;l++)g.weekday_row+=p(n.WEEKDAY_TEMPLATE,{weekdayname:b[l%7],full_weekdayname:e[l%7]});g.weekday_row_template=p(n.WEEKDAY_ROW_TEMPLATE,g);for(b=0;5>=b;b++)for(e=0;12>=e;e++){var d=7*b-5+e,l=c+"_"+e+"_"+d,o=m;1>d?o=E:d>f&&(o=i);if(1>d||d>f)d="&nbsp;";h[b]+=p(n.CALDAY_TEMPLATE,{day_content:d,calendar_col_class:"calendar_col"+e,calendar_col_visibility_class:e>=j&&e<j+7?"":t,calendar_day_class:o,calendar_day_id:l})}g.body_template=
"";q(h,function(a){g.body_template+=p(n.CALDAY_ROW_TEMPLATE,{calday_row:a})});g.calendar_pane_id=c;g.calendar_pane_tabindex=this.get("tabIndex");g.pane_arialabel=k.format(a,{format:"%B %Y"});h=p(p(n.CALENDAR_GRID_TEMPLATE,g),n.CALENDAR_STRINGS);this._paneProperties[c]={cutoffCol:j,daysInMonth:f,paneDate:a};return h},_rerenderCalendarPane:function(a,c){var b=this.get("strings.first_weekday")||0,b=this._getCutoffColumn(a,b),e=k.daysInMonth(a),d=c.get("id");c.setStyle("visibility","hidden");c.setAttribute("aria-label",
k.format(a,{format:"%B %Y"}));for(var g=0;12>=g;g++){var f=c.all(".calendar_col"+g);f.removeClass(t);if(g<b||g>=b+7)f.addClass(t);else switch(g){case 0:f=c.one("#"+d+"_0_30");30<=e?(f.set("text","30"),f.removeClass(i).addClass(m)):(f.setContent("&nbsp;"),f.addClass(i).addClass(m));break;case 1:f=c.one("#"+d+"_1_31");31<=e?(f.set("text","31"),f.removeClass(i).addClass(m)):(f.setContent("&nbsp;"),f.removeClass(m).addClass(i));break;case 6:f=c.one("#"+d+"_6_29");29<=e?(f.set("text","29"),f.removeClass(i).addClass(m)):
(f.setContent("&nbsp;"),f.removeClass(m).addClass(i));break;case 7:f=c.one("#"+d+"_7_30");30<=e?(f.set("text","30"),f.removeClass(i).addClass(m)):(f.setContent("&nbsp;"),f.removeClass(m).addClass(i));break;case 8:f=c.one("#"+d+"_8_31"),31<=e?(f.set("text","31"),f.removeClass(i).addClass(m)):(f.setContent("&nbsp;"),f.removeClass(m).addClass(i))}}this._paneProperties[d].cutoffCol=b;this._paneProperties[d].daysInMonth=e;this._paneProperties[d].paneDate=a;c.setStyle("visibility","visible")},_updateCalendarHeader:function(a){var c=
"",b=this.get("headerRenderer");g.Lang.isString(b)?c=k.format(a,{format:b}):b instanceof Function&&(c=b.call(this,a));return c},_initCalendarHeader:function(a){return p(p(n.HEADER_TEMPLATE,{calheader:this._updateCalendarHeader(a),calendar_id:this._calendarId}),n.CALENDAR_STRINGS)},_initCalendarHTML:function(a){var c={},b=0;c.header_template=this._initCalendarHeader(a);c.calendar_id=this._calendarId;c.body_template=p(p(n.CONTENT_TEMPLATE,c),n.CALENDAR_STRINGS);var e=c.body_template.replace(/\{calendar_grid_template\}/g,
g.bind(function(){var d=this._initCalendarPane(k.addMonths(a,b),c.calendar_id+"_pane_"+b);b++;return d},this));this._paneNumber=b;return e}},{CALENDAR_STRINGS:{calendar_grid_class:w,calendar_body_class:A,calendar_hd_class:x,calendar_hd_label_class:s,calendar_weekdayrow_class:B,calendar_weekday_class:C,calendar_row_class:D,calendar_day_class:m,calendar_dayanchor_class:F,calendar_pane_class:G,calendar_right_grid_class:z,calendar_left_grid_class:y,calendar_status_class:h},CONTENT_TEMPLATE:'<div class="yui3-g {calendar_pane_class}" id="{calendar_id}">{header_template}<div class="yui3-u-1">{calendar_grid_template}</div></div>',
ONE_PANE_TEMPLATE:'<div class="yui3-g {calendar_pane_class}" id="{calendar_id}">{header_template}<div class="yui3-u-1">{calendar_grid_template}</div></div>',TWO_PANE_TEMPLATE:'<div class="yui3-g {calendar_pane_class}" id="{calendar_id}">{header_template}<div class="yui3-u-1-2"><div class = "{calendar_left_grid_class}">{calendar_grid_template}</div></div><div class="yui3-u-1-2"><div class = "{calendar_right_grid_class}">{calendar_grid_template}</div></div></div>',THREE_PANE_TEMPLATE:'<div class="yui3-g {calendar_pane_class}" id="{calendar_id}">{header_template}<div class="yui3-u-1-3"><div class = "{calendar_left_grid_class}">{calendar_grid_template}</div></div><div class="yui3-u-1-3">{calendar_grid_template}</div><div class="yui3-u-1-3"><div class = "{calendar_right_grid_class}">{calendar_grid_template}</div></div></div>',
CALENDAR_GRID_TEMPLATE:'<table class="{calendar_grid_class}" id="{calendar_pane_id}" role="grid" aria-readonly="true" aria-label="{pane_arialabel}" tabindex="{calendar_pane_tabindex}"><thead>{weekday_row_template}</thead><tbody>{body_template}</tbody></table>',HEADER_TEMPLATE:'<div class="yui3-g {calendar_hd_class}"><div class="yui3-u {calendar_hd_label_class}" id="{calendar_id}_header" aria-role="heading">{calheader}</div></div>',WEEKDAY_ROW_TEMPLATE:'<tr class="{calendar_weekdayrow_class}" role="row">{weekday_row}</tr>',
CALDAY_ROW_TEMPLATE:'<tr class="{calendar_row_class}" role="row">{calday_row}</tr>',WEEKDAY_TEMPLATE:'<th class="{calendar_weekday_class}" role="columnheader" aria-label="{full_weekdayname}">{weekdayname}</th>',CALDAY_TEMPLATE:'<td class="{calendar_col_class} {calendar_day_class} {calendar_col_visibility_class}" id="{calendar_day_id}" role="gridcell" tabindex="-1">{day_content}</td>',NAME:"calendarBase",ATTRS:{tabIndex:{value:1},date:{value:new Date,setter:function(a){a=this._normalizeDate(a);return k.areEqual(a,
this.get("date"))?this.get("date"):a}},showPrevMonth:{value:!1},showNextMonth:{value:!1},strings:{valueFn:function(){return g.Intl.get("calendar-base")}},headerRenderer:{value:"%B %Y"},enabledDatesRule:{value:null},disabledDatesRule:{value:null},selectedDates:{readOnly:!0,getter:function(){return this._getSelectedDatesList()}},customRenderer:{value:{},setter:function(a){this._rules=a.rules;this._filterFunction=a.filterFunction}}}})},"3.5.0",{requires:["widget","substitute","datatype-date","datatype-date-math",
"cssgrids"],lang:"de,en,fr,ja,nb-NO,pt-BR,ru,zh-HANT-TW".split(",")});
