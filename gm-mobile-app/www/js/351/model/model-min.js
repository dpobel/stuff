YUI.add("model",function(h){function k(){k.superclass.constructor.apply(this,arguments)}var l=YUI.namespace("Env.Model"),j=h.Lang,n=h.Array,i=h.Object,m="error";h.Model=h.extend(k,h.Base,{idAttribute:"id",_allowAdHocAttrs:!0,_isYUIModel:!0,initializer:function(){this.changed={};this.lastChange={};this.lists=[]},destroy:function(a,c){var b=this;"function"===typeof a&&(c=a,a=null);b.onceAfter("destroy",function(){function d(d){d||n.each(b.lists.concat(),function(c){c.remove(b,a)});c&&c.apply(null,arguments)}
a&&(a.remove||a["delete"])?b.sync("delete",a,d):d()});return k.superclass.destroy.call(b)},generateClientId:function(){l.lastId||(l.lastId=0);return this.constructor.NAME+"_"+(l.lastId+=1)},getAsHTML:function(a){a=this.get(a);return h.Escape.html(j.isValue(a)?""+a:"")},getAsURL:function(a){a=this.get(a);return encodeURIComponent(j.isValue(a)?""+a:"")},isModified:function(){return this.isNew()||!i.isEmpty(this.changed)},isNew:function(){return!j.isValue(this.get("id"))},load:function(a,c){var b=this;
"function"===typeof a&&(c=a,a={});a||(a={});b.sync("read",a,function(d,e){var f={options:a,response:e},g;if(d){f.error=d;f.src="load";b.fire(m,f)}else{if(!b._loadEvent)b._loadEvent=b.publish("load",{preventable:false});g=f.parsed=b.parse(e);b.setAttrs(g,a);b.changed={};b.fire("load",f)}c&&c.apply(null,arguments)});return b},parse:function(a){if("string"===typeof a)try{return h.JSON.parse(a)}catch(c){return this.fire(m,{error:c,response:a,src:"parse"}),null}return a},save:function(a,c){var b=this;
"function"===typeof a&&(c=a,a={});a||(a={});b._validate(b.toJSON(),function(d){d?c&&c.call(null,d):b.sync(b.isNew()?"create":"update",a,function(d,f){var g={options:a,response:f},h;if(d){g.error=d;g.src="save";b.fire(m,g)}else{if(!b._saveEvent)b._saveEvent=b.publish("save",{preventable:false});if(f){h=g.parsed=b.parse(f);b.setAttrs(h,a)}b.changed={};b.fire("save",g)}c&&c.apply(null,arguments)})});return b},set:function(a,c,b){var d={};d[a]=c;return this.setAttrs(d,b)},setAttrs:function(a,c){var b=
this.idAttribute,d,e,f,g;c||(c={});g=c._transaction={};"id"!==b&&(a=h.merge(a),i.owns(a,b)?a.id=a[b]:i.owns(a,"id")&&(a[b]=a.id));for(e in a)i.owns(a,e)&&this._setAttr(e,a[e],c);if(!i.isEmpty(g)){b=this.changed;f=this.lastChange={};for(e in g)i.owns(g,e)&&(d=g[e],b[e]=d.newVal,f[e]={newVal:d.newVal,prevVal:d.prevVal,src:d.src||null});c.silent||(this._changeEvent||(this._changeEvent=this.publish("change",{preventable:!1})),this.fire("change",h.merge(c,{changed:f})))}return this},sync:function(){var a=
n(arguments,0,!0).pop();"function"===typeof a&&a()},toJSON:function(){var a=this.getAttrs();delete a.clientId;delete a.destroyed;delete a.initialized;"id"!==this.idAttribute&&delete a.id;return a},undo:function(a,c){var b=this.lastChange,d=this.idAttribute,e={},f;a||(a=i.keys(b));n.each(a,function(a){i.owns(b,a)&&(a=a===d?"id":a,f=!0,e[a]=b[a].prevVal)});return f?this.setAttrs(e,c):this},validate:function(a,c){c&&c()},addAttr:function(a,c,b){var d=this.idAttribute,e;if(d&&a===d&&(d=this._isLazyAttr("id")||
this._getAttrCfg("id"),e=c.value===c.defaultValue?null:c.value,j.isValue(e)||(e=d.value===d.defaultValue?null:d.value,j.isValue(e)||(e=j.isValue(c.defaultValue)?c.defaultValue:d.defaultValue)),c.value=e,d.value!==e))d.value=e,this._isLazyAttr("id")?this._state.add("id","lazy",d):this._state.add("id","value",e);return k.superclass.addAttr.apply(this,arguments)},_validate:function(a,c){function b(b){j.isValue(b)?(d.fire(m,{attributes:a,error:b,src:"validate"}),c(b)):c()}var d=this;1===d.validate.length?
b(d.validate(a,b)):d.validate(a,b)},_defAttrChangeFn:function(a){var c=a.attrName;this._setAttrVal(c,a.subAttrName,a.prevVal,a.newVal)?(a.newVal=this.get(c),a._transaction&&(a._transaction[c]=a)):a.stopImmediatePropagation()}},{NAME:"model",ATTRS:{clientId:{valueFn:"generateClientId",readOnly:!0},id:{value:null}}})},"3.5.1",{requires:["base-build","escape","json-parse"]});
