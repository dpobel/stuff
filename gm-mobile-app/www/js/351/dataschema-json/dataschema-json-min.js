YUI.add("dataschema-json",function(l){var p=l.Lang,s=p.isFunction,k=p.isObject,r=p.isArray,q=l.DataSchema.Base,i;i={getPath:function(a){var b=null,d=[],c=0;if(a){a=a.replace(/\[\s*(['"])(.*?)\1\s*\]/g,function(a,b,g){d[c]=g;return".@"+c++}).replace(/\[(\d+)\]/g,function(a,b){d[c]=parseInt(b,10)|0;return".@"+c++}).replace(/^\./,"");b=a.split(".");for(c=b.length-1;0<=c;--c)"@"===b[c].charAt(0)&&(b[c]=d[parseInt(b[c].substr(1),10)])}return b},getLocationValue:function(a,b){for(var d=0,c=a.length;d<c;d++)if(k(b)&&
a[d]in b)b=b[a[d]];else{b=void 0;break}return b},apply:function(a,b){var d=b,c={results:[],meta:{}};if(!k(b))try{d=l.JSON.parse(b)}catch(f){return c.error=f,c}k(d)&&a?(c=i._parseResults.call(this,a,d,c),void 0!==a.metaFields&&(c=i._parseMeta(a.metaFields,d,c))):c.error=Error("JSON schema parse failure");return c},_parseResults:function(a,b,d){var c=i.getPath,f=i.getLocationValue,b=(c=c(a.resultListLocator))?f(c,b)||b[a.resultListLocator]:b;r(b)?r(a.resultFields)?d=i._getFieldValues.call(this,a.resultFields,
b,d):d.results=b:a.resultListLocator&&(d.results=[],d.error=Error("JSON results retrieval failure"));return d},_getFieldValues:function(a,b,d){var c=[],f=a.length,j,g,h,k,e,m=[],n=[],o=[];for(j=0;j<f;j++)g=a[j],h=g.key||g,k=g.locator||h,(e=i.getPath(k))&&(1===e.length?m.push({key:h,path:e[0]}):n.push({key:h,path:e,locator:k})),(e=s(g.parser)?g.parser:l.Parsers[g.parser+""])&&o.push({key:h,parser:e});for(j=b.length-1;0<=j;--j)if(f={},g=b[j]){for(a=n.length-1;0<=a;--a){e=n[a];h=i.getLocationValue(e.path,
g);if(void 0===h&&(h=i.getLocationValue([e.locator],g),void 0!==h)){m.push({key:e.key,path:e.locator});n.splice(j,1);continue}f[e.key]=q.parse.call(this,i.getLocationValue(e.path,g),e)}for(a=m.length-1;0<=a;--a)e=m[a],f[e.key]=q.parse.call(this,void 0===g[e.path]?g[a]:g[e.path],e);for(a=o.length-1;0<=a;--a)h=o[a].key,f[h]=o[a].parser.call(this,f[h]),void 0===f[h]&&(f[h]=null);c[j]=f}d.results=c;return d},_parseMeta:function(a,b,d){if(k(a)){var c,f;for(c in a)a.hasOwnProperty(c)&&(f=i.getPath(a[c]))&&
b&&(d.meta[c]=i.getLocationValue(f,b))}else d.error=Error("JSON meta data retrieval failure");return d}};l.DataSchema.JSON=l.mix(i,q)},"3.5.1",{requires:["dataschema-base","json"]});
