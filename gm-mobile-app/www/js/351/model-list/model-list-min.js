YUI.add("model-list",function(d){function j(){j.superclass.constructor.apply(this,arguments)}var k=d.Attribute.prototype,g=d.Lang,e=d.Array;d.ModelList=d.extend(j,d.Base,{model:d.Model,_isYUIModelList:!0,initializer:function(a){a||(a={});a=this.model=a.model||this.model;"string"===typeof a&&((this.model=d.Object.getValue(d,a.split(".")))||d.error("ModelList: Model class not found: "+a));this.publish("add",{defaultFn:this._defAddFn});this.publish("reset",{defaultFn:this._defResetFn});this.publish("remove",
{defaultFn:this._defRemoveFn});this.after("*:idChange",this._afterIdChange);this._clear()},destructor:function(){e.each(this._items,this._detachList,this)},add:function(a,b){var c=a._isYUIModelList;return c||g.isArray(a)?e.map(c?a.toArray():a,function(a){return this._add(a,b)},this):this._add(a,b)},create:function(a,b,c){var h=this;"function"===typeof b&&(c=b,b={});b||(b={});a._isYUIModel||(a=new this.model(a));h.fire("create",d.merge(b,{model:a}));return a.save(b,function(d){d||h.add(a,b);c&&c.apply(null,
arguments)})},filter:function(a,b){var c=[],h=this._items,i,f,e;"function"===typeof a&&(b=a,a={});i=0;for(e=h.length;i<e;++i)f=h[i],b.call(this,f,i,this)&&c.push(f);return a.asList?(h=new d.ModelList({model:this.model}),c.length&&h.add(c,{silent:!0}),h):c},get:function(a){return this.attrAdded(a)?k.get.apply(this,arguments):this.invoke("get",a)},getAsHTML:function(a){return this.attrAdded(a)?d.Escape.html(k.get.apply(this,arguments)):this.invoke("getAsHTML",a)},getAsURL:function(a){return this.attrAdded(a)?
encodeURIComponent(k.get.apply(this,arguments)):this.invoke("getAsURL",a)},getByClientId:function(a){return this._clientIdMap[a]||null},getById:function(a){return this._idMap[a]||null},invoke:function(a){var b=[this._items,a].concat(e(arguments,1,!0));return e.invoke.apply(e,b)},load:function(a,b){var c=this;"function"===typeof a&&(b=a,a={});a||(a={});this.sync("read",a,function(d,e){var f={options:a,response:e},g;if(d){f.error=d;f.src="load";c.fire("error",f)}else{if(!c._loadEvent)c._loadEvent=c.publish("load",
{preventable:false});g=f.parsed=c.parse(e);c.reset(g,a);c.fire("load",f)}b&&b.apply(null,arguments)});return this},map:function(a,b){return e.map(this._items,a,b)},parse:function(a){if("string"===typeof a)try{return d.JSON.parse(a)||[]}catch(b){return this.fire("error",{error:b,response:a,src:"parse"}),null}return a||[]},remove:function(a,b){var c=a._isYUIModelList;return c||g.isArray(a)?e.map(c?a.toArray():a,function(a){return this._remove(a,b)},this):this._remove(a,b)},reset:function(a,b){a||(a=
[]);b||(b={});var c=d.merge({src:"reset"},b),a=a._isYUIModelList?a.toArray():e.map(a,function(a){return a._isYUIModel?a:new this.model(a)},this);c.models=a;b.silent?this._defResetFn(c):(this.comparator&&a.sort(d.bind(this._sort,this)),this.fire("reset",c));return this},sort:function(a){if(!this.comparator)return this;var b=this._items.concat();a||(a={});b.sort(d.bind(this._sort,this));b=d.merge(a,{models:b,src:"sort"});a.silent?this._defResetFn(b):this.fire("reset",b);return this},sync:function(){var a=
e(arguments,0,!0).pop();"function"===typeof a&&a()},toArray:function(){return this._items.concat()},toJSON:function(){return this.map(function(a){return a.toJSON()})},_add:function(a,b){var c;b||(b={});a._isYUIModel||(a=new this.model(a));c=a.get("id");if(this._clientIdMap[a.get("clientId")]||g.isValue(c)&&this._idMap[c])this.fire("error",{error:"Model is already in the list.",model:a,src:"add"});else return c=d.merge(b,{index:this._findIndex(a),model:a}),b.silent?this._defAddFn(c):this.fire("add",
c),a},_attachList:function(a){a.lists.push(this);a.addTarget(this)},_clear:function(){e.each(this._items,this._detachList,this);this._clientIdMap={};this._idMap={};this._items=[]},_compare:function(a,b){return a<b?-1:a>b?1:0},_detachList:function(a){var b=e.indexOf(a.lists,this);-1<b&&(a.lists.splice(b,1),a.removeTarget(this))},_findIndex:function(a){var b=this._items,c=b.length,d=0,e,f;if(!this.comparator||!c)return c;for(f=this.comparator(a);d<c;)e=d+c>>1,a=b[e],0>this._compare(this.comparator(a),
f)?d=e+1:c=e;return d},_remove:function(a,b){var c=this.indexOf(a);b||(b={});if(-1===c)this.fire("error",{error:"Model is not in the list.",model:a,src:"remove"});else return c=d.merge(b,{index:c,model:a}),b.silent?this._defRemoveFn(c):this.fire("remove",c),a},_sort:function(a,b){return this._compare(this.comparator(a),this.comparator(b))},_afterIdChange:function(a){g.isValue(a.prevVal)&&delete this._idMap[a.prevVal];g.isValue(a.newVal)&&(this._idMap[a.newVal]=a.target)},_defAddFn:function(a){var b=
a.model,c=b.get("id");this._clientIdMap[b.get("clientId")]=b;g.isValue(c)&&(this._idMap[c]=b);this._attachList(b);this._items.splice(a.index,0,b)},_defRemoveFn:function(a){var b=a.model,c=b.get("id");this._detachList(b);delete this._clientIdMap[b.get("clientId")];g.isValue(c)&&delete this._idMap[c];this._items.splice(a.index,1)},_defResetFn:function(a){"sort"===a.src?this._items=a.models.concat():(this._clear(),a.models.length&&this.add(a.models,{silent:!0}))}},{NAME:"modelList"});d.augment(j,d.ArrayList)},
"3.5.1",{requires:"array-extras,array-invoke,arraylist,base-build,escape,json-parse,model".split(",")});
