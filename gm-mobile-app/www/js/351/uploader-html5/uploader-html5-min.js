YUI.add("uploader-html5",function(c){function f(a){f.superclass.constructor.apply(this,arguments)}var g=c.substitute,d=c.Uploader.Queue;c.UploaderHTML5=c.extend(f,c.Widget,{_fileInputField:null,_buttonBinding:null,queue:null,initializer:function(){this._buttonBinding=this.queue=this._fileInputField=null;this.publish("fileselect");this.publish("uploadstart");this.publish("fileuploadstart");this.publish("uploadprogress");this.publish("totaluploadprogress");this.publish("uploadcomplete");this.publish("alluploadscomplete");
this.publish("uploaderror");this.publish("dragenter");this.publish("dragover");this.publish("dragleave");this.publish("drop")},renderUI:function(){this.get("boundingBox");var a=this.get("contentBox"),b=this.get("selectFilesButton");b.setStyles({width:"100%",height:"100%"});a.append(b);this._fileInputField=c.Node.create(f.HTML5FILEFIELD_TEMPLATE);a.append(this._fileInputField)},bindUI:function(){this._bindSelectButton();this._setMultipleFiles();this._bindDropArea();this._triggerEnabled();this.after("multipleFilesChange",
this._setMultipleFiles,this);this.after("enabledChange",this._triggerEnabled,this);this.after("selectFilesButtonChange",this._bindSelectButton,this);this.after("dragAndDropAreaChange",this._bindDropArea,this);this.after("tabIndexChange",function(){this.get("selectFilesButton").set("tabIndex",this.get("tabIndex"))},this);this._fileInputField.on("change",this._updateFileList,this);this.get("selectFilesButton").set("tabIndex",this.get("tabIndex"))},_bindDropArea:function(a){a=a||{prevVal:null};null!==
a.prevVal&&(a.prevVal.detach("drop",this._ddEventHandler),a.prevVal.detach("dragenter",this._ddEventHandler),a.prevVal.detach("dragover",this._ddEventHandler),a.prevVal.detach("dragleave",this._ddEventHandler));a=this.get("dragAndDropArea");null!==a&&(a.on("drop",this._ddEventHandler,this),a.on("dragenter",this._ddEventHandler,this),a.on("dragover",this._ddEventHandler,this),a.on("dragleave",this._ddEventHandler,this))},_bindSelectButton:function(){this._buttonBinding=this.get("selectFilesButton").on("click",
this.openFileSelectDialog,this)},_ddEventHandler:function(a){a.stopPropagation();a.preventDefault();switch(a.type){case "dragenter":this.fire("dragenter");break;case "dragover":this.fire("dragover");break;case "dragleave":this.fire("dragleave");break;case "drop":var b=[];c.each(a._event.dataTransfer.files,function(a){b.push(new c.FileHTML5(a))});this.fire("fileselect",{fileList:b});a=this.get("fileList");this.set("fileList",this.get("appendNewFiles")?a.concat(b):b)}},_setButtonClass:function(a,b){b?
this.get("selectFilesButton").addClass(this.get("buttonClassNames")[a]):this.get("selectFilesButton").removeClass(this.get("buttonClassNames")[a])},_setMultipleFiles:function(){!0===this.get("multipleFiles")?this._fileInputField.set("multiple","multiple"):this._fileInputField.set("multiple","")},_triggerEnabled:function(){this.get("enabled")&&null===this._buttonBinding?(this._bindSelectButton(),this._setButtonClass("disabled",!1),this.get("selectFilesButton").setAttribute("aria-disabled","false")):
!this.get("enabled")&&this._buttonBinding&&(this._buttonBinding.detach(),this._buttonBinding=null,this._setButtonClass("disabled",!0),this.get("selectFilesButton").setAttribute("aria-disabled","true"))},_updateFileList:function(a){var a=a.target.getDOMNode().files,b=[];c.each(a,function(a){b.push(new c.FileHTML5(a))});this.fire("fileselect",{fileList:b});a=this.get("fileList");this.set("fileList",this.get("appendNewFiles")?a.concat(b):b)},_uploadEventHandler:function(a){switch(a.type){case "file:uploadstart":this.fire("fileuploadstart",
a);break;case "file:uploadprogress":this.fire("uploadprogress",a);break;case "uploaderqueue:totaluploadprogress":this.fire("totaluploadprogress",a);break;case "file:uploadcomplete":this.fire("uploadcomplete",a);break;case "uploaderqueue:alluploadscomplete":this.queue=null;this.fire("alluploadscomplete",a);break;case "uploaderqueue:uploaderror":this.fire("uploaderror",a)}},openFileSelectDialog:function(){var a=this._fileInputField.getDOMNode();a.click&&a.click()},upload:function(a,b,e){var b=b||this.get("uploadURL"),
e=e||this.get("postVarsPerFile"),d=a.get("id"),e=e.hasOwnProperty(d)?e[d]:e;a instanceof c.FileHTML5&&(a.on("uploadstart",this._uploadStartHandler,this),a.on("uploadprogress",this._uploadProgressHandler,this),a.on("uploadcomplete",this._uploadCompleteHandler,this),a.on("uploaderror",this._uploadErrorHandler,this),a.startUpload(b,e,this.get("fileFieldName")))},uploadAll:function(a,b){this.uploadThese(this.get("fileList"),a,b)},uploadThese:function(a,b,c){this.queue||(b=b||this.get("uploadURL"),c=c||
this.get("postVarsPerFile"),this.queue=new d({simUploads:this.get("simLimit"),errorAction:this.get("errorAction"),fileFieldName:this.get("fileFieldName"),fileList:a,uploadURL:b,perFileParameters:c}),this.queue.on("uploadstart",this._uploadEventHandler,this),this.queue.on("uploadprogress",this._uploadEventHandler,this),this.queue.on("totaluploadprogress",this._uploadEventHandler,this),this.queue.on("uploadcomplete",this._uploadEventHandler,this),this.queue.on("alluploadscomplete",this._uploadEventHandler,
this),this.queue.on("uploaderror",this._uploadEventHandler,this),this.queue.startUpload(),this.fire("uploadstart"))}},{HTML5FILEFIELD_TEMPLATE:"<input type='file' style='visibility:hidden; width:0px; height: 0px;'>",SELECT_FILES_BUTTON:"<button type='button' class='yui3-button' role='button' aria-label='{selectButtonLabel}' tabindex='{tabIndex}'>{selectButtonLabel}</button>",TYPE:"html5",NAME:"uploader",ATTRS:{appendNewFiles:{value:!0},buttonClassNames:{value:{hover:"yui3-button-hover",active:"yui3-button-active",
disabled:"yui3-button-disabled",focus:"yui3-button-selected"}},dragAndDropArea:{value:null,setter:function(a){return c.one(a)}},enabled:{value:!0},errorAction:{value:"continue",validator:function(a){return a===d.CONTINUE||a===d.STOP||a===d.RESTART_ASAP||a===d.RESTART_AFTER}},fileFieldName:{value:"Filedata"},fileList:{value:[]},multipleFiles:{value:!1},postVarsPerFile:{value:{}},selectButtonLabel:{value:"Select Files"},selectFilesButton:{valueFn:function(){return c.Node.create(g(c.UploaderHTML5.SELECT_FILES_BUTTON,
{selectButtonLabel:this.get("selectButtonLabel"),tabIndex:this.get("tabIndex")}))}},simLimit:{value:2,validator:function(a){return 1<=a&&5>=a}},uploadURL:{value:""}}});c.UploaderHTML5.Queue=d},"3.5.1",{requires:["widget","substitute","node-event-simulate","file-html5","uploader-queue"]});
