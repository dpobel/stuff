YUI.add("datatable-core",function(c){function l(a){var b={},e;for(e in a)b[e]=a[e];return b}var m=c.Attribute.INVALID_VALUE,f=c.Lang,p=f.isFunction,n=f.isObject,g=f.isArray,q=f.isString,o=f.isNumber,h=f.sub,r=c.Array,j=c.Object.keys,f=c.namespace("DataTable").Core=function(){};f.ATTRS={columns:{validator:g,getter:"_getColumns"},recordType:{setter:"_setRecordType",writeOnce:!0},data:{value:[],setter:"_setData",getter:"_getData"},headerView:{validator:"_validateView",writeOnce:!0},footerView:{validator:"_validateView",
writeOnce:!0},bodyView:{validator:"_validateView",writeOnce:!0},summary:{value:"",setter:c.Escape.html},caption:{value:""},recordset:{setter:"_setRecordset",getter:"_getRecordset",lazyAdd:!1},columnset:{setter:"_setColumnset",getter:"_getColumnset",lazyAdd:!1}};c.mix(f.prototype,{CAPTION_TEMPLATE:'<caption class="{className}"/>',TABLE_TEMPLATE:'<table cellspacing="0" class="{className}"/>',TBODY_TEMPLATE:'<tbody class="{className}"/>',TFOOT_TEMPLATE:'<tfoot class="{className}"/>',THEAD_TEMPLATE:'<thead class="{className}"/>',
delegate:function(){var a=this.get("contentBox");return a.delegate.apply(a,arguments)},getCell:function(a,b){return this.body&&this.body.getCell&&this.body.getCell.apply(this.body,arguments)},getColumn:function(a){var b,e,c;if(b=n(a)&&!g(a)?a:this.get("columns."+a))return b;b=this.get("columns");if(o(a)||g(a)){a=r(a);c=b;b=0;for(e=a.length-1;c&&b<e;++b)c=c[a[b]]&&c[a[b]].children;return c&&c[a[b]]||null}return null},getRecord:function(a){var b=this.data.getById(a)||this.data.getByClientId(a);b||(o(a)&&
(b=this.data.item(a)),!b&&this.body&&this.body.getRecord&&(b=this.body.getRecord.apply(this.body,arguments)));return b||null},getRow:function(a){return this.body&&this.body.getRow&&this.body.getRow.apply(this.body,arguments)},syncUI:function(){this._uiSetCaption(this.get("caption"));this._uiSetSummary(this.get("summary"));this.head&&this.fire("renderHeader",{view:this.head});this.body&&this.fire("renderBody",{view:this.body});this.foot&&this.fire("renderFooter",{view:this.foot})},_afterColumnsChange:function(a){this._setColumnMap(a.newVal);
this._setDisplayColumns(a.newVal)},_afterDataChange:function(a){a=a.newVal;this.head&&this.head.set("modelList",a);this.body&&this.body.set("modelList",a);this.foot&&this.foot.set("modelList",a)},bindUI:function(){this.after("dataChange",c.bind("_afterDataChange",this))},_createRecordClass:function(a){var b,e,i;if(g(a)){b={};e=0;for(i=a.length;e<i;++e)b[a[e]]={}}else n(a)&&(b=a);return c.Base.create("record",c.Model,[],null,{ATTRS:b})},_createTable:function(){return c.Node.create(h(this.TABLE_TEMPLATE,
{className:this.getClassName("table")})).empty()},_createTBody:function(){return c.Node.create(h(this.TBODY_TEMPLATE,{className:this.getClassName("data")}))},_createTFoot:function(){return c.Node.create(h(this.TFOOT_TEMPLATE,{className:this.getClassName("footer")}))},_createTHead:function(){return c.Node.create(h(this.THEAD_TEMPLATE,{className:this.getClassName("columns")}))},_defRenderBodyFn:function(a){a.view.render()},_defRenderFooterFn:function(a){a.view.render()},_defRenderHeaderFn:function(a){a.view.render()},
_defRenderTableFn:function(a){var b;this._tableNode=this._createTable();a.headerView&&(b=l(a.headerConfig||{}),b.container=this._theadNode=this._createTHead(),this.head=new a.headerView(b),this.head.addTarget(this),this._tableNode.insertBefore(this._theadNode,this._tableNode.one("> tfoot, > tbody")));a.footerView&&(b=l(a.footerConfig||{}),b.container=this._tfootNode=this._createTFoot(),this.foot=new a.footerView(b),this.foot.addTarget(this),this._tableNode.insertBefore(this._tfootNode,this._tableNode.one("> tbody")));
a.bodyView&&(b=l(a.bodyConfig||{}),b.container=this._tbodyNode=this._createTBody(),this.body=new a.bodyView(b),this.body.addTarget(this),this._tableNode.append(this._tbodyNode))},_getColumns:function(a,b){return 8<b.length?this._columnMap:a},_getColumnset:function(a,b){return this.get(b.replace(/^columnset/,"columns"))},_getData:function(a){return this.data||a},_initColumns:function(){var a=this.get("columns"),b=this.get("recordType");a||(a=b&&b.ATTRS?j(b.ATTRS):[],this.set("columns",a,{silent:!0}));
this._setColumnMap(a);this._setDisplayColumns(a)},_initData:function(){var a=this.get("data"),b,e;g(a)&&(b=this.get("recordType"),e=a,a=new c.ModelList,b&&(a.model=b,a.reset(e,{silent:!0})),this.set("data",a,{silent:!0}));this.data=a;this.data.addTarget(this)},_initEvents:function(){this.publish({renderTable:{fireOnce:!0,defaultFn:c.bind("_defRenderTableFn",this)},renderHeader:{defaultFn:c.bind("_defRenderHeaderFn",this)},renderBody:{defaultFn:c.bind("_defRenderBodyFn",this)},renderFooter:{defaultFn:c.bind("_defRenderFooterFn",
this)}})},initializer:function(){this._initColumns();this._initRecordType();this._initData();this._initViewConfig();this._initEvents();this.after("columnsChange",this._afterColumnsChange);this._UI_ATTRS={BIND:this._UI_ATTRS.BIND.concat(["caption","summary"]),SYNC:this._UI_ATTRS.SYNC.concat(["caption","summary"])}},_initRecordType:function(){var a,b,c,i;this.get("recordType")||((a=this.get("data"),b=this._columnMap,a.model?c=a.model:a.size&&a.size()?c=a.model=a.item(0).constructor:g(a)&&a.length?c=
a[0].constructor.ATTRS?a[0].constructor:this._createRecordClass(j(a[0])):(a=j(b),a.length&&(c=this._createRecordClass(a))),c)?(this.set("recordType",c,{silent:!0}),(!b||!b.length)&&this._initColumns()):i=this.after(["columnsChange","recordTypeChange","dataChange"],function(){i.detach();if(!this.data.model){this._initRecordType();this.data.model=this.get("recordType")}}))},_initViewConfig:function(){this._viewConfig={source:this,cssPrefix:this._cssPrefix};this._headerConfig=c.Object(this._viewConfig);
this._bodyConfig=c.Object(this._viewConfig);this._footerConfig=c.Object(this._viewConfig)},_parseColumns:function(a){function b(a){a=a.replace(/\s+/,"-");f[a]?a+=f[a]++:f[a]=1;return a}function e(a,f){var h,j,d,k;h=0;for(j=a.length;h<j;++h)(d=a[h],q(d)&&(a[h]=d={key:d}),k=c.stamp(d),d.id||(d.id=k),d.field&&(d.name=d.field),f?d._parent=f:delete d._parent,g(d.children))?(d.name&&(i[b(d.name)]=d),e(d.children,d)):((k=d.key)&&!i[k]&&(i[k]=d),d._id=b(d.name||d.key||d.id),i[d._id]=d)}var i={},f={};e(a);
return i},renderUI:function(){var a=this.get("contentBox"),b;a&&(this._viewConfig.columns=this.get("columns"),this._viewConfig.modelList=this.data,this.fire("renderTable",{headerView:this.get("headerView"),headerConfig:this._headerConfig,bodyView:this.get("bodyView"),bodyConfig:this._bodyConfig,footerView:this.get("footerView"),footerConfig:this._footerConfig}),(b=this._tableNode)&&(!b.inDoc()||!b.ancestor().compareTo(a))&&a.append(b))},_setColumnMap:function(a){this._columnMap=this._parseColumns(a)},
_setColumnset:function(a){a&&c.Columnset&&a instanceof c.Columnset&&(a=a.get("definitions"));this.set("columns",a);return g(a)?a:m},_setData:function(a){null===a&&(a=[]);g(a)?this.data&&(!this.data.model&&a.length&&this.set("recordType",j(a[0])),this.data.reset(a),a=this.data):a&&a.each&&a.getAttrs?this.data=a:a=m;return a},_setDisplayColumns:function(a){function b(a){var c=[],f,h,g;f=0;for(h=a.length;f<h;++f)g=a[f],g.children?c.push.apply(c,b(g.children)):c.push(g);return c}this._displayColumns=
b(a)},_setRecordset:function(a){var b;a&&c.Recordset&&a instanceof c.Recordset&&(b=[],a.each(function(a){b.push(a.get("data"))}),a=b);this.set("data",a);return a},_setRecordType:function(a){var b;p(a)&&a.prototype.set&&a.prototype.getAttrs?b=a:n(a)&&(b=this._createRecordClass(a));return b||m},_uiSetCaption:function(a){var b=this._tableNode,e=this._captionNode;a?(e||(this._captionNode=e=c.Node.create(h(this.CAPTION_TEMPLATE,{className:this.getClassName("caption")})),b.prepend(this._captionNode)),e.setContent(a)):
e&&(e.remove(!0),delete this._captionNode)},_uiSetSummary:function(a){a?this._tableNode.setAttribute("summary",a):this._tableNode.removeAttribute("summary")},_uiSetWidth:function(a){var b=this._tableNode;o(a)&&(a+=this.DEF_UNIT);q(a)&&(this._uiSetDim("width",a),b.setStyle("width",!a?"":this.get("boundingBox").get("offsetWidth")-(parseInt(b.getComputedStyle("borderLeftWidth"),10)|0)-(parseInt(b.getComputedStyle("borderLeftWidth"),10)|0)+"px"),b.setStyle("width",a))},_validateView:function(a){return null===
a||p(a)&&a.prototype.render}})},"3.5.1",{requires:["escape","model-list","node-event-delegate"]});
