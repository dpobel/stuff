YUI.add("app-base",function(d){var g=d.Lang,i=d.Object,k=d.PjaxBase,j=d.Router,l=d.View,m=d.ClassNameManager.getClassName,h=d.config.win,f;f=d.Base.create("app",d.Base,[l,j,k],{views:{},initializer:function(a){function b(a,b){c[b]=d.merge(c[b],a)}a||(a={});var c={};i.each(this.views,b);i.each(a.views,b);this.views=c;this._viewInfoMap={};this.after("activeViewChange",d.bind("_afterActiveViewChange",this));this.get("serverRouting")||this._pjaxBindUI()},createView:function(a,b){var c=this.getViewInfo(a),
e=c&&c.type||l,e=new (g.isString(e)?i.getValue(d,e.split(".")):e)(b);this._viewInfoMap[d.stamp(e,!0)]=c;return e},getViewInfo:function(a){return g.isString(a)?this.views[a]:a&&this._viewInfoMap[d.stamp(a,!0)]},render:function(){var a=this.get("container"),b=this.get("viewContainer"),c=this.get("activeView"),e=c&&c.get("container"),d=a.compareTo(b);a.addClass(f.CSS_CLASS);b.addClass(f.VIEWS_CSS_CLASS);c&&!b.contains(e)&&b.appendChild(e);!a.contains(b)&&!d&&a.appendChild(b);return this},showView:function(a,
b,c,e){var f;c||(c={});e?c.callback=e:g.isFunction(c)&&(c={callback:c});g.isString(a)&&((e=this.getViewInfo(a))&&e.preserve&&e.instance?(a=e.instance,this._viewInfoMap[d.stamp(a,!0)]=e):(a=this.createView(a,b),f=!0));c.update&&!f&&a.setAttrs(b);"render"in c?c.render&&a.render():f&&a.render();return this._set("activeView",a,{options:c})},_attachView:function(a,b){if(a){var c=this.getViewInfo(a),d=this.get("viewContainer");a.addTarget(this);c&&(c.instance=a);d[b?"prepend":"append"](a.get("container"))}},
_destroyContainer:function(){var a=this.get("container"),b=this.get("viewContainer"),c=a.compareTo(b);d.one("body").compareTo(a)?(this.detachEvents(),a&&a.removeClass(f.CSS_CLASS),c?a&&a.removeClass(f.VIEWS_CSS_CLASS):b&&b.remove(!0)):(b&&b.remove(!0),!c&&a&&a.remove(!0))},_detachView:function(a){if(a){var b=this.getViewInfo(a)||{};b.preserve?a.remove():(a.destroy({remove:!0}),delete this._viewInfoMap[d.stamp(a,!0)],a===b.instance&&delete b.instance);a.removeTarget(this)}},_getViewContainer:function(a){!a&&
!this._viewContainer&&(a=this._viewContainer=this.create(),this._set("viewContainer",a));return a},_getURL:function(){var a=d.getLocation().toString();return this._html5?a:this._upgradeURL(a)},_initHtml5:function(){return!1===this.get("serverRouting")?!1:j.html5},_isChildView:function(a,b){var c=this.getViewInfo(a),d=this.getViewInfo(b);return c&&d?this.getViewInfo(c.parent)===d:!1},_isParentView:function(a,b){var c=this.getViewInfo(a),d=this.getViewInfo(b);return c&&d?this.getViewInfo(d.parent)===
c:!1},_navigate:function(a,b){a=this._upgradeURL(a);b||(b={});this.get("serverRouting")||"force"in b||(b.force=!0);return k.prototype._navigate.call(this,a,b)},_save:function(a,b){if(this.get("serverRouting")&&!this.get("html5")){if(!this._hasSameOrigin(a))return d.error("Security error: The new URL must be of the same origin as the current URL."),this;a=this._joinURL(a||"");b?h&&h.location.replace(a):h&&(h.location=a);return this}return j.prototype._save.apply(this,arguments)},_uiSetActiveView:function(a,
b,c){c||(c={});var d=c.callback,f=!this._isChildView(a,b)&&this._isParentView(a,b),c=!!c.prepend||f;if(a===b)return d&&d.call(this,a);this._attachView(a,c);this._detachView(b);d&&d.call(this,a)},_upgradeURL:function(a){if(!this._hasSameOrigin(a))return a;var b=(a.match(/#(.*)$/)||[])[1]||"",c=d.HistoryHash.hashPrefix;c&&0===b.indexOf(c)&&(b=b.replace(c,""));b&&"/"===b.charAt(0)&&(a=this._resolveURL(this._joinURL(b)));return a},_afterActiveViewChange:function(a){this._uiSetActiveView(a.newVal,a.prevVal,
a.options)}},{ATTRS:{activeView:{value:null,readOnly:!0},container:{valueFn:function(){return d.one("body")}},html5:{valueFn:"_initHtml5"},linkSelector:{value:"a"},serverRouting:{value:void 0,writeOnce:"initOnly"},viewContainer:{getter:"_getViewContainer",setter:d.one,writeOnce:!0}},CSS_CLASS:m("app"),VIEWS_CSS_CLASS:m("app","views"),_NON_ATTRS_CFG:["views"]});d.namespace("App").Base=f;d.App=d.mix(d.Base.create("app",d.App.Base,[]),d.App,!0)},"3.5.1",{requires:["classnamemanager","pjax-base","router",
"view"]});
