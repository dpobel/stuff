YUI.add("frame",function(c){var e=function(){e.superclass.constructor.apply(this,arguments)};c.extend(e,c.Base,{_ready:null,_rendered:null,_iframe:null,_instance:null,_create:function(a){var b,d="",f=this.get("extracss")?'<style id="extra_css">'+this.get("extracss")+"</style>":"";this._iframe=c.Node.create(e.HTML);this._iframe.setStyle("visibility","hidden");this._iframe.set("src",this.get("src"));this.get("container").append(this._iframe);var i=this.get("src")===e.ATTRS.src.value;this._iframe.set("height",
"99%");i&&(d=c.substitute(e.PAGE_HTML,{DIR:this.get("dir"),LANG:this.get("lang"),TITLE:this.get("title"),META:e.META,LINKED_CSS:this.get("linkedcss"),CONTENT:this.get("content"),BASE_HREF:this.get("basehref"),DEFAULT_CSS:e.DEFAULT_CSS,EXTRA_CSS:f}),"BackCompat"!=c.config.doc.compatMode&&(d=e.getDocType()+"\n"+d));b=this._resolveWinDoc();d&&(b.doc.open(),b.doc.write(d),b.doc.close());if(b.doc.documentElement)a(b);else var h=c.later(1,this,function(){if(b.doc&&b.doc.documentElement){a(b);h.cancel()}},
null,!0)},_resolveWinDoc:function(a){a=a?a:{};a.win=c.Node.getDOMNode(this._iframe.get("contentWindow"));a.doc=c.Node.getDOMNode(this._iframe.get("contentWindow.document"));a.doc||(a.doc=c.config.doc);a.win||(a.win=c.config.win);return a},_onDomEvent:function(a){var b,d;if(c.Node.getDOMNode(this._iframe)){a.frameX=a.frameY=0;if((0<a.pageX||0<a.pageY)&&"key"!==a.type.substring(0,3))d=this._instance.one("win"),b=this._iframe.getXY(),a.frameX=b[0]+a.pageX-d.get("scrollLeft"),a.frameY=b[1]+a.pageY-d.get("scrollTop");
a.frameTarget=a.target;a.frameCurrentTarget=a.currentTarget;a.frameEvent=a;this.fire("dom:"+a.type,a)}},initializer:function(){this.publish("ready",{emitFacade:!0,defaultFn:this._defReadyFn})},destructor:function(){this.getInstance().one("doc").detachAll();this._iframe.remove()},_DOMPaste:function(a){var b="",d=this.getInstance().config.win;a._event.originalTarget&&(b=a._event.originalTarget);a._event.clipboardData&&(b=a._event.clipboardData.getData("Text"));d.clipboardData&&(b=d.clipboardData.getData("Text"),
""===b&&(d.clipboardData.setData("Text",b)||(b=null)));a.frameTarget=a.target;a.frameCurrentTarget=a.currentTarget;a.frameEvent=a;a.clipboardData=b?{data:b,getData:function(){return b}}:null;this.fire("dom:paste",a)},_defReadyFn:function(){var a=this.getInstance();c.each(e.DOM_EVENTS,function(b,d){var f=c.bind(this._onDomEvent,this),i=c.UA.ie&&0<e.THROTTLE_TIME?c.throttle(f,e.THROTTLE_TIME):f;a.Node.DOM_EVENTS[d]||(a.Node.DOM_EVENTS[d]=1);if(1===b&&"focus"!==d&&"blur"!==d&&"paste"!==d)if("key"===
d.substring(0,3))a.on(d,i,a.config.doc);else a.on(d,f,a.config.doc)},this);a.Node.DOM_EVENTS.paste=1;a.on("paste",c.bind(this._DOMPaste,this),a.one("body"));a.on("focus",c.bind(this._onDomEvent,this),a.config.win);a.on("blur",c.bind(this._onDomEvent,this),a.config.win);a.__use=a.use;a.use=c.bind(this.use,this);this._iframe.setStyles({visibility:"inherit"});a.one("body").setStyle("display","block")},_fixIECursors:function(){var a=this.getInstance(),b=a.all("table"),d=a.all("br"),c;b.size()&&d.size()&&
(c=b.item(0).get("sourceIndex"),d.each(function(b){var d=b.get("parentNode"),e=d.get("children"),g=d.all(">br");d.test("div")&&(2<e.size()?b.replace(a.Node.create("<wbr>")):b.get("sourceIndex")>c?g.size()&&b.replace(a.Node.create("<wbr>")):1<g.size()&&b.replace(a.Node.create("<wbr>")))}))},_onContentReady:function(a){if(!this._ready){this._ready=!0;var b=this.getInstance(),d=c.clone(this.get("use"));this.fire("contentready");a&&(b.config.doc=c.Node.getDOMNode(a.target));d.push(c.bind(function(){if(b.EditorSelection)b.EditorSelection.DEFAULT_BLOCK_TAG=
this.get("defaultblock");if(this.get("designMode"))if(c.UA.ie){b.config.doc.body.contentEditable="true";this._ieSetBodyHeight();b.on("keyup",c.bind(this._ieSetBodyHeight,this),b.config.doc)}else b.config.doc.designMode="on";this.fire("ready")},this));b.use.apply(b,d);b.one("doc").get("documentElement").addClass("yui-js-enabled")}},_ieHeightCounter:null,_ieSetBodyHeight:function(a){this._ieHeightCounter||(this._ieHeightCounter=0);this._ieHeightCounter++;var b=!1;a||(b=!0);if(a){switch(a.keyCode){case 8:case 13:b=
!0}if(a.ctrlKey||a.shiftKey)b=!0}if(b)try{var d=this.getInstance(),f=this._iframe.get("offsetHeight");d.config.doc.body.style.height=f>d.config.doc.body.scrollHeight?f-15+"px":"auto"}catch(e){100>this._ieHeightCounter&&c.later(200,this,this._ieSetBodyHeight)}},_resolveBaseHref:function(a){if(!a||""===a)a=c.config.doc.location.href,-1!==a.indexOf("?")&&(a=a.substring(0,a.indexOf("?"))),a=a.substring(0,a.lastIndexOf("/"))+"/";return a},_getHTML:function(a){this._ready&&(a=this.getInstance().one("body").get("innerHTML"));
return a},_setHTML:function(a){if(this._ready)this.getInstance().one("body").set("innerHTML",a);else this.on("contentready",c.bind(function(a){this.getInstance().one("body").set("innerHTML",a)},this,a));return a},_getLinkedCSS:function(a){c.Lang.isArray(a)||(a=[a]);var b="";this._ready?b=a:c.each(a,function(a){""!==a&&(b+='<link rel="stylesheet" href="'+a+'" type="text/css">')});return b},_setLinkedCSS:function(a){this._ready&&this.getInstance().Get.css(a);return a},_setExtraCSS:function(a){if(this._ready){var b=
this.getInstance();b.one("#extra_css").remove();b.one("head").append('<style id="extra_css">'+a+"</style>")}return a},_instanceLoaded:function(a){this._instance=a;this._onContentReady();a=this._instance.config.doc;if(this.get("designMode")&&!c.UA.ie)try{a.execCommand("styleWithCSS",!1,!1),a.execCommand("insertbronreturn",!1,!1)}catch(b){}},use:function(){var a=this.getInstance(),b=c.Array(arguments),d=!1;c.Lang.isFunction(b[b.length-1])&&(d=b.pop());d&&b.push(function(){d.apply(a,arguments)});a.__use.apply(a,
b)},delegate:function(a,b,d,c){var e=this.getInstance();if(!e)return!1;c||(c=d,d="body");return e.delegate(a,b,d,c)},getInstance:function(){return this._instance},render:function(a){if(this._rendered)return this;this._rendered=!0;a&&this.set("container",a);this._create(c.bind(function(a){var d,f,e=c.bind(function(a){this._instanceLoaded(a)},this),h=c.clone(this.get("use")),j={debug:!1,win:a.win,doc:a.doc},g=c.bind(function(){j=this._resolveWinDoc(j);d=YUI(j);d.host=this.get("host");try{d.use("node-base",
e),f&&clearInterval(f)}catch(a){f=setInterval(function(){g()},350)}},this);h.push(g);c.use.apply(c,h)},this));return this},_handleFocus:function(){var a=this.getInstance(),b=new a.EditorSelection;if(b.anchorNode){var d=b.anchorNode,c;d.test("p")&&""===d.get("innerHTML")&&(d=d.get("parentNode"));c=d.get("childNodes");if(c.size())if(c.item(0).test("br"))b.selectNode(d,!0,!1);else if(c.item(0).test("p"))(d=c.item(0).one("br.yui-cursor"))&&(d=d.get("parentNode")),d||(d=c.item(0).get("firstChild")),d||
(d=c.item(0)),d&&b.selectNode(d,!0,!1);else if(a=a.one("br.yui-cursor"))(a=a.get("parentNode"))&&b.selectNode(a,!0,!1)}},focus:function(a){if(c.UA.ie&&9>c.UA.ie){try{c.one("win").focus(),this.getInstance()&&this.getInstance().one("win")&&this.getInstance().one("win").focus()}catch(b){}!0===a&&this._handleFocus();c.Lang.isFunction(a)&&a()}else try{c.one("win").focus(),c.later(100,this,function(){this.getInstance()&&this.getInstance().one("win")&&this.getInstance().one("win").focus();!0===a&&this._handleFocus();
c.Lang.isFunction(a)&&a()})}catch(d){}return this},show:function(){this._iframe.setStyles({position:"static",left:""});if(c.UA.gecko){try{this.getInstance()&&(this.getInstance().config.doc.designMode="on")}catch(a){}this.focus()}return this},hide:function(){this._iframe.setStyles({position:"absolute",left:"-999999px"});return this}},{THROTTLE_TIME:100,DOM_EVENTS:{dblclick:1,click:1,paste:1,mouseup:1,mousedown:1,keyup:1,keydown:1,keypress:1,activate:1,deactivate:1,beforedeactivate:1,focusin:1,focusout:1},
DEFAULT_CSS:"body { background-color: #fff; font: 13px/1.22 arial,helvetica,clean,sans-serif;*font-size:small;*font:x-small; } a, a:visited, a:hover { color: blue !important; text-decoration: underline !important; cursor: text !important; } img { cursor: pointer !important; border: none; }",HTML:'<iframe border="0" frameBorder="0" marginWidth="0" marginHeight="0" leftMargin="0" topMargin="0" allowTransparency="true" width="100%" height="99%"></iframe>',PAGE_HTML:'<html dir="{DIR}" lang="{LANG}"><head><title>{TITLE}</title>{META}<base href="{BASE_HREF}"/>{LINKED_CSS}<style id="editor_css">{DEFAULT_CSS}</style>{EXTRA_CSS}</head><body>{CONTENT}</body></html>',
getDocType:function(){var a=c.config.doc.doctype,b=e.DOC_TYPE;a?b="<!DOCTYPE "+a.name+(a.publicId?" "+a.publicId:"")+(a.systemId?" "+a.systemId:"")+">":c.config.doc.all&&(a=c.config.doc.all[0],a.nodeType&&8===a.nodeType&&a.nodeValue&&-1!==a.nodeValue.toLowerCase().indexOf("doctype")&&(b="<!"+a.nodeValue+">"));return b},DOC_TYPE:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">',META:'<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta http-equiv="X-UA-Compatible" content="IE=7">',
NAME:"frame",ATTRS:{title:{value:"Blank Page"},dir:{value:"ltr"},lang:{value:"en-US"},src:{value:"javascript"+(c.UA.ie?":false":":")+";"},designMode:{writeOnce:!0,value:!1},content:{value:"<br>",setter:"_setHTML",getter:"_getHTML"},basehref:{value:!1,getter:"_resolveBaseHref"},use:{writeOnce:!0,value:["substitute","node","node-style","selector-css3"]},container:{value:"body",setter:function(a){return c.one(a)}},node:{readOnly:!0,value:null,getter:function(){return this._iframe}},id:{writeOnce:!0,
getter:function(a){a||(a="iframe-"+c.guid());return a}},linkedcss:{value:"",getter:"_getLinkedCSS",setter:"_setLinkedCSS"},extracss:{value:"",setter:"_setExtraCSS"},host:{value:!1},defaultblock:{value:"p"}}});c.Frame=e},"3.5.1",{skinnable:!1,requires:["base","node","selector-css3","substitute","yui-throttle"]});
