YUI.add("datatable-scroll",function(c){function j(a,b){return parseInt(a.getComputedStyle(b),10)|0}var g=c.Lang,l=g.isString,q=g.isNumber,r=g.isArray;c.DataTable.Scrollable=g=function(){};g.ATTRS={scrollable:{value:!1,setter:"_setScrollable"}};c.mix(g.prototype,{scrollTo:function(a){var b;if(a&&this._tbodyNode&&(this._yScrollNode||this._xScrollNode))r(a)?b=this.getCell(a):q(a)?b=this.getRow(a):l(a)?b=this._tbodyNode.one("#"+a):a instanceof c.Node&&a.ancestor(".yui3-datatable")===this.get("boundingBox")&&
(b=a),b&&b.scrollIntoView();return this},_CAPTION_TABLE_TEMPLATE:'<table class="{className}" role="presentation"></table>',_SCROLL_LINER_TEMPLATE:'<div class="{className}"></div>',_SCROLLBAR_TEMPLATE:'<div class="{className}"><div></div></div>',_X_SCROLLER_TEMPLATE:'<div class="{className}"></div>',_Y_SCROLL_HEADER_TEMPLATE:'<table cellspacing="0" aria-hidden="true" class="{className}"></table>',_Y_SCROLLER_TEMPLATE:'<div class="{className}"><div class="{scrollerClassName}"></div></div>',_addScrollbarPadding:function(){var a=
this._yScrollHeader,b="."+this.getClassName("header"),d,e,f,m;if(a){d=c.DOM.getScrollbarWidth()+"px";a=a.all("tr");f=0;for(m=a.size();f<m;f+=+e.get("rowSpan"))e=a.item(f).all(b).pop(),e.setStyle("paddingRight",d)}},_afterScrollableChange:function(){var a=this._xScrollNode;this._xScroll&&a&&(this._yScroll&&!this._yScrollNode?a.setStyle("paddingRight",c.DOM.getScrollbarWidth()+"px"):!this._yScroll&&this._yScrollNode&&a.setStyle("paddingRight",""));this._syncScrollUI()},_afterScrollCaptionChange:function(){(this._xScroll||
this._yScroll)&&this._syncScrollUI()},_afterScrollColumnsChange:function(){if(this._xScroll||this._yScroll)this._yScroll&&this._yScrollHeader&&this._syncScrollHeaders(),this._syncScrollUI()},_afterScrollDataChange:function(){(this._xScroll||this._yScroll)&&this._syncScrollUI()},_afterScrollHeightChange:function(){this._yScroll&&this._syncScrollUI()},_afterScrollSort:function(){var a,b;this._yScroll&&this._yScrollHeader&&(b="."+this.getClassName("header"),a=this._theadNode.all(b),this._yScrollHeader.all(b).each(function(b,
c){b.set("className",a.item(c).get("className"))}))},_afterScrollWidthChange:function(){(this._xScroll||this._yScroll)&&this._syncScrollUI()},_bindScrollbar:function(){var a=this._scrollbarNode,b=this._yScrollNode;a&&b&&!this._scrollbarEventHandle&&(this._scrollbarEventHandle=new c.Event.Handle([a.on("scroll",this._syncScrollPosition,this,"virtual"),b.on("scroll",this._syncScrollPosition,this)]))},_bindScrollResize:function(){this._scrollResizeHandle||(this._scrollResizeHandle=c.on("resize",this._syncScrollUI,
null,this))},_bindScrollUI:function(){this.after({columnsChange:c.bind("_afterScrollColumnsChange",this),heightChange:c.bind("_afterScrollHeightChange",this),widthChange:c.bind("_afterScrollWidthChange",this),captionChange:c.bind("_afterScrollCaptionChange",this),scrollableChange:c.bind("_afterScrollableChange",this),sort:c.bind("_afterScrollSort",this)});this.after(["dataChange","*:add","*:remove","*:reset","*:change"],c.bind("_afterScrollDataChange",this))},_clearScrollLock:function(){this._scrollLock&&
(this._scrollLock.cancel(),delete this._scrollLock)},_createScrollbar:function(){var a=this._scrollbarNode;a||(a=this._scrollbarNode=c.Node.create(c.Lang.sub(this._SCROLLBAR_TEMPLATE,{className:this.getClassName("scrollbar")})),a.setStyle("width",c.DOM.getScrollbarWidth()+1+"px"));return a},_createScrollCaptionTable:function(){this._captionTable||(this._captionTable=c.Node.create(c.Lang.sub(this._CAPTION_TABLE_TEMPLATE,{className:this.getClassName("caption","table")})),this._captionTable.empty());
return this._captionTable},_createXScrollNode:function(){this._xScrollNode||(this._xScrollNode=c.Node.create(c.Lang.sub(this._X_SCROLLER_TEMPLATE,{className:this.getClassName("x","scroller")})));return this._xScrollNode},_createYScrollHeader:function(){var a=this._yScrollHeader;a||(a=this._yScrollHeader=c.Node.create(c.Lang.sub(this._Y_SCROLL_HEADER_TEMPLATE,{className:this.getClassName("scroll","columns")})));return a},_createYScrollNode:function(){var a;this._yScrollNode||(a=this.getClassName("y",
"scroller"),this._yScrollContainer=c.Node.create(c.Lang.sub(this._Y_SCROLLER_TEMPLATE,{className:this.getClassName("y","scroller","container"),scrollerClassName:a})),this._yScrollNode=this._yScrollContainer.one("."+a));return this._yScrollContainer},_disableScrolling:function(){this._removeScrollCaptionTable();this._disableXScrolling();this._disableYScrolling();this._unbindScrollResize();this._uiSetWidth(this.get("width"))},_disableXScrolling:function(){this._removeXScrollNode()},_disableYScrolling:function(){this._removeYScrollHeader();
this._removeYScrollNode();this._removeYScrollContainer();this._removeScrollbar()},destructor:function(){this._unbindScrollbar();this._unbindScrollResize();this._clearScrollLock()},initializer:function(){this._setScrollProperties();this.after(["scrollableChange","heightChange","widthChange"],this._setScrollProperties);c.Do.after(this._bindScrollUI,this,"bindUI");c.Do.after(this._syncScrollUI,this,"syncUI")},_removeScrollCaptionTable:function(){this._captionTable&&(this._captionNode&&this._tableNode.prepend(this._captionNode),
this._captionTable.remove().destroy(!0),delete this._captionTable)},_removeXScrollNode:function(){var a=this._xScrollNode;a&&(a.replace(a.get("childNodes").toFrag()),a.remove().destroy(!0),delete this._xScrollNode)},_removeYScrollContainer:function(){var a=this._yScrollContainer;a&&(a.replace(a.get("childNodes").toFrag()),a.remove().destroy(!0),delete this._yScrollContainer)},_removeYScrollHeader:function(){this._yScrollHeader&&(this._yScrollHeader.remove().destroy(!0),delete this._yScrollHeader)},
_removeYScrollNode:function(){var a=this._yScrollNode;a&&(a.replace(a.get("childNodes").toFrag()),a.remove().destroy(!0),delete this._yScrollNode)},_removeScrollbar:function(){this._scrollbarNode&&(this._scrollbarNode.remove().destroy(!0),delete this._scrollbarNode);this._scrollbarEventHandle&&(this._scrollbarEventHandle.detach(),delete this._scrollbarEventHandle)},_setScrollable:function(a){!0===a&&(a="xy");l(a)&&(a=a.toLowerCase());return!1===a||"y"===a||"x"===a||"xy"===a?a:c.Attribute.INVALID_VALUE},
_setScrollProperties:function(){var a=this.get("scrollable")||"",b=this.get("width"),d=this.get("height");this._xScroll=b&&-1<a.indexOf("x");this._yScroll=d&&-1<a.indexOf("y")},_syncScrollPosition:function(a,b){var d=this._scrollbarNode,e=this._yScrollNode;d&&e&&!(this._scrollLock&&this._scrollLock.source!==b)&&(this._clearScrollLock(),this._scrollLock=c.later(300,this,this._clearScrollLock),this._scrollLock.source=b,"virtual"===b?e.set("scrollTop",d.get("scrollTop")):d.set("scrollTop",e.get("scrollTop")))},
_syncScrollCaptionUI:function(){var a=this._captionNode,b=this._tableNode,d=this._captionTable,e;if(a){if(e=a.getAttribute("id"),d||(d=this._createScrollCaptionTable(),this.get("contentBox").prepend(d)),!a.get("parentNode").compareTo(d))d.empty().insert(a),e||(e=c.stamp(a),a.setAttribute("id",e)),b.setAttribute("aria-describedby",e)}else d&&this._removeScrollCaptionTable()},_syncScrollColumnWidths:function(){var a=[];this._theadNode&&this._yScrollHeader&&(this._theadNode.all("."+this.getClassName("header")).each(function(b){a.push(c.UA.ie&&
8>c.UA.ie?b.get("clientWidth")-j(b,"paddingLeft")-j(b,"paddingRight")+"px":b.getComputedStyle("width"))}),this._yScrollHeader.all("."+this.getClassName("scroll","liner")).each(function(b,d){b.setStyle("width",a[d])}))},_syncScrollHeaders:function(){var a=this._yScrollHeader,b=this._SCROLL_LINER_TEMPLATE,d=this.getClassName("scroll","liner"),e=this.getClassName("header"),f=this._theadNode.all("."+e);this._theadNode&&a&&(a.empty().appendChild(this._theadNode.cloneNode(!0)),a.all("[id]").removeAttribute("id"),
a.all("."+e).each(function(a,e){var h=c.Node.create(c.Lang.sub(b,{className:d})),i=f.item(e);h.setStyle("padding",i.getComputedStyle("paddingTop")+" "+i.getComputedStyle("paddingRight")+" "+i.getComputedStyle("paddingBottom")+" "+i.getComputedStyle("paddingLeft"));h.appendChild(a.get("childNodes").toFrag());a.appendChild(h)},this),this._syncScrollColumnWidths(),this._addScrollbarPadding())},_syncScrollUI:function(){var a=this._xScroll,b=this._yScroll,d=this._xScrollNode,c=this._yScrollNode,d=d&&d.get("scrollLeft"),
c=c&&c.get("scrollTop");this._uiSetScrollable();a||b?("%"===(this.get("width")||"").slice(-1)?this._bindScrollResize():this._unbindScrollResize(),this._syncScrollCaptionUI()):this._disableScrolling();this._yScrollHeader&&this._yScrollHeader.setStyle("display","none");a&&(b||this._disableYScrolling(),this._syncXScrollUI(b));b&&(a||this._disableXScrolling(),this._syncYScrollUI(a));d&&this._xScrollNode&&this._xScrollNode.set("scrollLeft",d);c&&this._yScrollNode&&this._yScrollNode.set("scrollTop",c)},
_syncXScrollUI:function(a){var b=this._xScrollNode,d=this._yScrollContainer,e=this._tableNode,f=this.get("width"),m=this.get("boundingBox").get("offsetWidth"),g=c.DOM.getScrollbarWidth(),h;b||(b=this._createXScrollNode(),(d||e).replace(b).appendTo(b));d=j(b,"borderLeftWidth")+j(b,"borderRightWidth");b.setStyle("width","");this._uiSetDim("width","");a&&this._yScrollContainer&&this._yScrollContainer.setStyle("width","");c.UA.ie&&8>c.UA.ie&&(e.setStyle("width",f),e.get("offsetWidth"));e.setStyle("width",
"");h=e.get("offsetWidth");e.setStyle("width",h+"px");this._uiSetDim("width",f);b.setStyle("width",m-d+"px");b.get("offsetWidth")-d>h&&(a?e.setStyle("width",b.get("offsetWidth")-d-g+"px"):e.setStyle("width","100%"))},_syncYScrollUI:function(a){var b=this._yScrollContainer,d=this._yScrollNode,e=this._xScrollNode,f=this._yScrollHeader,g=this._scrollbarNode,n=this._tableNode,h=this._theadNode,i=this._captionTable,k=this.get("boundingBox"),l=this.get("contentBox"),o=this.get("width"),k=k.get("offsetHeight"),
p=c.DOM.getScrollbarWidth();i&&!a&&i.setStyle("width",o||"100%");b||(b=this._createYScrollNode(),d=this._yScrollNode,n.replace(b).appendTo(d));e=a?e:b;a||n.setStyle("width","");a&&(k-=p);d.setStyle("height",k-e.get("offsetTop")-j(e,"borderTopWidth")-j(e,"borderBottomWidth")+"px");a?b.setStyle("width",n.get("offsetWidth")+p+"px"):this._uiSetYScrollWidth(o);i&&!a&&i.setStyle("width",b.get("offsetWidth")+"px");h&&!f&&(f=this._createYScrollHeader(),b.prepend(f),this._syncScrollHeaders());f&&(this._syncScrollColumnWidths(),
f.setStyle("display",""),g||(g=this._createScrollbar(),this._bindScrollbar(),l.prepend(g)),this._uiSetScrollbarHeight(),this._uiSetScrollbarPosition(e))},_uiSetScrollable:function(){this.get("boundingBox").toggleClass(this.getClassName("scrollable","x"),this._xScroll).toggleClass(this.getClassName("scrollable","y"),this._yScroll)},_uiSetScrollbarHeight:function(){var a=this._scrollbarNode,b=this._yScrollNode,c=this._yScrollHeader;a&&b&&c&&(a.get("firstChild").setStyle("height",this._tbodyNode.get("scrollHeight")+
"px"),a.setStyle("height",parseFloat(b.getComputedStyle("height"))-parseFloat(c.getComputedStyle("height"))+"px"))},_uiSetScrollbarPosition:function(a){var b=this._scrollbarNode,d=this._yScrollHeader;b&&a&&d&&b.setStyles({top:parseFloat(d.getComputedStyle("height"))+j(a,"borderTopWidth")+a.get("offsetTop")+"px",left:a.get("offsetWidth")-c.DOM.getScrollbarWidth()-1-j(a,"borderRightWidth")+"px"})},_uiSetYScrollWidth:function(a){var b=this._yScrollContainer,d=this._tableNode,e,f;b&&d&&(f=c.DOM.getScrollbarWidth(),
a?(e=b.get("offsetWidth")-b.get("clientWidth")+f,b.setStyle("width",a),a=b.get("clientWidth")-e,d.setStyle("width",a+"px"),d=d.get("offsetWidth"),b.setStyle("width",d+f+"px")):(d.setStyle("width",""),b.setStyle("width",""),b.setStyle("width",d.get("offsetWidth")+f+"px")))},_unbindScrollbar:function(){this._scrollbarEventHandle&&this._scrollbarEventHandle.detach()},_unbindScrollResize:function(){this._scrollResizeHandle&&(this._scrollResizeHandle.detach(),delete this._scrollResizeHandle)}},!0);c.Base.mix(c.DataTable,
[g])},"3.5.1",{skinnable:!0,requires:["datatable-base","dom-screen"]});
