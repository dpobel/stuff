YUI.add("console",function(c){function e(){e.superclass.constructor.apply(this,arguments)}var d=c.ClassNameManager.getClassName,s=d("console","button"),t=d("console","checkbox"),j=d("console","clear"),k=d("console","collapse"),u=d("console","collapsed"),v=d("console","controls"),w=d("console","hd"),x=d("console","bd"),y=d("console","ft"),p=d("console","title"),q=d("console","entry"),z=d("console","entry","cat"),A=d("console","entry","content"),B=d("console","entry","meta"),C=d("console","entry","src"),
D=d("console","entry","time"),l=d("console","pause"),r=d("console","pause","label"),E=/^(\S+)\s/,F=/&(?!#?[a-z0-9]+;)/g,G=/>/g,H=/</g,d=c.Lang,i=c.Node.create,m=d.isNumber,g=d.isString,n=c.merge,o=c.substitute;c.Console=c.extend(e,c.Widget,{_evtCat:null,_head:null,_body:null,_foot:null,_printLoop:null,buffer:null,log:function(){c.log.apply(c,arguments);return this},clearConsole:function(){this._body.empty();this._cancelPrintLoop();this.buffer=[];return this},reset:function(){this.fire("reset");return this},
collapse:function(){this.set("collapsed",!0);return this},expand:function(){this.set("collapsed",!1);return this},printBuffer:function(a){var b=this.buffer,d=c.config.debug,f=[],h=this.get("consoleLimit"),e=this.get("newestOnTop"),g=e?this._body.get("firstChild"):null;b.length>h&&b.splice(0,b.length-h);a=Math.min(b.length,a||b.length);c.config.debug=!1;if(!this.get("paused")&&this.get("rendered")){for(h=0;h<a&&b.length;++h)f[h]=this._createEntryHTML(b.shift());b.length||this._cancelPrintLoop();f.length&&
(e&&f.reverse(),this._body.insertBefore(i(f.join("")),g),this.get("scrollIntoView")&&this.scrollToLatest(),this._trimOldEntries())}c.config.debug=d;return this},initializer:function(){this._evtCat=c.stamp(this)+"|";this.buffer=[];this.get("logSource").on(this._evtCat+this.get("logEvent"),c.bind("_onLogEvent",this));this.publish("entry",{defaultFn:this._defEntryFn});this.publish("reset",{defaultFn:this._defResetFn});this.after("rendered",this._schedulePrint)},destructor:function(){var a=this.get("boundingBox");
this._cancelPrintLoop();this.get("logSource").detach(this._evtCat+"*");a.purge(!0)},renderUI:function(){this._initHead();this._initBody();this._initFoot();var a=this.get("style");"block"!==a&&this.get("boundingBox").addClass(this.getClassName(a))},syncUI:function(){this._uiUpdatePaused(this.get("paused"));this._uiUpdateCollapsed(this.get("collapsed"));this._uiSetHeight(this.get("height"))},bindUI:function(){this.get("contentBox").one("button."+k).on("click",this._onCollapseClick,this);this.get("contentBox").one("input[type=checkbox]."+
l).on("click",this._onPauseClick,this);this.get("contentBox").one("button."+j).on("click",this._onClearClick,this);this.after(this._evtCat+"stringsChange",this._afterStringsChange);this.after(this._evtCat+"pausedChange",this._afterPausedChange);this.after(this._evtCat+"consoleLimitChange",this._afterConsoleLimitChange);this.after(this._evtCat+"collapsedChange",this._afterCollapsedChange)},_initHead:function(){var a=this.get("contentBox"),b=n(e.CHROME_CLASSES,{str_collapse:this.get("strings.collapse"),
str_title:this.get("strings.title")});this._head=i(o(e.HEADER_TEMPLATE,b));a.insertBefore(this._head,a.get("firstChild"))},_initBody:function(){this._body=i(o(e.BODY_TEMPLATE,e.CHROME_CLASSES));this.get("contentBox").appendChild(this._body)},_initFoot:function(){var a=n(e.CHROME_CLASSES,{id_guid:c.guid(),str_pause:this.get("strings.pause"),str_clear:this.get("strings.clear")});this._foot=i(o(e.FOOTER_TEMPLATE,a));this.get("contentBox").appendChild(this._foot)},_isInLogLevel:function(a){var a=a.cat,
b=this.get("logLevel");return"info"!==b&&(a=a||"info",g(a)&&(a=a.toLowerCase()),"warn"===a&&"error"===b||"info"===a&&"info"!==b)?!1:!0},_normalizeMessage:function(a){var b=a.src,a={time:new Date,message:a.msg,category:a.cat||this.get("defaultCategory"),sourceAndDetail:b||this.get("defaultSource"),source:null,localTime:null,elapsedTime:null,totalTime:null};a.source=E.test(a.sourceAndDetail)?RegExp.$1:a.sourceAndDetail;a.localTime=a.time.toLocaleTimeString?a.time.toLocaleTimeString():a.time+"";a.elapsedTime=
a.time-this.get("lastTime");a.totalTime=a.time-this.get("startTime");this._set("lastTime",a.time);return a},_schedulePrint:function(){!this._printLoop&&!this.get("paused")&&this.get("rendered")&&(this._printLoop=c.later(this.get("printTimeout"),this,this.printBuffer,this.get("printLimit"),!0))},_createEntryHTML:function(a){a=n(this._htmlEscapeMessage(a),e.ENTRY_CLASSES,{cat_class:this.getClassName("entry",a.category),src_class:this.getClassName("entry",a.source)});return this.get("entryTemplate").replace(/\{(\w+)\}/g,
function(b,c){return c in a?a[c]:""})},scrollToLatest:function(){this._body.set("scrollTop",this.get("newestOnTop")?0:this._body.get("scrollHeight"))},_htmlEscapeMessage:function(a){a.message=this._encodeHTML(a.message);a.source=this._encodeHTML(a.source);a.sourceAndDetail=this._encodeHTML(a.sourceAndDetail);a.category=this._encodeHTML(a.category);return a},_trimOldEntries:function(){c.config.debug=!1;var a=this._body,b=this.get("consoleLimit"),d=c.config.debug,f,e;if(a&&(a=a.all("."+q),e=a.size()-
b,0<e)){this.get("newestOnTop")?(f=b,e=a.size()):f=0;for(this._body.setStyle("display","none");f<e;++f)(b=a.item(f))&&b.remove();this._body.setStyle("display","")}c.config.debug=d},_encodeHTML:function(a){return g(a)?a.replace(F,"&#38;").replace(H,"&#60;").replace(G,"&#62;"):a},_cancelPrintLoop:function(){this._printLoop&&(this._printLoop.cancel(),this._printLoop=null)},_validateStyle:function(a){return"inline"===a||"block"===a||"separate"===a},_onPauseClick:function(a){this.set("paused",a.target.get("checked"))},
_onClearClick:function(){this.clearConsole()},_onCollapseClick:function(){this.set("collapsed",!this.get("collapsed"))},_validateLogSource:function(a){return a&&c.Lang.isFunction(a.on)},_setLogLevel:function(a){g(a)&&(a=a.toLowerCase());return"warn"===a||"error"===a?a:"info"},_getUseBrowserConsole:function(){var a=this.get("logSource");return a instanceof YUI?a.config.useBrowserConsole:null},_setUseBrowserConsole:function(a){var b=this.get("logSource");return b instanceof YUI?(a=!!a,b.config.useBrowserConsole=
a):c.Attribute.INVALID_VALUE},_uiSetHeight:function(a){e.superclass._uiSetHeight.apply(this,arguments);this._head&&this._foot&&this._body.setStyle("height",this.get("boundingBox").get("offsetHeight")-this._head.get("offsetHeight")-this._foot.get("offsetHeight")+"px")},_uiSizeCB:function(){},_afterStringsChange:function(a){var b=a.subAttrName?a.subAttrName.split(".")[1]:null,c=this.get("contentBox"),d=a.prevVal,a=a.newVal;(!b||"title"===b)&&d.title!==a.title&&c.all("."+p).setContent(a.title);(!b||
"pause"===b)&&d.pause!==a.pause&&c.all("."+r).setContent(a.pause);(!b||"clear"===b)&&d.clear!==a.clear&&c.all("."+j).set("value",a.clear)},_afterPausedChange:function(a){var b=a.newVal;a.src!==c.Widget.SRC_UI&&this._uiUpdatePaused(b);b?this._printLoop&&this._cancelPrintLoop():this._schedulePrint()},_uiUpdatePaused:function(a){var b=this._foot.all("input[type=checkbox]."+l);b&&b.set("checked",a)},_afterConsoleLimitChange:function(){this._trimOldEntries()},_afterCollapsedChange:function(a){this._uiUpdateCollapsed(a.newVal)},
_uiUpdateCollapsed:function(a){var b=this.get("boundingBox"),c=b.all("button."+k),d=a?"addClass":"removeClass",e=this.get("strings."+(a?"expand":"collapse"));b[d](u);c&&c.setContent(e);this._uiSetHeight(a?this._head.get("offsetHeight"):this.get("height"))},_afterVisibleChange:function(a){e.superclass._afterVisibleChange.apply(this,arguments);this._uiUpdateFromHideShow(a.newVal)},_uiUpdateFromHideShow:function(a){a&&this._uiSetHeight(this.get("height"))},_onLogEvent:function(a){if(!this.get("disabled")&&
this._isInLogLevel(a)){var b=c.config.debug;c.config.debug=!1;this.fire("entry",{message:this._normalizeMessage(a)});c.config.debug=b}},_defResetFn:function(){this.clearConsole();this.set("startTime",new Date);this.set("disabled",!1);this.set("paused",!1)},_defEntryFn:function(a){a.message&&(this.buffer.push(a.message),this._schedulePrint())}},{NAME:"console",LOG_LEVEL_INFO:"info",LOG_LEVEL_WARN:"warn",LOG_LEVEL_ERROR:"error",ENTRY_CLASSES:{entry_class:q,entry_meta_class:B,entry_cat_class:z,entry_src_class:C,
entry_time_class:D,entry_content_class:A},CHROME_CLASSES:{console_hd_class:w,console_bd_class:x,console_ft_class:y,console_controls_class:v,console_checkbox_class:t,console_pause_class:l,console_pause_label_class:r,console_button_class:s,console_clear_class:j,console_collapse_class:k,console_title_class:p},HEADER_TEMPLATE:'<div class="{console_hd_class}"><h4 class="{console_title_class}">{str_title}</h4><button type="button" class="{console_button_class} {console_collapse_class}">{str_collapse}</button></div>',
BODY_TEMPLATE:'<div class="{console_bd_class}"></div>',FOOTER_TEMPLATE:'<div class="{console_ft_class}"><div class="{console_controls_class}"><label for="{id_guid}" class="{console_pause_label_class}"><input type="checkbox" class="{console_checkbox_class} {console_pause_class}" value="1" id="{id_guid}"> {str_pause}</label><button type="button" class="{console_button_class} {console_clear_class}">{str_clear}</button></div></div>',ENTRY_TEMPLATE:'<div class="{entry_class} {cat_class} {src_class}"><p class="{entry_meta_class}"><span class="{entry_src_class}">{sourceAndDetail}</span><span class="{entry_cat_class}">{category}</span><span class="{entry_time_class}"> {totalTime}ms (+{elapsedTime}) {localTime}</span></p><pre class="{entry_content_class}">{message}</pre></div>',
ATTRS:{logEvent:{value:"yui:log",writeOnce:!0,validator:g},logSource:{value:c,writeOnce:!0,validator:function(a){return this._validateLogSource(a)}},strings:{valueFn:function(){return c.Intl.get("console")}},paused:{value:!1,validator:d.isBoolean},defaultCategory:{value:"info",validator:g},defaultSource:{value:"global",validator:g},entryTemplate:{value:'<div class="{entry_class} {cat_class} {src_class}"><p class="{entry_meta_class}"><span class="{entry_src_class}">{sourceAndDetail}</span><span class="{entry_cat_class}">{category}</span><span class="{entry_time_class}"> {totalTime}ms (+{elapsedTime}) {localTime}</span></p><pre class="{entry_content_class}">{message}</pre></div>',
validator:g},logLevel:{value:c.config.logLevel||"info",setter:function(a){return this._setLogLevel(a)}},printTimeout:{value:100,validator:m},printLimit:{value:50,validator:m},consoleLimit:{value:300,validator:m},newestOnTop:{value:!0},scrollIntoView:{value:!0},startTime:{value:new Date},lastTime:{value:new Date,readOnly:!0},collapsed:{value:!1},height:{value:"300px"},width:{value:"300px"},useBrowserConsole:{lazyAdd:!1,value:!1,getter:function(){return this._getUseBrowserConsole()},setter:function(a){return this._setUseBrowserConsole(a)}},
style:{value:"separate",writeOnce:!0,validator:function(a){return this._validateStyle(a)}}}})},"3.5.1",{lang:["en","es","ja"],requires:["substitute","widget","yui-log"]});
